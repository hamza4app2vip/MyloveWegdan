<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’• Ù„Ø­Ø¨ÙŠØ¨ØªÙŠ ÙˆØ¬Ø¯Ø§Ù† Ø§Ù„ØºØ§Ù„ÙŠØ© ğŸ’•</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
     /* ØªØµÙ…ÙŠÙ… Ù‚Ø³Ù… Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
.telegram-messages-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    margin: 20px 0;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    transition: all 0.3s ease;
}

.telegram-messages-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
}

/* Ø±Ø£Ø³ Ø§Ù„Ù‚Ø³Ù… */
.telegram-section-header {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.section-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.title-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.telegram-icon {
    font-size: 2rem;
    color: #00d4aa;
    animation: pulse 2s infinite;
}

.section-title h3 {
    color: white;
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
}

/* Ù…Ø¤Ø´Ø± Ø§Ù„Ø­Ø§Ù„Ø© */
.status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.1);
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.status-dot.connected { background: #4caf50; }
.status-dot.disconnected { background: #f44336; }
.status-dot.error { background: #ff9800; }
.status-dot.connecting { background: #2196f3; }

.status-text {
    color: white;
    font-weight: 500;
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
.section-controls {
    display: flex;
    gap: 10px;
}

.control-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.control-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
.stats-bar {
    display: flex;
    gap: 30px;
    justify-content: center;
}

.stat-item {
    text-align: center;
    color: white;
}

.stat-value {
    display: block;
    font-size: 1.8rem;
    font-weight: bold;
    color: #00d4aa;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø³Ù… */
.telegram-section-content {
    background: white;
    padding: 0;
}

.messages-container {
    max-height: 600px;
    overflow-y: auto;
    padding: 20px;
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
.messages-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

/* Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
.message-item {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: 15px;
    padding: 15px;
    border-left: 4px solid #667eea;
    transition: all 0.3s ease;
    opacity: 0;
    animation: fadeInUp 0.5s ease forwards;
}

.message-item:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.message-item.recent {
    border-left-color: #4caf50;
    background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
}

.message-item.highlight {
    animation: highlight 3s ease;
}

/* Ø±Ø£Ø³ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
.message-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.message-number {
    background: #667eea;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.9rem;
}

.message-meta {
    display: flex;
    align-items: center;
    gap: 15px;
    flex: 1;
    margin-left: 15px;
}

.author {
    font-weight: 600;
    color: #2c3e50;
}

.time {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.edited-badge {
    background: #ff9800;
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: bold;
}

.message-actions {
    display: flex;
    gap: 5px;
}

.action-icon {
    background: none;
    border: none;
    color: #7f8c8d;
    cursor: pointer;
    padding: 5px;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.action-icon:hover {
    background: #e9ecef;
    color: #495057;
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
.message-content {
    margin: 10px 0;
}

.message-text {
    margin: 0;
    line-height: 1.6;
    color: #2c3e50;
    font-size: 1.05rem;
}

/* ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
.message-footer {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid #e9ecef;
}

.quick-action {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    color: #495057;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
}

.quick-action:hover {
    background: #e9ecef;
    transform: translateY(-1px);
}

.quick-action.danger:hover {
    background: #f8d7da;
    color: #721c24;
    border-color: #f5c6cb;
}

/* Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ© */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #6c757d;
}

.empty-icon {
    font-size: 4rem;
    color: #dee2e6;
    margin-bottom: 20px;
}

.empty-state h4 {
    margin: 0 0 10px 0;
    color: #495057;
}

.empty-state p {
    margin: 0 0 30px 0;
    font-size: 1.1rem;
}

/* ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù‚Ø³Ù… */
.section-footer {
    background: #f8f9fa;
    padding: 20px;
    border-top: 1px solid #dee2e6;
}

.quick-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-bottom: 20px;
}

.action-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.action-btn.secondary {
    background: linear-gradient(135deg, #95a5a6, #7f8c8d);
}

.action-btn.primary {
    background: linear-gradient(135deg, #4caf50, #45a049);
}

.telegram-info {
    text-align: center;
    color: #6c757d;
    font-size: 0.9rem;
}

.telegram-info p {
    margin: 5px 0;
}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.telegram-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease;
}

.modal-content {
    background: white;
    border-radius: 15px;
    max-width: 90%;
    max-height: 90%;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
}

.modal-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
}

.close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 5px;
    border-radius: 5px;
    transition: background 0.3s ease;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.modal-body {
    padding: 20px;
    max-height: 70vh;
    overflow-y: auto;
}

/* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.message-item-full {
    display: flex;
    gap: 15px;
    padding: 15px;
    border-bottom: 1px solid #e9ecef;
}

.message-number-full {
    background: #667eea;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    flex-shrink: 0;
}

.message-content-full {
    flex: 1;
}

.message-meta-full {
    display: flex;
    gap: 15px;
    margin-top: 10px;
    font-size: 0.9rem;
    color: #6c757d;
}

.message-meta-full .edited {
    background: #ff9800;
    color: white;
    padding: 2px 6px;
    border-radius: 8px;
    font-size: 0.7rem;
}

/* Ø§Ù„Ø­Ø±ÙƒØ§Øª ÙˆØ§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

@keyframes highlight {
    0% { background: linear-gradient(135deg, #fff3cd, #ffeaa7); }
    100% { background: linear-gradient(135deg, #f8f9fa, #e9ecef); }
}

/* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ */
@media (max-width: 768px) {
    .telegram-section-header {
        padding: 15px;
    }
    
    .section-title {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
    
    .stats-bar {
        gap: 20px;
    }
    
    .message-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }
    
    .message-meta {
        margin-left: 0;
    }
    
    .quick-actions {
        flex-direction: column;
    }
    
    .action-btn {
        justify-content: center;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-placeholder {
    text-align: center;
    padding: 40px;
    color: #6c757d;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠØ± */
.messages-container::-webkit-scrollbar {
    width: 8px;
}

.messages-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.messages-container::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 4px;
}

.messages-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #5a6fd8, #6a4190);
}
   
        /* ØªØ­Ø³ÙŠÙ† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ø¬ */
.mood-btn {
    transition: all 0.3s ease;
    transform: scale(1);
    position: relative;
    overflow: hidden;
}

.mood-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(255, 107, 157, 0.3);
}

.mood-btn.selected {
    background: linear-gradient(135deg, #ff6b9d, #c44569) !important;
    color: white !important;
    transform: scale(1.1);
    box-shadow: 0 10px 30px rgba(255, 107, 157, 0.5);
    animation: selectedPulse 2s ease-in-out infinite;
}

.mood-btn.selected::after {
    content: 'âœ“';
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255, 255, 255, 0.9);
    color: #ff6b9d;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: bold;
}

@keyframes selectedPulse {
    0%, 100% { box-shadow: 0 10px 30px rgba(255, 107, 157, 0.5); }
    50% { box-shadow: 0 15px 40px rgba(255, 107, 157, 0.7); }
}

/* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø²Ø§Ø¬ */
.mood-history-item {
    transition: all 0.3s ease;
}

.mood-history-item:hover {
    background: rgba(255, 255, 255, 0.2) !important;
    transform: translateX(5px);
}

/* ØªØ­Ø³ÙŠÙ† Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ø¬ */
.mood-message {
    background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(255, 192, 203, 0.1));
    border: 2px solid rgba(255, 107, 157, 0.2);
}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-pink: #ff6b9d;
            --light-pink: #ffc0cb;
            --soft-pink: #ffb3d1;
            --rose-gold: #f7cac9;
            --blush: #ffeef0;
            --white: #ffffff;
            --dark-pink: #e91e63;
            --gradient-1: linear-gradient(135deg, #ff6b9d, #ffc0cb);
            --gradient-2: linear-gradient(45deg, #ff9a9e, #fecfef);
            --gradient-3: linear-gradient(135deg, #f093fb, #f5576c);
            --shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
            --text-dark: #2c2c2c;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #ffeef0 0%, #fff0f5 50%, #ffe4e6 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="hearts" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><text x="10" y="15" text-anchor="middle" fill="%23ff6b9d" opacity="0.1" font-size="12">ğŸ’•</text></pattern></defs><rect width="100" height="100" fill="url(%23hearts)"/></svg>');
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .container {
            max-width: 414px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            min-height: 100vh;
            box-shadow: 0 0 50px rgba(255, 107, 157, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .header {
            background: var(--gradient-1);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.1) 10px,
                rgba(255, 255, 255, 0.1) 20px
            );
            animation: slide 15s linear infinite;
        }

        @keyframes slide {
            0% { transform: translateX(-50px); }
            100% { transform: translateX(50px); }
        }

        .header h1 {
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            position: relative;
            z-index: 2;
        }

        .floating-hearts {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .heart {
            position: absolute;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.5rem;
            animation: floatUp 6s ease-in-out infinite;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .nav-tabs {
            display: flex;
            background: white;
            box-shadow: 0 2px 10px rgba(255, 107, 157, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            color: var(--primary-pink);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.9rem;
        }

        .nav-tab.active {
            background: var(--gradient-1);
            color: white;
        }

        .nav-tab:hover {
            background: var(--blush);
        }

        .nav-tab.active:hover {
            background: var(--gradient-1);
        }

        .content {
            padding: 20px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 192, 203, 0.3);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.4);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-1);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark-pink);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .counter-display {
            text-align: center;
            padding: 30px;
            background: var(--gradient-2);
            border-radius: 20px;
            color: white;
            margin-bottom: 20px;
        }

        .counter-number {
            font-size: 3rem;
            font-weight: 700;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .counter-label {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .love-meter {
            background: var(--gradient-2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .meter-container {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            height: 20px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b9d, #ffffff);
            border-radius: 25px;
            width: 0%;
            transition: width 2s ease-in-out;
            position: relative;
        }

        .meter-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .weather-widget {
            background: var(--gradient-3);
            border-radius: 20px;
            padding: 25px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .weather-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .mood-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .mood-btn {
            background: white;
            border: 2px solid var(--light-pink);
            border-radius: 15px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }

        .mood-btn:hover, .mood-btn.selected {
            background: var(--gradient-1);
            color: white;
            transform: scale(1.1);
        }

        .quote-container {
            background: var(--blush);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-pink);
            position: relative;
        }

        .quote-text {
            font-style: italic;
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--text-dark);
        }

        .quote-author {
            text-align: left;
            margin-top: 10px;
            color: var(--dark-pink);
            font-weight: 600;
        }

        .memory-timeline {
            position: relative;
            padding-right: 30px;
        }

        .memory-timeline::before {
            content: '';
            position: absolute;
            right: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--gradient-1);
        }

        .memory-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.2);
        }

        .memory-item::after {
            content: '';
            position: absolute;
            right: -25px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: var(--primary-pink);
            border-radius: 50%;
            border: 3px solid white;
        }

        .memory-date {
            color: var(--dark-pink);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .memory-text {
            line-height: 1.6;
        }

        .interactive-game {
            background: var(--gradient-2);
            border-radius: 20px;
            padding: 25px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .game-cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-cell:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .music-player {
            background: var(--gradient-1);
            border-radius: 20px;
            padding: 25px;
            color: white;
            margin-bottom: 20px;
        }

        .music-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }

        .music-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .music-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .music-btn.play {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            height: 8px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: white;
            height: 100%;
            width: 0%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .calendar-widget {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: var(--primary-pink);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-nav:hover {
            background: var(--dark-pink);
            transform: scale(1.1);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .calendar-day:hover {
            background: var(--blush);
        }

        .calendar-day.today {
            background: var(--primary-pink);
            color: white;
        }

        .calendar-day.special {
            background: var(--gradient-1);
            color: white;
            position: relative;
        }

        .calendar-day.special::after {
            content: 'ğŸ’•';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 0.7rem;
        }

        .notification-center {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .notification {
            background: var(--blush);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-right: 4px solid var(--primary-pink);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--dark-pink);
            margin-bottom: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--gradient-2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .voice-message {
            background: var(--gradient-1);
            border-radius: 20px;
            padding: 25px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .voice-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            margin: 15px;
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .voice-btn.recording {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .surprise-box {
            background: var(--gradient-3);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            color: white;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .surprise-box:hover {
            transform: scale(1.05);
        }

        .surprise-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .footer {
            background: var(--gradient-1);
            padding: 30px 20px;
            text-align: center;
            color: white;
            margin-top: 40px;
        }

        .footer-heart {
            font-size: 2rem;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }

        .btn {
            background: var(--gradient-1);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary-pink);
            border: 2px solid var(--primary-pink);
        }

        .btn-secondary:hover {
            background: var(--primary-pink);
            color: white;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-pink);
            font-weight: 600;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light-pink);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary-pink);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--primary-pink);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gradient-1);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            .content {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .counter-number {
                font-size: 2.5rem;
            }
            
            .nav-tab {
                padding: 12px 8px;
                font-size: 0.8rem;
            }
        }

        .sparkle {
            position: absolute;
            color: var(--primary-pink);
            font-size: 1rem;
            animation: sparkle 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .typing-indicator {
            display: inline-block;
        }

        .typing-indicator span {
            display: inline-block;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="floating-hearts" id="floatingHearts"></div>
            <h1>ğŸ’• Ù„Ø­Ø¨ÙŠØ¨ØªÙŠ Ø§Ù„ØºØ§Ù„ÙŠØ© ğŸ’•</h1>
            <p class="subtitle">Ø£Ø¬Ù…Ù„ Ù…Ø§ ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø© Ù‡Ùˆ ÙˆØ¬ÙˆØ¯Ùƒ Ù…Ø¹ÙŠ</p>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('home')">
                <i class="fas fa-home"></i><br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
            <button class="nav-tab" onclick="showTab('memories')">
                <i class="fas fa-heart"></i><br>Ø°ÙƒØ±ÙŠØ§ØªÙ†Ø§
            </button>
            <button class="nav-tab" onclick="showTab('games')">
                <i class="fas fa-gamepad"></i><br>Ø£Ù„Ø¹Ø§Ø¨
            </button>
            <button class="nav-tab" onclick="showTab('tools')">
                <i class="fas fa-magic"></i><br>Ø£Ø¯ÙˆØ§Øª
            </button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Home Tab -->
            <div id="home" class="tab-content active">
                <!-- Love Counter -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-calendar-heart"></i>
                        Ø¹Ø¯Ø§Ø¯ Ø£ÙŠØ§Ù… Ø­Ø¨Ù†Ø§
                    </h3>
                    <div class="counter-display">
                        <div class="counter-number" id="daysCounter">0</div>
                        <div class="counter-label">ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø­Ø¨ ÙˆØ§Ù„Ø³Ø¹Ø§Ø¯Ø©</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="hoursCounter">0</div>
                            <div class="stat-label">Ø³Ø§Ø¹Ø©</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="minutesCounter">0</div>
                            <div class="stat-label">Ø¯Ù‚ÙŠÙ‚Ø©</div>
                        </div>
                    </div>
                </div>

                <!-- Love Meter -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-heart-pulse"></i>
                        Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø­Ø¨
                    </h3>
                    <div class="love-meter">
                        <h4>Ù…Ø³ØªÙˆÙ‰ Ø­Ø¨ÙŠ Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…</h4>
                        <div class="meter-container">
                            <div class="meter-fill" id="loveMeter"></div>
                        </div>
                        <p id="lovePercentage">100%</p>
                    </div>
                </div>

                <!-- Weather of Love -->
                <div class="weather-widget">
                    <h3><i class="fas fa-cloud-sun"></i> Ø·Ù‚Ø³ Ø§Ù„Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…</h3>
                    <div class="weather-icon" id="weatherIcon">â˜€ï¸</div>
                    <h4 id="weatherStatus">Ù…Ø´Ù…Ø³ Ù…Ø¹ Ù†Ø³Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø­Ø¨</h4>
                    <p id="weatherDesc">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©: â™¾ï¸ Ø¯Ø±Ø¬Ø© Ø­Ø¨</p>
                </div>

                <!-- Daily Quote -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-quote-right"></i>
                        Ø§Ù‚ØªØ¨Ø§Ø³ Ø§Ù„ÙŠÙˆÙ…
                    </h3>
                    <div class="quote-container">
                        <p class="quote-text" id="dailyQuote">
                            "Ø§Ù„Ø­Ø¨ Ù„ÙŠØ³ Ù…Ø¬Ø±Ø¯ Ø´Ø¹ÙˆØ±ØŒ Ø¨Ù„ Ù‡Ùˆ Ù‚Ø±Ø§Ø± Ù†ØªØ®Ø°Ù‡ ÙƒÙ„ ÙŠÙˆÙ… Ù„Ù†ÙƒÙˆÙ† Ù…Ø¹ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ Ù†Ø­Ø¨Ù‡"
                        </p>
                        <p class="quote-author">- Ø­Ù…Ø²Ø© Ø­Ø¨ÙŠØ¨Ùƒ</p>
                    </div>
                    <button class="btn" onclick="getNewQuote()">Ø§Ù‚ØªØ¨Ø§Ø³ Ø¬Ø¯ÙŠØ¯</button>
                </div>

                <!-- Mood Tracker -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-smile"></i>
                        ÙƒÙŠÙ Ù…Ø²Ø§Ø¬Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ
                    </h3>
                    <div class="mood-selector">
                        <div class="mood-btn" onclick="selectMood('happy', 'ğŸ˜Š')">ğŸ˜Š</div>
                        <div class="mood-btn" onclick="selectMood('love', 'ğŸ˜')">ğŸ˜</div>
                        <div class="mood-btn" onclick="selectMood('excited', 'ğŸ¤©')">ğŸ¤©</div>
                        <div class="mood-btn" onclick="selectMood('calm', 'ğŸ˜Œ')">ğŸ˜Œ</div>
                        <div class="mood-btn" onclick="selectMood('romantic', 'ğŸ¥°')">ğŸ¥°</div>
                        <div class="mood-btn" onclick="selectMood('dreamy', 'ğŸ˜´')">ğŸ˜´</div>
                        <div class="mood-btn" onclick="selectMood('playful', 'ğŸ˜œ')">ğŸ˜œ</div>
                        <div class="mood-btn" onclick="selectMood('grateful', 'ğŸ˜”')">ğŸ˜”</div>
                    </div>
                    <p id="moodMessage">Ø§Ø®ØªØ§Ø±ÙŠ Ù…Ø²Ø§Ø¬Ùƒ Ù„Ø£Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø§Ø³Ø¨Ø© ğŸ’•</p>
                </div>
            </div>

            <!-- Memories Tab -->
            <div id="memories" class="tab-content">
                <!-- Memory Timeline -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-timeline"></i>
                        Ø®Ø· Ø²Ù…Ù†ÙŠ Ù„Ø°ÙƒØ±ÙŠØ§ØªÙ†Ø§
                    </h3>
                    <div class="memory-timeline" id="memoryTimeline">
                        <!-- Memories will be loaded here -->
                    </div>
                    <button class="btn" onclick="addMemory()">Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>

                <!-- Special Dates Calendar -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-calendar-check"></i>
                        ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
                    </h3>
                    <div class="calendar-widget">
                        <div class="calendar-header">
                            <button class="calendar-nav" onclick="changeMonth(-1)">â€¹</button>
                            <h4 id="currentMonth">ÙŠÙ†Ø§ÙŠØ± 2024</h4>
                            <button class="calendar-nav" onclick="changeMonth(1)">â€º</button>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Calendar will be generated here -->
                        </div>
                    </div>
                </div>

                <!-- Love Letters -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-envelope-heart"></i>
                        Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø¨
                    </h3>
                    <div id="loveLetters">
                        <!-- Love letters will be displayed here -->
                    </div>
                    <button class="btn" onclick="writeLoveLetter()">ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ø­Ø¨</button>
                </div>
            </div>

            <!-- Games Tab -->
            <div id="games" class="tab-content">
                <!-- Love Quiz -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-question-circle"></i>
                        Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø¨
                    </h3>
                    <div id="quizContainer">
                        <p>ÙƒÙ… ØªØ¹Ø±ÙÙŠÙ† Ø¹Ù†ÙŠØŸ Ø§Ø®ØªØ¨Ø±ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ!</p>
                        <button class="btn" onclick="startQuiz()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
                    </div>
                </div>

                <!-- Memory Game -->
                <div class="interactive-game">
                    <h3><i class="fas fa-brain"></i> Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©</h3>
                    <p>Ø§Ø¹Ø«Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø©!</p>
                    <div class="game-grid" id="memoryGame">
                        <!-- Memory game grid will be generated here -->
                    </div>
                    <button class="btn btn-secondary" onclick="startMemoryGame()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>

                <!-- Love Calculator -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-calculator"></i>
                        Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø¨
                    </h3>
                    <div class="input-group">
                        <label>Ø§Ø³Ù…Ùƒ:</label>
                        <input type="text" id="name1" placeholder="Ø£Ø¯Ø®Ù„ÙŠ Ø§Ø³Ù…Ùƒ">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ø³Ù…ÙŠ:</label>
                        <input type="text" id="name2" placeholder="Ø£Ø¯Ø®Ù„ÙŠ Ø§Ø³Ù…ÙŠ">
                    </div>
                    <button class="btn" onclick="calculateLove()">Ø§Ø­Ø³Ø¨ÙŠ Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¨</button>
                    <div id="loveResult"></div>
                </div>

                <!-- Surprise Box -->
                <div class="surprise-box" onclick="openSurprise()">
                    <div class="surprise-icon">ğŸ</div>
                    <h3>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…ÙØ§Ø¬Ø¢Øª</h3>
                    <p>Ø§Ø¶ØºØ·ÙŠ Ù„ØªØ­ØµÙ„ÙŠ Ø¹Ù„Ù‰ Ù…ÙØ§Ø¬Ø£Ø©!</p>
                </div>
            </div>

            <!-- Tools Tab -->
            <div id="tools" class="tab-content">
                <!-- Music Player -->
                <div class="music-player">
                    <h3><i class="fas fa-music"></i> Ù…Ø´ØºÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©</h3>
                    <div id="currentSong">Ø£ØºÙ†ÙŠØ© Ø§Ù„Ø­Ø¨ Ø§Ù„Ø£ÙˆÙ„Ù‰</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="musicProgress"></div>
                    </div>
                    <div class="music-controls">
                        <button class="music-btn" onclick="previousSong()">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="music-btn play" onclick="togglePlay()" id="playBtn">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="music-btn" onclick="nextSong()">
                            <i class="fas fa-step-forward"></i>
                        </button>
                    </div>
                </div>

                <!-- Voice Messages -->
                <div class="voice-message">
                    <h3><i class="fas fa-microphone"></i> Ø±Ø³Ø§Ø¦Ù„ ØµÙˆØªÙŠØ©</h3>
                    <p>Ø³Ø¬Ù„ÙŠ Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ© Ù„ÙŠ ğŸ’•</p>
                    <button class="voice-btn" onclick="toggleRecording()" id="recordBtn">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <div id="voiceMessages">
                        <!-- Voice messages will be displayed here -->
                    </div>
                </div>

                <!-- Notification Center -->
                <div class="notification-center">
                    <h3 class="card-title">
                        <i class="fas fa-bell"></i>
                        Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    </h3>
                    <div id="notifications">
                        <!-- Notifications will be displayed here -->
                    </div>
                    <button class="btn" onclick="addReminder()">Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±</button>
                </div>
<div class="card">
    <h3 class="card-title">
        <i class="fab fa-telegram"></i>
        Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    </h3>
    <div class="telegram-setup">
        <p><strong>Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø§Ù„ÙŠÙ‡Ø§:</strong> Ø®Ø§Øµ </p>
        <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:</strong> <span id="connectionStatus">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span></p>
        
        <div class="button-group">
            <button class="btn" onclick="getChatId()">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID</button>
            <button class="btn" onclick="testTelegramConnection()">ØªØ­Ù‚ÙŠÙ‚ Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­</button>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <h4>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:</h4>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="sentCount">0</div>
                <div class="stat-label">Ø±Ø³Ø§Ù„Ø© Ù…Ø±Ø³Ù„Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failedCount">0</div>
                <div class="stat-label">Ø±Ø³Ø§Ù„Ø© ÙØ§Ø´Ù„Ø©</div>
            </div>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <button class="btn btn-secondary" onclick="showTelegramLogs()">Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>
        <button class="btn btn-secondary" onclick="clearTelegramLogs()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
    </div>
</div>
                <!-- Love Statistics -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-chart-heart"></i>
                        Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¨
                    </h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="messagesCount">âˆ</div>
                            <div class="stat-label"> ÙƒÙ„Ø§Ù… Ø­Ø¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="smilesCount">âˆ</div>
                            <div class="stat-label">Ø§Ø¨ØªØ³Ø§Ù…Ø©</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="hugsCount">12000</div>
                            <div class="stat-label">ÙˆØ³Ø§Ø¦Ø·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="kissesCount">290,000</div>
                            <div class="stat-label">Ø±Ø³Ø§Ù„Ø©</div>
                        </div>
                    </div>
                </div>

                <!-- Weather Forecast -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-cloud-sun"></i>
                        ØªÙˆÙ‚Ø¹Ø§Øª Ø·Ù‚Ø³ Ø§Ù„Ø­Ø¨
                    </h3>
                    <div id="weatherForecast">
                        <!-- Weather forecast will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-heart">ğŸ’•</div>
            <p>ØµÙÙ†Ø¹ Ø¨ÙƒÙ„ Ø§Ù„Ø­Ø¨ ÙˆØ§Ù„Ø´ÙˆÙ‚</p>
            <p>Ù„Ø£Ø¬Ù…Ù„ Ø­Ø¨ÙŠØ¨Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…</p>
            <div class="typing-indicator">
                <span>.</span><span>.</span><span>.</span>
            </div>
        </div>
      </div>
    <!-- Modals -->
    <div id="memoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('memoryModal')">&times;</span>
            <h3>Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <div class="input-group">
                <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                <input type="date" id="memoryDate">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø°ÙƒØ±Ù‰:</label>
                <textarea id="memoryText" rows="4" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ù„Ø°ÙƒØ±Ù‰ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©..."></textarea>
            </div>
            <button class="btn" onclick="saveMemory()">Ø­ÙØ¸ Ø§Ù„Ø°ÙƒØ±Ù‰</button>
        </div>
    </div>

    <div id="letterModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('letterModal')">&times;</span>
            <h3>ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ø­Ø¨</h3>
            <div class="input-group">
                <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
                <input type="text" id="letterTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                <textarea id="letterContent" rows="6" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø¨..."></textarea>
            </div>
            <button class="btn" onclick="saveLetter()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
        </div>
    </div>

    <div id="reminderModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('reminderModal')">&times;</span>
            <h3>Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±</h3>
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„ØªØ°ÙƒÙŠØ±:</label>
                <select id="reminderType">
                    <option value="daily">ÙŠÙˆÙ…ÙŠ</option>
                    <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                    <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                    <option value="special">Ù…Ù†Ø§Ø³Ø¨Ø© Ø®Ø§ØµØ©</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                <input type="text" id="reminderText" placeholder="Ù†Øµ Ø§Ù„ØªØ°ÙƒÙŠØ±">
            </div>
            <div class="input-group">
                <label>Ø§Ù„ÙˆÙ‚Øª:</label>
                <input type="time" id="reminderTime">
            </div>
            <button class="btn" onclick="saveReminder()">Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒÙŠØ±</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
    // Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø­Ø³Ù†Ø©
async function testTelegramConnection() {
    const statusElement = document.getElementById('connectionStatus');
    
    if (!statusElement) {
        console.log('Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        return;
    }
    
    statusElement.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
    statusElement.style.color = 'orange';
    
    try {
        // Ø£ÙˆÙ„Ø§Ù‹: Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨ÙˆØª
        const botInfoResponse = await fetch(`https://api.telegram.org/bot${TELEGRAM_CONFIG.BOT_TOKEN}/getMe`);
        const botInfo = await botInfoResponse.json();
        
        if (!botInfo.ok) {
            throw new Error('Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ­ÙŠØ­');
        }
        
        console.log('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨ÙˆØª:', botInfo.result);
        
        // Ø«Ø§Ù†ÙŠØ§Ù‹: Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID Ø§Ù„ØµØ­ÙŠØ­
        await getChatId();
        
        // Ø«Ø§Ù„Ø«Ø§Ù‹: Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±
        const testResult = await sendToTelegram(
            'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„', 
            'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ø¨ÙˆØª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­! ğŸ¤–âœ…\n\nØ¥Ø°Ø§ ÙˆØµÙ„ØªÙƒ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ ÙØ¥Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰', 
            'test'
        );
        
        if (testResult) {
            statusElement.textContent = 'Ù…ØªØµÙ„ âœ…';
            statusElement.style.color = 'green';
            showToast('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­! ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ğŸ“±');
        } else {
            throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
        statusElement.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„ âŒ';
        statusElement.style.color = 'red';
        showToast(`Ø®Ø·Ø£: ${error.message}`);
    }
    
    updateTelegramStats();
}

    // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID Ø§Ù„ØµØ­ÙŠØ­
async function getChatId() {
    try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_CONFIG.BOT_TOKEN}/getUpdates`);
        const data = await response.json();
        
        if (data.ok && data.result.length > 0) {
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©
            const lastMessage = data.result[data.result.length - 1];
            const chatId = lastMessage.message.chat.id;
            
            console.log('Chat ID Ø§Ù„Ù…ÙƒØªØ´Ù:', chatId);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            TELEGRAM_CONFIG.CHAT_ID = chatId.toString();
            
            showToast(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Chat ID: ${chatId}`);
            return chatId;
        } else {
            showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø³Ø§Ø¦Ù„. Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¨ÙˆØª Ø£ÙˆÙ„Ø§Ù‹!');
            return null;
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID:', error);
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID');
        return null;
    }
}

    
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
const TELEGRAM_CONFIG = {
    BOT_TOKEN: '7619744256:AAGlTErNoXyRAoBwNO0f8SNwDBzIA2y1Pws', // ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
    CHAT_ID: '7619744256',     // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (Ù†ÙØ³ ID Ø§Ù„Ø¨ÙˆØª Ù…Ø¤Ù‚ØªØ§Ù‹)
    enabled: true              // Ù…ÙØ¹Ù„
};

// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¹Ø¨Ø± ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
async function sendToTelegram(title, content, type = 'love_letter') {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©
    if (!TELEGRAM_CONFIG.enabled || !TELEGRAM_CONFIG.BOT_TOKEN || !TELEGRAM_CONFIG.CHAT_ID) {
        console.log('ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ØºÙŠØ± Ù…ÙØ¹Ù„ Ø£Ùˆ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø§Ù‚ØµØ©');
        return false;
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    let message = '';
    let emoji = '';
    
    switch(type) {
        case 'love_letter':
            emoji = 'ğŸ’Œ';
            message = `${emoji} Ø±Ø³Ø§Ù„Ø© Ø­Ø¨ Ø¬Ø¯ÙŠØ¯Ø© ${emoji}\n\n`;
            message += `ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${title}\n\n`;
            message += `ğŸ’• Ø§Ù„Ø±Ø³Ø§Ù„Ø©:\n${content}\n\n`;
            break;
            
        case 'memory':
            emoji = 'ğŸ’­';
            message = `${emoji} Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø© ${emoji}\n\n`;
            message += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${title}\n\n`;
            message += `ğŸ’– Ø§Ù„Ø°ÙƒØ±Ù‰:\n${content}\n\n`;
            break;
            
        case 'mood':
            emoji = 'ğŸ˜Š';
            message = `${emoji} ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø²Ø§Ø¬ ${emoji}\n\n`;
            message += `ğŸ­ Ø§Ù„Ù…Ø²Ø§Ø¬: ${title}\n`;
            message += `ğŸ’­ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${content}\n\n`;
            break;
            
        case 'test':
            emoji = 'ğŸ¤–';
            message = `${emoji} Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ ${emoji}\n\n`;
            message += `${content}\n\n`;
            break;
            
        default:
            emoji = 'ğŸ’•';
            message = `${emoji} Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ${emoji}\n\n${content}\n\n`;
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
    message += `â° Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleString('ar-SA', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    })}\n\n`;
    
    message += `ğŸ’– Ù…Ù† Ø­Ø¨ÙŠØ¨ØªÙƒ Ø§Ù„ØºØ§Ù„ÙŠØ© ğŸ’–`;

    // Ø±Ø§Ø¨Ø· API ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    const telegramURL = `https://api.telegram.org/bot${TELEGRAM_CONFIG.BOT_TOKEN}/sendMessage`;
    
    try {
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
        showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©... â³');
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
        const response = await fetch(telegramURL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                chat_id: TELEGRAM_CONFIG.CHAT_ID,
                text: message,
                parse_mode: 'HTML',
                disable_web_page_preview: true
            })
        });

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        if (response.ok) {
            const result = await response.json();
            if (result.ok) {
                showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ“±ğŸ’•');
                
                // Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                saveTelegramLog(title, content, type, 'success');
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ
                createSparkle();
                createSparkle();
                
                return true;
            } else {
                throw new Error(result.description || 'Ø®Ø·Ø£ Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…');
            }
        } else {
            throw new Error(`HTTP Error: ${response.status}`);
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ğŸ˜”');
        
        // Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø®Ø·Ø£
        saveTelegramLog(title, content, type, 'failed', error.message);
        
        return false;
    }
}

// Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
function saveTelegramLog(title, content, type, status, error = null) {
    const logs = JSON.parse(localStorage.getItem('telegramLogs') || '[]');
    logs.push({
        title,
        content: content.substring(0, 100) + '...', // Ø­ÙØ¸ Ø£ÙˆÙ„ 100 Ø­Ø±Ù ÙÙ‚Ø·
        type,
        status,
        error,
        timestamp: new Date().toISOString(),
        id: Date.now()
    });
    
    // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 50 Ø³Ø¬Ù„ ÙÙ‚Ø·
    if (logs.length > 50) {
        logs.splice(0, logs.length - 50);
    }
    
    localStorage.setItem('telegramLogs', JSON.stringify(logs));
}


        // Global Variables
        let currentTab = 'home';
        let loveStartDate = new Date('2023-06-2'); // ØªØºÙŠÙŠØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø­Ø³Ø¨ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let isPlaying = false;
        let isRecording = false;
        let currentSongIndex = 0;
        let memoryGameCards = [];
        let flippedCards = [];
        let gameScore = 0;

        // Love quotes array
        const loveQuotes = [
            "Ø§Ù„Ø­Ø¨ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø§Ù„Ø°ÙŠ ÙŠØ²Ø¯Ø§Ø¯ Ø¹Ù†Ø¯Ù…Ø§ Ù†Ù‚Ø³Ù…Ù‡",
            "Ø£Ù†Øª Ù„Ø³Øª Ù…Ø¬Ø±Ø¯ Ø­Ø¨ÙŠØ¨ØªÙŠØŒ Ø¨Ù„ Ø£Ù†Øª Ø­ÙŠØ§ØªÙŠ ÙƒÙ„Ù‡Ø§",
            "ÙÙŠ Ø¹ÙŠÙ†ÙŠÙƒ Ø£Ø±Ù‰ Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØŒ ÙˆÙÙŠ Ù‚Ù„Ø¨Ùƒ Ø£Ø¬Ø¯ Ø¨ÙŠØªÙŠ",
            "Ø§Ù„Ø­Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ø§ ÙŠØ¹Ø±Ù Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆÙ„Ø§ Ø§Ù„Ø²Ù…Ù†",
            "Ø£Ù†Øª Ø§Ù„Ø³Ø¨Ø¨ ÙÙŠ Ø£Ù† ÙƒÙ„ ÙŠÙˆÙ… ÙŠØ¨Ø¯Ùˆ ÙˆÙƒØ£Ù†Ù‡ Ø¹ÙŠØ¯",
            "Ø­Ø¨Ùƒ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø¹Ø§Ù„Ù… Ø£Ø¬Ù…Ù„ ÙˆØ§Ù„Ø­ÙŠØ§Ø© Ø£Ø­Ù„Ù‰",
            "ÙˆØ¬ÙˆØ¯Ùƒ Ù…Ù‡Ù… Ù„Ù„ØºØ§ÙŠØ© Ø£Ù†ØªÙŠ Ø§ÙƒØ³Ø¬ÙŠÙ†",
"Ø¨Ø§Ø°Ù† Ø§Ù„Ù„Ù‡ ØªÙƒÙˆÙ†ÙŠ Ù„ÙŠ ÙˆØ£Ù†Ø§ Ù„ÙƒÙ Ø£Ù†ØªÙŠ",
"Ù…Ù† Ø§Ø±ÙƒØ§Ù† Ø­ÙŠØ§ØªÙŠ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© ÙˆØ¬Ø¯Ø§Ù† Ø§Ù†ØªÙŠ Ø­Ø¨ÙŠØ¨ØªÙŠ",
            "Ù…Ø¹Ùƒ ØªØ¹Ù„Ù…Øª Ø£Ù† Ø§Ù„Ø­Ø¨ Ù„ÙŠØ³ Ù…Ø¬Ø±Ø¯ ÙƒÙ„Ù…Ø© Ø¨Ù„ Ø­ÙŠØ§Ø© ÙƒØ§Ù…Ù„Ø©"
        ];

        // Songs array
        const songs = [
            "Ø£ØºÙ†ÙŠØ© Ø§Ù„Ø­Ø¨ Ø§Ù„Ø£ÙˆÙ„Ù‰",
            "Ù„Ø­Ù† Ø§Ù„Ù‚Ù„ÙˆØ¨",
            "Ø³ÙŠÙ…ÙÙˆÙ†ÙŠØ© Ø§Ù„Ø¹Ø´Ù‚",
            "Ù†ØºÙ…Ø© Ø§Ù„Ø´ÙˆÙ‚",
            "Ø£Ù†Ø´ÙˆØ¯Ø© Ø§Ù„Ø­Ø¨"
        ];

        // Weather statuses
        const weatherStatuses = [
            { icon: "â˜€ï¸", status: "Ù…Ø´Ù…Ø³ Ù…Ø¹ Ù†Ø³Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø­Ø¨", desc: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©: â™¾ï¸ Ø¯Ø±Ø¬Ø© Ø­Ø¨" },
            { icon: "ğŸŒ™", status: "Ù„ÙŠÙ„Ø© Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© ØªØ­Øª Ø§Ù„Ù†Ø¬ÙˆÙ…", desc: "Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©: 100%" },
            { icon: "ğŸŒˆ", status: "Ù‚ÙˆØ³ Ù‚Ø²Ø­ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø¹Ø±", desc: "Ø§Ù„Ø±Ø·ÙˆØ¨Ø©: Ù…Ø´Ø¨Ø¹Ø© Ø¨Ø§Ù„Ø­Ø¨" },
            { icon: "ğŸ’«", status: "Ø¹Ø§ØµÙØ© Ù…Ù† Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ø£Ø­Ù„Ø§Ù…", desc: "Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­: Ù†Ø³ÙŠÙ… Ø§Ù„Ø­Ù†Ø§Ù†" },
            { icon: "ğŸŒ¸", status: "Ø±Ø¨ÙŠØ¹ Ø¯Ø§Ø¦Ù… ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨", desc: "Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠ: Ù…Ø±ØªÙØ¹ Ø¨Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©" }
        ];

        // Mood messages
        const moodMessages = {
            happy: "Ø³Ø¹ÙŠØ¯Ø© Ø£Ù†Ùƒ Ø³Ø¹ÙŠØ¯Ø©! Ø§Ø¨ØªØ³Ø§Ù…ØªÙƒ ØªØ¶ÙŠØ¡ ÙŠÙˆÙ…ÙŠ ğŸ˜Š",
            love: "Ø£Ø­Ø¨Ùƒ Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ØªØªØ®ÙŠÙ„ÙŠÙ†! ğŸ˜ğŸ’•",
            excited: "Ø­Ù…Ø§Ø³Ùƒ Ù…Ø¹Ø¯ÙŠ! Ø¯Ø¹ÙŠÙ†Ø§ Ù†ØµÙ†Ø¹ Ø°ÙƒØ±ÙŠØ§Øª Ø¬Ù…ÙŠÙ„Ø© ğŸ¤©",
            calm: "Ø§Ù„Ù‡Ø¯ÙˆØ¡ Ù…Ø¹Ùƒ Ø£Ø¬Ù…Ù„ Ø´Ø¹ÙˆØ± ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… ğŸ˜Œ",
            romantic: "Ø£Ù†Øª ÙÙŠ Ù…Ø²Ø§Ø¬ Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØŸ Ø£Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹! ğŸ¥°",
            dreamy: "Ø£Ø­Ù„Ø§Ù… Ø³Ø¹ÙŠØ¯Ø© ÙŠØ§ Ø­Ø¨ÙŠØ¨ØªÙŠ ğŸ˜´ğŸ’¤",
            playful: "Ø£Ø­Ø¨ Ø±ÙˆØ­Ùƒ Ø§Ù„Ù…Ø±Ø­Ø©! ğŸ˜œğŸ‰",
            grateful: "Ø­Ø¨ÙŠØ¨Ùƒ Ù…Ø¹Ùƒ Ù„Ø§  ØªØ­Ø²Ù†ÙŠ Ø­Ø¨ÙŠØ¨ØªÙŠ"
        };

        // Quiz questions
        const quizQuestions = [
            {
                question: "Ø§ÙƒÙ„Ø© Ø§Ø´ØªÙŠÙ‡Ø§ Ù…Ù† ÙŠØ¯Ùƒ",
                options: ["Ø¯Ø¬Ø§Ø¬", "Ø§ÙŠ Ø´ÙŠ Ø§Ù„Ù…Ù‡Ù… Ù…Ù†Ùƒ", "Ø®Ø¨Ø²", "Ø³Ù…Ùƒ"],
                correct: 1
            },
            {
                question: "Ø§ÙŠØ´ Ø§ÙƒØ«Ø± Ø´ÙŠ ÙŠØ¹Ø¬Ø¨Ù†Ø§ ÙÙŠÙƒ",
                options: ["Ø¬Ù…Ø§Ù„ÙŠ", "ØµÙˆØªÙŠ", "ÙƒÙ„ Ø´ÙŠ", "Ø§Ù†Ø§Ù‚ØªÙŠ"],
                correct: 2
            },
            {
                question: "Ø´ÙŠ Ø§ØªÙ…Ù†Ø§Ù‡ Ù…Ù†Ùƒ",
                options: ["Ù‚Ø±Ø¨Ùƒ", "ØµÙˆØªÙƒ", "ÙƒÙ„Ø§Ù…Ùƒ", "Ø§ØªÙ…Ù†Ù‰ ÙˆØ¬Ø¯Ø§Ù†"],
                correct: 3
            }
        ];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            startCounters();
            generateCalendar();
            loadMemories();
            loadLoveLetters();
            loadNotifications();
            createFloatingHearts();
            updateWeather();
            animateLoveMeter();
            loadWeatherForecast();
            startMemoryGame();
        });

        function initializeApp() {
            // Set initial love meter
            setTimeout(() => {
                document.getElementById('loveMeter').style.width = '100%';
            }, 1000);

            // Add sparkle effects
            setInterval(createSparkle, 2000);

            // Update statistics
            updateStatistics();
        }

        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Update nav buttons
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));
            event.target.closest('.nav-tab').classList.add('active');

            currentTab = tabName;
        }

        function startCounters() {
            function updateCounters() {
                const now = new Date();
                const diff = now - loveStartDate;
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

                document.getElementById('daysCounter').textContent = days;
                document.getElementById('hoursCounter').textContent = hours;
                document.getElementById('minutesCounter').textContent = minutes;
            }

            updateCounters();
            setInterval(updateCounters, 60000); // Update every minute
        }

        function animateLoveMeter() {
            const meter = document.getElementById('loveMeter');
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                } else {
                    width++;
                    meter.style.width = width + '%';
                }
            }, 20);
        }

        function getNewQuote() {
            const randomQuote = loveQuotes[Math.floor(Math.random() * loveQuotes.length)];
            document.getElementById('dailyQuote').textContent = randomQuote;
            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³! ğŸ’•');
        }

        function selectMood(mood, emoji) {
            // Remove previous selection
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Add selection to clicked button
            event.target.classList.add('selected');

            // Update mood message
            document.getElementById('moodMessage').textContent = moodMessages[mood];
            
            showToast(`Ù…Ø²Ø§Ø¬Ùƒ! ${emoji}`);
        }

        function updateWeather() {
            const randomWeather = weatherStatuses[Math.floor(Math.random() * weatherStatuses.length)];
            document.getElementById('weatherIcon').textContent = randomWeather.icon;
            document.getElementById('weatherStatus').textContent = randomWeather.status;
            document.getElementById('weatherDesc').textContent = randomWeather.desc;
        }

    function generateCalendar() {
    const monthNames = [
        'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
        'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
    ];

    // Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù…Ø¹ 3 Ù…Ù†Ø§Ø³Ø¨Ø§Øª ÙÙ‚Ø·
    const specialEvents = {
        // Ø°ÙƒØ±ÙŠØ§Øª Ø´Ø®ØµÙŠØ©
        personal: {
            '5-5': { message: 'Ù…ÙŠÙ„Ø§Ø¯ Ø­Ø¨ÙŠØ¨Ùƒ', emoji: 'ğŸ’•' }
        },
        // Ø£Ø¹ÙŠØ§Ø¯ ÙˆÙ…Ù†Ø§Ø³Ø¨Ø§Øª
        holidays: {
            '5-2': { message: 'Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø¨', emoji: 'ğŸ’–' }
        },
        // Ø£Ø¹ÙŠØ§Ø¯ Ù…ÙŠÙ„Ø§Ø¯
        birthdays: {
            '2-25': { message: 'Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ', emoji: 'ğŸ‚' }
        }
    };

    document.getElementById('currentMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;

    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    const today = new Date();

    const calendarGrid = document.getElementById('calendarGrid');
    calendarGrid.innerHTML = '';

    // Add day headers
    const dayHeaders = ['Ø£Ø­', 'Ø¥Ø«', 'Ø«', 'Ø£Ø±', 'Ø®', 'Ø¬', 'Ø³'];
    dayHeaders.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.textContent = day;
        dayHeader.style.fontWeight = 'bold';
        dayHeader.style.color = 'var(--primary-pink)';
        dayHeader.style.padding = '10px 5px';
        dayHeader.style.textAlign = 'center';
        calendarGrid.appendChild(dayHeader);
    });

    // Add empty cells for days before month starts
    for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day';
        calendarGrid.appendChild(emptyDay);
    }

    // Add days of the month
    for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
        const dateKey = `${currentMonth}-${day}`;
        let isSpecial = false;
        let eventInfo = null;
        let eventType = '';

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª
        if (specialEvents.personal[dateKey]) {
            isSpecial = true;
            eventInfo = specialEvents.personal[dateKey];
            eventType = 'personal';
        } else if (specialEvents.holidays[dateKey]) {
            isSpecial = true;
            eventInfo = specialEvents.holidays[dateKey];
            eventType = 'holiday';
        } else if (specialEvents.birthdays[dateKey]) {
            isSpecial = true;
            eventInfo = specialEvents.birthdays[dateKey];
            eventType = 'birthday';
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù…ÙŠØ²Ø©
        if (isSpecial) {
            dayElement.classList.add('special', eventType);
            dayElement.title = `${eventInfo.emoji} ${eventInfo.message}`;
            dayElement.innerHTML = `
                <div style="font-weight: bold;">${day}</div>
                <div style="font-size: 0.8rem; margin-top: 2px;">${eventInfo.emoji}</div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ù†Ø¨Ø¶Ø© Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù…ÙŠØ²Ø©
            dayElement.style.animation = 'heartbeat 2s ease-in-out infinite';
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø©
            dayElement.addEventListener('click', () => {
                showToast(`${eventInfo.emoji} ${eventInfo.message}`);
                createSparkle();
            });
        } else {
            dayElement.textContent = day;
        }

        // Mark today
        if (currentYear === today.getFullYear() && 
            currentMonth === today.getMonth() && 
            day === today.getDate()) {
            dayElement.classList.add('today');
            if (!isSpecial) {
                dayElement.style.background = 'var(--primary-pink)';
                dayElement.style.color = 'white';
            }
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
        if (!isSpecial) {
            dayElement.addEventListener('mouseenter', () => {
                dayElement.style.background = 'var(--blush)';
                dayElement.style.transform = 'scale(1.1)';
            });
            
            dayElement.addEventListener('mouseleave', () => {
                if (!dayElement.classList.contains('today')) {
                    dayElement.style.background = '';
                }
                dayElement.style.transform = 'scale(1)';
            });
        }

        calendarGrid.appendChild(dayElement);
    }
}


        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();
        }

        function addMemory() {
            document.getElementById('memoryModal').style.display = 'block';
        }

        function saveMemory() {
            const date = document.getElementById('memoryDate').value;
            const text = document.getElementById('memoryText').value;

            if (date && text) {
                const memories = JSON.parse(localStorage.getItem('memories') || '[]');
                memories.push({ date, text, id: Date.now() });
                localStorage.setItem('memories', JSON.stringify(memories));
                
                loadMemories();
                closeModal('memoryModal');
                showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø°ÙƒØ±Ù‰ Ø¨Ù†Ø¬Ø§Ø­! ğŸ’•');
                
                // Clear form
                document.getElementById('memoryDate').value = '';
                document.getElementById('memoryText').value = '';
            }
        }

        function loadMemories() {
            const memories = JSON.parse(localStorage.getItem('memories') || '[]');
            const timeline = document.getElementById('memoryTimeline');
            
            timeline.innerHTML = '';
            
            memories.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(memory => {
                const memoryItem = document.createElement('div');
                memoryItem.className = 'memory-item';
                memoryItem.innerHTML = `
                    <div class="memory-date">${formatDate(memory.date)}</div>
                    <div class="memory-text">${memory.text}</div>
                `;
                timeline.appendChild(memoryItem);
            });

            if (memories.length === 0) {
                timeline.innerHTML = '<p style="text-align: center; color: var(--primary-pink);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø°ÙƒØ±ÙŠØ§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø¦ÙŠ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø°ÙƒØ±Ù‰! ğŸ’•</p>';
            }
        }

        function writeLoveLetter() {
            document.getElementById('letterModal').style.display = 'block';
        }

async function saveLetter() {
    const title = document.getElementById('letterTitle').value.trim();
    const content = document.getElementById('letterContent').value.trim();

    if (!title || !content) {
        showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„! ğŸ“');
        return;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    if (content.length > 4000) {
        showToast('Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹! ÙŠØ±Ø¬Ù‰ ØªÙ‚ØµÙŠØ±Ù‡Ø§ ğŸ“');
        return;
    }

    try {
        // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹
        const letters = JSON.parse(localStorage.getItem('loveLetters') || '[]');
        const newLetter = { 
            title, 
            content, 
            date: new Date().toISOString(),
            id: Date.now(),
            sent: false // Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        };
        
        letters.push(newLetter);
        localStorage.setItem('loveLetters', JSON.stringify(letters));
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
        const sent = await sendToTelegram(title, content, 'love_letter');
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        if (sent) {
            newLetter.sent = true;
            localStorage.setItem('loveLetters', JSON.stringify(letters));
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        loadLoveLetters();
        closeModal('letterModal');
        
        // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
        if (sent) {
            showToast('ØªÙ… Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø¨! ğŸ’Œâœ¨');
        } else {
            showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· ğŸ’¾');
        }
        
        // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('letterTitle').value = '';
        document.getElementById('letterContent').value = '';
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ğŸ˜”');
    }
}

        function loadLoveLetters() {
            const letters = JSON.parse(localStorage.getItem('loveLetters') || '[]');
            const container = document.getElementById('loveLetters');
            
            container.innerHTML = '';
            
            letters.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(letter => {
                const letterElement = document.createElement('div');
                letterElement.className = 'quote-container';
                letterElement.style.marginBottom = '15px';
                letterElement.innerHTML = `
                    <h4 style="color: var(--dark-pink); margin-bottom: 10px;">${letter.title}</h4>
                    <p class="quote-text">${letter.content}</p>
                    <p class="quote-author">- ${formatDate(letter.date)}</p>
                `;
                container.appendChild(letterElement);
            });

            if (letters.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--primary-pink);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø­Ø¨ Ø¨Ø¹Ø¯. Ø§ÙƒØªØ¨ÙŠ Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø©! ğŸ’Œ</p>';
            }
        }

        function startQuiz() {
            let currentQuestion = 0;
            let score = 0;

            function showQuestion() {
                if (currentQuestion < quizQuestions.length) {
                    const question = quizQuestions[currentQuestion];
                    const container = document.getElementById('quizContainer');
                    
                    container.innerHTML = `
                        <h4>Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestion + 1} Ù…Ù† ${quizQuestions.length}</h4>
                        <p>${question.question}</p>
                        <div style="margin: 20px 0;">
                            ${question.options.map((option, index) => 
                                `<button class="btn btn-secondary" style="display: block; width: 100%; margin: 10px 0;" onclick="answerQuestion(${index})">${option}</button>`
                            ).join('')}
                        </div>
                    `;
                } else {
                    // Show results
                    const container = document.getElementById('quizContainer');
                    const percentage = (score / quizQuestions.length) * 100;
                    let message = '';
                    
                    if (percentage >= 80) {
                        message = 'Ù…Ù…ØªØ§Ø²! ØªØ¹Ø±ÙÙŠÙ†Ù†ÙŠ Ø¬ÙŠØ¯Ø§Ù‹ Ø¬Ø¯Ø§Ù‹! ğŸ’•';
                    } else if (percentage >= 60) {
                        message = 'Ø¬ÙŠØ¯! Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù†ÙŠ ğŸ˜Š';
                    } else {
                        message = 'Ø±ÙƒØ²Ø²ÙŠ ÙÙŠ Ø§Ù„Ø§Ø³Ø¦Ù„Ø©';
                    }
                    
                    container.innerHTML = `
                        <h4>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h4>
                        <div class="counter-display">
                            <div class="counter-number">${percentage}%</div>
                            <div class="counter-label">${message}</div>
                        </div>
                        <button class="btn" onclick="startQuiz()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
                    `;
                }
            }

            window.answerQuestion = function(selectedIndex) {
                if (selectedIndex === quizQuestions[currentQuestion].correct) {
                    score++;
                    showToast('Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ğŸ‰');
                } else {
                    showToast('Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© ğŸ˜…');
                }
                currentQuestion++;
                setTimeout(showQuestion, 1000);
            };

            showQuestion();
        }

        function startMemoryGame() {
            const gameGrid = document.getElementById('memoryGame');
            const symbols = ['ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’˜', 'ğŸ’', 'ğŸ’', 'ğŸ’Ÿ', 'â¤ï¸'];
            const cards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);
            
            gameGrid.innerHTML = '';
            memoryGameCards = [];
            flippedCards = [];
            gameScore = 0;

            cards.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.className = 'game-cell';
                card.dataset.symbol = symbol;
                card.dataset.index = index;
                card.textContent = 'ğŸ’­';
                card.onclick = () => flipCard(card);
                gameGrid.appendChild(card);
                memoryGameCards.push(card);
            });
        }

        function flipCard(card) {
            if (flippedCards.length < 2 && !card.classList.contains('flipped')) {
                card.textContent = card.dataset.symbol;
                card.classList.add('flipped');
                flippedCards.push(card);

                if (flippedCards.length === 2) {
                    setTimeout(checkMatch, 1000);
                }
            }
        }

        function checkMatch() {
            const [card1, card2] = flippedCards;
            
            if (card1.dataset.symbol === card2.dataset.symbol) {
                card1.style.background = 'var(--gradient-1)';
                card2.style.background = 'var(--gradient-1)';
                gameScore++;
                showToast('ØªØ·Ø§Ø¨Ù‚ Ø±Ø§Ø¦Ø¹! ğŸ’•');
                
                if (gameScore === 8) {
                    setTimeout(() => showToast('Ù…Ø¨Ø±ÙˆÙƒ! Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! ğŸ‰'), 500);
                }
            } else {
                card1.textContent = 'ğŸ’­';
                card2.textContent = 'ğŸ’­';
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
            }
            
            flippedCards = [];
        }

      function calculateLove() {
    const name1 = document.getElementById('name1').value.trim();
    const name2 = document.getElementById('name2').value.trim();
    
    // Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (ØºÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡)
    const herName = "ÙˆØ¬Ø¯Ø§Ù†"; // Ø§Ø³Ù… Ø­Ø¨ÙŠØ¨ØªÙƒ
    const myName = "Ø­Ù…Ø²Ø©";   // Ø§Ø³Ù…Ùƒ
    
    if (!name1 || !name2) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…ÙŠÙ†!');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
    const isCorrectCombination = 
        (name1.toLowerCase() === herName.toLowerCase() && name2.toLowerCase() === myName.toLowerCase()) ||
        (name1.toLowerCase() === myName.toLowerCase() && name2.toLowerCase() === herName.toLowerCase());
    
    if (isCorrectCombination) {
        // Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ØµØ­ÙŠØ­Ø© - Ù†Ø³Ø¨Ø© Ù…Ø«Ø§Ù„ÙŠØ©
        const percentage = 100;
        
        document.getElementById('loveResult').innerHTML = `
            <div class="counter-display" style="margin-top: 20px;">
                <div class="counter-number">${percentage}%</div>
                <div class="counter-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¨ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©</div>
                <p style="margin-top: 15px;">ğŸ’• Ø­Ø¨ Ø£Ø¨Ø¯ÙŠ ÙˆØ­Ù‚ÙŠÙ‚ÙŠ! ğŸ’•</p>
                <p style="color: white; opacity: 0.9;">Ø£Ù†ØªÙ…Ø§ Ø±ÙˆØ­Ø§Ù† ÙÙŠ Ø¬Ø³Ø¯ÙŠÙ† </p>
                <div style="margin-top: 15px; font-size: 2rem;">HğŸ’W</div>
            </div>
        `;
        
        showToast('Ø­Ø¨ Ù…Ø«Ø§Ù„ÙŠ 100%! ğŸ’•ğŸ‘‘');
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ©
        createSparkle();
        setTimeout(createSparkle, 500);
        setTimeout(createSparkle, 1000);
        
    } else {
        // Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø®Ø§Ø·Ø¦Ø©
        const percentage = Math.floor(Math.random() * 40) + 20; // 20-60%
        
        document.getElementById('loveResult').innerHTML = `
            <div class="counter-display" style="margin-top: 20px;">
                <div class="counter-number">${percentage}%</div>
                <div class="counter-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¨</div>
                <p style="margin-top: 15px;">ğŸ¤” Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ Ù…Ø§!</p>
                <p style="color: white; opacity: 0.9;">
                    ØªØ£ÙƒØ¯ÙŠ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ ÙˆØ§Ø³Ù…ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙŠØ§ Ø­Ø¨ÙŠØ¨ØªÙŠ ğŸ˜˜
                </p>
                <p style="color: white; opacity: 0.8; font-size: 0.9rem; margin-top: 10px;">
                    ØªÙ„Ù…ÙŠØ­: Ø§Ø³Ù…Ùƒ ÙŠØ¨Ø¯Ø£ Ø¨Ø­Ø±Ù "${herName.charAt(0)}" ÙˆØ§Ø³Ù…ÙŠ ÙŠØ¨Ø¯Ø£ Ø¨Ø­Ø±Ù "${myName.charAt(0)}" ğŸ˜‰
                </p>
            </div>
        `;
        
        showToast('Ø¬Ø±Ø¨ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! ğŸ˜‰ğŸ’•');
    }
}


        function openSurprise() {
            const surprises = [
                "ğŸŒ¹ ÙˆØ±Ø¯Ø© Ø­Ù…Ø±Ø§Ø¡ Ù„Ø£Ø¬Ù…Ù„ Ø­Ø¨ÙŠØ¨Ø©",
                "ğŸ« Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø­Ù„ÙˆØ© Ù…Ø«Ù„Ùƒ",
                "â­ Ù†Ø¬Ù…Ø© Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø¡ Ù„Ùƒ",
                "ğŸ¦‹ ÙØ±Ø§Ø´Ø© Ø¬Ù…ÙŠÙ„Ø© Ù…Ø«Ù„ Ø±ÙˆØ­Ùƒ",
                "ğŸŒ™ Ù‚Ù…Ø± ÙŠÙ†ÙŠØ± Ù„ÙŠÙ„Ùƒ",
                "ğŸ’ Ø¬ÙˆÙ‡Ø±Ø© Ø«Ù…ÙŠÙ†Ø© Ù…Ø«Ù„ Ù‚Ù„Ø¨Ùƒ",
                "ğŸŒº Ø²Ù‡Ø±Ø© Ø¹Ø·Ø±Ø© Ù„Ø­Ø¨ÙŠØ¨ØªÙŠ",
                "ğŸ«€ Ù‚Ù„Ø¨ÙŠ Ù„Ùƒ Ø£Ù†ØªÙŠ ÙˆØ­Ø¯Ùƒ "
            ];
            
            const randomSurprise = surprises[Math.floor(Math.random() * surprises.length)];
            showToast(randomSurprise);
            
            // Add sparkle effect
            createSparkle();
        }

        function togglePlay() {
            const playBtn = document.getElementById('playBtn');
            const icon = playBtn.querySelector('i');
            
            if (isPlaying) {
                icon.className = 'fas fa-play';
                isPlaying = false;
                showToast('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰');
            } else {
                icon.className = 'fas fa-pause';
                isPlaying = true;
                showToast('ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© ğŸµ');
                animateProgress();
            }
        }

        function animateProgress() {
            if (isPlaying) {
                const progress = document.getElementById('musicProgress');
                let width = 0;
                const interval = setInterval(() => {
                    if (width >= 100 || !isPlaying) {
                        clearInterval(interval);
                        if (width >= 100) {
                            nextSong();
                        }
                    } else {
                        width += 0.5;
                        progress.style.width = width + '%';
                    }
                }, 100);
            }
        }

        function nextSong() {
            currentSongIndex = (currentSongIndex + 1) % songs.length;
            document.getElementById('currentSong').textContent = songs[currentSongIndex];
            document.getElementById('musicProgress').style.width = '0%';
            showToast(`Ø§Ù„Ø¢Ù†: ${songs[currentSongIndex]} ğŸµ`);
            
            if (isPlaying) {
                animateProgress();
            }
        }

        function previousSong() {
            currentSongIndex = currentSongIndex === 0 ? songs.length - 1 : currentSongIndex - 1;
            document.getElementById('currentSong').textContent = songs[currentSongIndex];
            document.getElementById('musicProgress').style.width = '0%';
            showToast(`Ø§Ù„Ø¢Ù†: ${songs[currentSongIndex]} ğŸµ`);
            
            if (isPlaying) {
                animateProgress();
            }
        }

        function toggleRecording() {
            const recordBtn = document.getElementById('recordBtn');
            const icon = recordBtn.querySelector('i');
            
            if (isRecording) {
                icon.className = 'fas fa-microphone';
                recordBtn.classList.remove('recording');
                isRecording = false;
                showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙˆØªÙŠØ©! ğŸ’•');
                addVoiceMessage();
            } else {
                icon.className = 'fas fa-stop';
                recordBtn.classList.add('recording');
                isRecording = true;
                showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... ğŸ¤');
            }
        }

        function addVoiceMessage() {
            const container = document.getElementById('voiceMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'notification';
            messageDiv.innerHTML = `
                <div class="notification-time">${new Date().toLocaleTimeString('ar-SA')}</div>
                <div>Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© ğŸ¤ğŸ’•</div>
                <button class="btn btn-secondary" style="margin-top: 10px;">ØªØ´ØºÙŠÙ„</button>
            `;
            container.appendChild(messageDiv);
        }

        function addReminder() {
            document.getElementById('reminderModal').style.display = 'block';
        }

        function saveReminder() {
            const type = document.getElementById('reminderType').value;
            const text = document.getElementById('reminderText').value;
            const time = document.getElementById('reminderTime').value;

            if (text && time) {
                const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
                reminders.push({ 
                    type, 
                    text, 
                    time, 
                    date: new Date().toISOString(),
                    id: Date.now() 
                });
                localStorage.setItem('reminders', JSON.stringify(reminders));
                
                loadNotifications();
                closeModal('reminderModal');
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙƒÙŠØ±! â°');
                
                // Clear form
                document.getElementById('reminderText').value = '';
                document.getElementById('reminderTime').value = '';
            }
        }

        function loadNotifications() {
            const notifications = document.getElementById('notifications');
            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            
            // Add some default notifications
            const defaultNotifications = [
                { text: 'Ù„Ø§ ØªÙ†Ø³ÙŠ Ø£Ù† ØªØ¨ØªØ³Ù…ÙŠ Ø§Ù„ÙŠÙˆÙ…! ğŸ˜Š', time: new Date().toLocaleTimeString('ar-SA') },
                { text: 'Ø£Ø­Ø¨Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ø£Ù…Ø³ ÙˆÙƒÙ„ ÙŠÙˆÙ… Ø£ÙƒØ«Ø±  ğŸ’•', time: new Date().toLocaleTimeString('ar-SA') },
                { text: 'Ø£Ù†Øª Ø£Ø¬Ù…Ù„ Ù…Ø§ ÙÙŠ Ø­ÙŠØ§ØªÙŠ ğŸŒ¹', time: new Date().toLocaleTimeString('ar-SA') }
            ];
            
            notifications.innerHTML = '';
            
            [...defaultNotifications, ...reminders].forEach(notification => {
                const notificationDiv = document.createElement('div');
                notificationDiv.className = 'notification';
                notificationDiv.innerHTML = `
                    <div class="notification-time">${notification.time}</div>
                    <div>${notification.text}</div>
                `;
                notifications.appendChild(notificationDiv);
            });
        }

        function updateStatistics() {
            // Animate statistics with random increments
            const stats = ['messagesCount', 'hugsCount', 'kissesCount'];
            stats.forEach(statId => {
                const element = document.getElementById(statId);
                if (element && element.textContent !== 'âˆ') {
                    const currentValue = parseInt(element.textContent.replace(',', ''));
                    const increment = Math.floor(Math.random() * 5) + 1;
                    element.textContent = (currentValue + increment).toLocaleString();
                }
            });
        }

        function loadWeatherForecast() {
            const forecast = document.getElementById('weatherForecast');
            const days = ['Ø§Ù„ÙŠÙˆÙ…', 'ØºØ¯Ø§Ù‹', 'Ø¨Ø¹Ø¯ ØºØ¯', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];
            const conditions = ['â˜€ï¸ Ù…Ø´Ù…Ø³', 'ğŸŒ™ Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ', 'ğŸ’« Ø³Ø§Ø­Ø±', 'ğŸŒˆ Ù…Ù„ÙˆÙ†', 'ğŸŒ¸ Ø¬Ù…ÙŠÙ„'];
            
            forecast.innerHTML = '';
            
            days.forEach((day, index) => {
                const dayForecast = document.createElement('div');
                dayForecast.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 10px;
                    margin: 5px 0;
                    background: var(--blush);
                    border-radius: 10px;
                `;
                
                dayForecast.innerHTML = `
                    <span>${day}</span>
                    <span>${conditions[index]}</span>
                    <span>â™¾ï¸Â°</span>
                `;
                
                forecast.appendChild(dayForecast);
            });
        }

        function createFloatingHearts() {
            const container = document.getElementById('floatingHearts');
            
            setInterval(() => {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.textContent = ['ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’˜'][Math.floor(Math.random() * 4)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
                
                container.appendChild(heart);
                
                setTimeout(() => {
                    heart.remove();
                }, 6000);
            }, 2000);
        }

        function createSparkle() {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.textContent = 'âœ¨';
            sparkle.style.left = Math.random() * window.innerWidth + 'px';
            sparkle.style.top = Math.random() * window.innerHeight + 'px';
            
            document.body.appendChild(sparkle);
            
            setTimeout(() => {
                sparkle.remove();
            }, 2000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };

        // Update statistics periodically
        setInterval(updateStatistics, 30000); // Every 30 seconds

        // Update weather periodically
        setInterval(updateWeather, 300000); // Every 5 minutes

        // Auto-save functionality
        setInterval(() => {
            const currentData = {
                lastVisit: new Date().toISOString(),
                totalVisits: (parseInt(localStorage.getItem('totalVisits')) || 0) + 1
            };
            localStorage.setItem('appData', JSON.stringify(currentData));
        }, 60000); // Every minute
        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„
let telegramSystem = null;
let telegramUI = null;

// Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(async () => {
        try {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„...');
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            telegramSystem = new TelegramMessageSystem();
            
            // Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
            await new Promise(resolve => {
                telegramSystem.on('system:initialized', resolve);
                setTimeout(resolve, 10000); // Ø­Ø¯ Ø£Ù‚ØµÙ‰ 10 Ø«ÙˆØ§Ù†
            });
            
            // ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            telegramUI = telegramSystem.uiManager;
            
            // Ø¥ØªØ§Ø­Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©
            window.telegramUI = telegramUI;
            
            console.log('âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            
        } catch (error) {
            console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
        }
    }, 2000);
});

// ØªÙ†Ø¸ÙŠÙ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('beforeunload', function() {
    if (telegramSystem) {
        telegramSystem.cleanup();
    }
});

// Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø©
document.addEventListener('visibilitychange', function() {
    if (!document.hidden && telegramSystem) {
        telegramSystem.reconnect();
    }
});
/**
 * Ù…Ø¯ÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
 */
class UIManager {
    constructor(messageSystem) {
        this.messageSystem = messageSystem;
        this.elements = {};
        this.isInitialized = false;
    }

    async init() {
        this.createTelegramMessagesSection();
        this.setupEventListeners();
        this.startStatusUpdater();
        this.isInitialized = true;
        console.log('ğŸ¨ ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù…Ø¯ÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©');
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ù…Ù…ÙŠØ²
    createTelegramMessagesSection() {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù† Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬
        let container = document.getElementById('telegramMessagesContainer');
        
        if (!container) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            container = document.createElement('div');
            container.id = 'telegramMessagesContainer';
            container.className = 'telegram-messages-section';
            
            // Ø¥Ø¯Ø±Ø§Ø¬ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
            const quotesSection = document.querySelector('.quotes-section') || 
                                 document.querySelector('#quotesContent') ||
                                 document.body;
            
            quotesSection.insertBefore(container, quotesSection.firstChild);
        }
        
        container.innerHTML = this.getTelegramSectionHTML();
        this.elements.container = container;
        this.elements.messagesList = document.getElementById('telegramMessagesList');
        this.elements.statusIndicator = document.getElementById('telegramStatus');
        this.elements.statsContainer = document.getElementById('telegramStats');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        this.updateMessagesDisplay();
        this.updateStats();
    }

    // HTML Ù‚Ø³Ù… Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    getTelegramSectionHTML() {
        return `
            <div class="telegram-section-header">
                <div class="section-title">
                    <div class="title-content">
                        <i class="fab fa-telegram telegram-icon"></i>
                        <h3>Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</h3>
                        <div id="telegramStatus" class="status-indicator">
                            <span class="status-dot"></span>
                            <span class="status-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                        </div>
                    </div>
                    <div class="section-controls">
                        <button class="control-btn refresh-btn" onclick="telegramUI.forceRefresh()" title="ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="control-btn settings-btn" onclick="telegramUI.showSettings()" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="control-btn minimize-btn" onclick="telegramUI.toggleSection()" title="ØªØµØºÙŠØ±/ØªÙˆØ³ÙŠØ¹">
                            <i class="fas fa-chevron-up"></i>
                        </button>
                    </div>
                </div>
                
                <div id="telegramStats" class="stats-bar">
                    <div class="stat-item">
                        <span class="stat-value" id="totalMessages">0</span>
                        <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="todayMessages">0</span>
                        <span class="stat-label">Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="lastSync">--:--</span>
                        <span class="stat-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</span>
                    </div>
                </div>
            </div>
            
            <div class="telegram-section-content" id="telegramSectionContent">
                <div class="messages-container">
                    <div id="telegramMessagesList" class="messages-list">
                        <div class="loading-placeholder">
                            <div class="loading-spinner"></div>
                            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...</p>
                        </div>
                    </div>
                </div>
                
                <div class="section-footer">
                    <div class="quick-actions">
                        <button class="action-btn primary" onclick="telegramUI.showAllMessages()">
                            <i class="fas fa-list"></i>
                            Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                        </button>
                        <button class="action-btn secondary" onclick="telegramUI.showSearchDialog()">
                            <i class="fas fa-search"></i>
                            Ø¨Ø­Ø«
                        </button>
                        <button class="action-btn secondary" onclick="telegramUI.showExportDialog()">
                            <i class="fas fa-download"></i>
                            ØªØµØ¯ÙŠØ±
                        </button>
                    </div>
                    
                    <div class="telegram-info">
                        <p> Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ù† Ø¬Ù‡Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ© ! </p>
                        
                    </div>
                </div>
            </div>
        `;
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    updateMessagesDisplay() {
        if (!this.elements.messagesList) return;
        
        const messages = this.messageSystem.messageStore.getTelegramMessages();
        
        if (messages.length === 0) {
            this.elements.messagesList.innerHTML = this.getEmptyStateHTML();
            return;
        }
        
        // Ø¹Ø±Ø¶ Ø¢Ø®Ø± 10 Ø±Ø³Ø§Ø¦Ù„
        const recentMessages = messages.slice(-10).reverse();
        
        this.elements.messagesList.innerHTML = recentMessages.map((message, index) => 
            this.getMessageHTML(message, messages.length - index)
        ).join('');
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ©
        this.animateNewMessages();
    }

    // HTML Ù„Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
    getMessageHTML(message, globalIndex) {
        const date = new Date(message.timestamp);
        const timeAgo = this.getTimeAgo(date);
        const isRecent = Date.now() - date.getTime() < 300000; // 5 Ø¯Ù‚Ø§Ø¦Ù‚
        
        return `
            <div class="message-item ${isRecent ? 'recent' : ''}" data-message-id="${message.id}">
                <div class="message-header">
                    <div class="message-number">#${globalIndex}</div>
                    <div class="message-meta">
                        <span class="author">${message.author}</span>
                        <span class="time" title="${date.toLocaleString('ar-SA')}">${timeAgo}</span>
                        ${message.edited ? '<span class="edited-badge">Ù…Ø­Ø±Ø±</span>' : ''}
                    </div>
                    <div class="message-actions">
                        <button class="action-icon" onclick="telegramUI.showMessage(${message.id})" title="Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-icon" onclick="telegramUI.copyDeleteCommand(${globalIndex})" title="Ù†Ø³Ø® Ø£Ù…Ø± Ø§Ù„Ø­Ø°Ù">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="message-content">
                    <p class="message-text">${this.escapeHTML(message.text)}</p>
                </div>
                
                <div class="message-footer">
                    <button class="quick-action" onclick="telegramUI.displayAsQuote('${this.escapeHTML(message.text)}', '${message.author}')">
                        <i class="fas fa-quote-right"></i>
                        Ø¹Ø±Ø¶ ÙƒØ§Ù‚ØªØ¨Ø§Ø³
                    </button>
                    <button class="quick-action danger" onclick="telegramUI.quickDelete(${globalIndex})">
                        <i class="fas fa-trash"></i>
                        Ø­Ø°Ù Ø³Ø±ÙŠØ¹
                    </button>
                </div>
            </div>
        `;
    }

    // HTML Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ©
    getEmptyStateHTML() {
        return `
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fab fa-telegram"></i>
                </div>
                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯</h4>
                <p>Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù„ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</p>
                <div class="empty-actions">
                    <button class="action-btn primary" onclick="telegramUI.showTelegramGuide()">
                        <i class="fas fa-question-circle"></i>
                        ÙƒÙŠÙÙŠØ© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                    </button>
                </div>
            </div>
        `;
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    updateStats() {
        if (!this.elements.statsContainer) return;
        
        const stats = this.messageSystem.messageStore.getStats();
        
        document.getElementById('totalMessages').textContent = stats.total;
        document.getElementById('todayMessages').textContent = stats.today;
        document.getElementById('lastSync').textContent = new Date().toLocaleTimeString('ar-SA', {
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„Ø­Ø§Ù„Ø©
    updateStatus(status) {
        if (!this.elements.statusIndicator) return;
        
        const statusDot = this.elements.statusIndicator.querySelector('.status-dot');
        const statusText = this.elements.statusIndicator.querySelector('.status-text');
        
        const statusConfig = {
            'connected': { class: 'connected', text: 'Ù…ØªØµÙ„' },
            'disconnected': { class: 'disconnected', text: 'Ù…Ù†Ù‚Ø·Ø¹' },
            'error': { class: 'error', text: 'Ø®Ø·Ø£' },
            'connecting': { class: 'connecting', text: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„' }
        };
        
        const config = statusConfig[status] || statusConfig['disconnected'];
        
        statusDot.className = `status-dot ${config.class}`;
        statusText.textContent = config.text;
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    setupEventListeners() {
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø¸Ø§Ù…
        this.messageSystem.on('message:added', (event) => {
            this.onMessageAdded(event.detail);
        });
        
        this.messageSystem.on('messages:deleted', (event) => {
            this.onMessagesDeleted(event.detail);
        });
        
        this.messageSystem.on('messages:cleared', (event) => {
            this.onMessagesCleared(event.detail);
        });
        
        this.messageSystem.on('sync:completed', (event) => {
            this.onSyncCompleted(event.detail);
        });
        
        this.messageSystem.on('sync:error', (event) => {
            this.onSyncError(event.detail);
        });
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
    onMessageAdded(message) {
        this.updateMessagesDisplay();
        this.updateStats();
        this.showNotification('ğŸ’Œ ÙˆØµÙ„Øª Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©!', 'success');
        this.highlightNewMessage(message.id);
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    onMessagesDeleted(data) {
        this.updateMessagesDisplay();
        this.updateStats();
        this.showNotification(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ${data.count} Ø±Ø³Ø§Ù„Ø©`, 'warning');
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    onMessagesCleared(data) {
        this.updateMessagesDisplay();
        this.updateStats();
        this.showNotification(`ğŸ§¹ ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (${data.count})`, 'warning');
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
    onSyncCompleted(data) {
        this.updateStats();
        this.updateStatus('connected');
        
        if (data.count > 0) {
            this.updateMessagesDisplay();
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ø®Ø·Ø£ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
    onSyncError(error) {
        this.updateStatus('error');
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:', error);
    }

    // Ø¨Ø¯Ø¡ Ù…Ø­Ø¯Ø« Ø§Ù„Ø­Ø§Ù„Ø©
    startStatusUpdater() {
        setInterval(() => {
            const status = this.messageSystem.getStatus();
            this.updateStatus(status.connectionStatus);
        }, 5000);
    }

    // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ
    async forceRefresh() {
        const refreshBtn = document.querySelector('.refresh-btn i');
        if (refreshBtn) {
            refreshBtn.classList.add('fa-spin');
        }
        
        await this.messageSystem.syncMessages();
        
        setTimeout(() => {
            if (refreshBtn) {
                refreshBtn.classList.remove('fa-spin');
            }
        }, 1000);
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù…
    toggleSection() {
        const content = document.getElementById('telegramSectionContent');
        const toggleBtn = document.querySelector('.minimize-btn i');
        
        if (content.style.display === 'none') {
            content.style.display = 'block';
            toggleBtn.className = 'fas fa-chevron-up';
        } else {
            content.style.display = 'none';
            toggleBtn.className = 'fas fa-chevron-down';
        }
    }

    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙƒØ§Ù…Ù„Ø©
    showMessage(messageId) {
        const message = this.messageSystem.messageStore.cache.get(messageId);
        if (!message) return;
        
        const modal = this.createModal('Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', `
            <div class="message-details">
                <div class="message-full-text">
                    <h4>Ø§Ù„Ù†Øµ Ø§Ù„ÙƒØ§Ù…Ù„:</h4>
                    <p>${this.escapeHTML(message.text)}</p>
                </div>
                
                <div class="message-info">
                    <div class="info-row">
                        <strong>Ø§Ù„Ù…Ø¤Ù„Ù:</strong> ${message.author}
                    </div>
                    <div class="info-row">
                        <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(message.timestamp).toLocaleString('ar-SA')}
                    </div>
                    <div class="info-row">
                        <strong>Ø§Ù„Ù…ØµØ¯Ø±:</strong> ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
                    </div>
                    ${message.edited ? `
                        <div class="info-row">
                            <strong>Ù…Ø­Ø±Ø±:</strong> Ù†Ø¹Ù… (${message.editTime})
                        </div>
                    ` : ''}
                </div>
                
                <div class="message-actions-full">
                    <button class="action-btn primary" onclick="telegramUI.displayAsQuote('${this.escapeHTML(message.text)}', '${message.author}'); telegramUI.closeModal()">
                        Ø¹Ø±Ø¶ ÙƒØ§Ù‚ØªØ¨Ø§Ø³
                    </button>
                    <button class="action-btn secondary" onclick="telegramUI.copyText('${this.escapeHTML(message.text)}')">
                        Ù†Ø³Ø® Ø§Ù„Ù†Øµ
                    </button>
                </div>
            </div>
        `);
        
        document.body.appendChild(modal);
    }

    // Ù†Ø³Ø® Ø£Ù…Ø± Ø§Ù„Ø­Ø°Ù
    copyDeleteCommand(index) {
        const command = `/delete ${index}`;
        this.copyToClipboard(command);
        this.showNotification(`ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø£Ù…Ø±: ${command}`, 'info');
    }

    // Ø­Ø°Ù Ø³Ø±ÙŠØ¹
    async quickDelete(index) {
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) {
            const command = `/delete ${index}`;
            this.showNotification(`ğŸ—‘ï¸ Ù„Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ Ø£Ø±Ø³Ù„ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…: ${command}`, 'warning');
            this.copyToClipboard(command);
        }
    }

    // Ø¹Ø±Ø¶ ÙƒØ§Ù‚ØªØ¨Ø§Ø³
    displayAsQuote(text, author) {
        if (typeof displayQuote === 'function') {
            displayQuote(text, `ğŸ’Œ ${author}`);
            this.showNotification('âœ¨ ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒØ§Ù‚ØªØ¨Ø§Ø³!', 'success');
        }
    }

    // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    showAllMessages() {
        const messages = this.messageSystem.messageStore.getTelegramMessages();
        
        if (messages.length === 0) {
            this.showNotification('ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ù„Ø¹Ø±Ø¶Ù‡Ø§', 'info');
            return;
        }
        
        let content = `
            <div class="all-messages-container">
                <div class="messages-header">
                    <h4>Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… (${messages.length})</h4>
                </div>
                <div class="messages-list-full">
        `;
        
        messages.reverse().forEach((message, index) => {
            const globalIndex = messages.length - index;
            content += `
                <div class="message-item-full">
                    <div class="message-number-full">#${globalIndex}</div>
                    <div class="message-content-full">
                        <p>${this.escapeHTML(message.text)}</p>
                        <div class="message-meta-full">
                            <span>${message.author}</span>
                            <span>${new Date(message.timestamp).toLocaleString('ar-SA')}</span>
                            ${message.edited ? '<span class="edited">Ù…Ø­Ø±Ø±</span>' : ''}
                        </div>
                    </div>
                </div>
            `;
        });
        
        content += `
                </div>
            </div>
        `;
        
        const modal = this.createModal('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', content);
        document.body.appendChild(modal);
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
    createModal(title, content) {
        const modal = document.createElement('div');
        modal.className = 'telegram-modal';
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h3>${title}</h3>
                    <button class="close-btn" onclick="this.closest('.telegram-modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    ${content}
                </div>
            </div>
        `;
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø§ÙØ°Ø©
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
        
        return modal;
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    closeModal() {
        const modal = document.querySelector('.telegram-modal');
        if (modal) {
            modal.remove();
        }
    }

    // Ù†Ø³Ø® Ù„Ù„Ø­Ø§ÙØ¸Ø©
    async copyToClipboard(text) {
        try {
            await navigator.clipboard.writeText(text);
        } catch (err) {
            // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø©
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }
    }

    // Ù†Ø³Ø® Ø§Ù„Ù†Øµ
    copyText(text) {
        this.copyToClipboard(text);
        this.showNotification('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ', 'success');
    }

    // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
    showNotification(message, type = 'info') {
        if (typeof showToast === 'function') {
            showToast(message, 4000, type);
        }
    }

    // ØªØ³Ù„ÙŠØ· Ø§Ù„Ø¶ÙˆØ¡ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
    highlightNewMessage(messageId) {
        setTimeout(() => {
            const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
            if (messageElement) {
                messageElement.classList.add('highlight');
                setTimeout(() => {
                    messageElement.classList.remove('highlight');
                }, 3000);
            }
        }, 500);
    }

    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    animateNewMessages() {
        const messages = document.querySelectorAll('.message-item');
        messages.forEach((message, index) => {
            message.style.animationDelay = `${index * 0.1}s`;
            message.classList.add('fade-in');
        });
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ
    getTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);
        
        if (diffMins < 1) return 'Ø§Ù„Ø¢Ù†';
        if (diffMins < 60) return `${diffMins} Ø¯`;
        if (diffHours < 24) return `${diffHours} Ø³`;
        if (diffDays < 7) return `${diffDays} ÙŠ`;
        
        return date.toLocaleDateString('ar-SA');
    }

    // ØªØ´ÙÙŠØ± HTML
    escapeHTML(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
}
/**
 * Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
 */
class CommandProcessor {
    constructor(messageSystem) {
        this.messageSystem = messageSystem;
        this.commands = new Map();
        this.setupCommands();
    }

    async init() {
        console.log('ğŸ¤– ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£ÙˆØ§Ù…Ø±');
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    setupCommands() {
        this.commands.set('/start', this.handleStart.bind(this));
        this.commands.set('/help', this.handleHelp.bind(this));
        this.commands.set('/list', this.handleList.bind(this));
        this.commands.set('/delete', this.handleDelete.bind(this));
        this.commands.set('/clear', this.handleClear.bind(this));
        this.commands.set('/stats', this.handleStats.bind(this));
        this.commands.set('/search', this.handleSearch.bind(this));
        this.commands.set('/export', this.handleExport.bind(this));
        this.commands.set('/status', this.handleStatus.bind(this));
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ù…Ø±
    async process(messageData) {
        const [command, ...args] = messageData.text.split(' ');
        const commandKey = command.toLowerCase();
        
        if (this.commands.has(commandKey)) {
            try {
                await this.commands.get(commandKey)(messageData, args);
            } catch (error) {
                console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø± ${command}:`, error);
                await this.sendError(messageData.id, 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø±');
            }
        } else {
            await this.sendError(messageData.id, `â“ Ø£Ù…Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ: ${command}\nØ§ÙƒØªØ¨ /help Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©`);
        }
    }

    // Ø£Ù…Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    async handleStart(messageData, args) {
        const welcomeText = `
ğŸŒŸ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…! ğŸŒŸ

ğŸ’• Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØª ÙŠØ±Ø¨Ø· Ø¨ÙŠÙ†Ùƒ ÙˆØ¨ÙŠÙ† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨ÙƒÙ…Ø§

âœ¨ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:
â€¢ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ ØªØ¸Ù‡Ø± ÙÙˆØ±Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹
â€¢ Ø­Ø°Ù ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¹Ù† Ø¨ÙØ¹Ø¯
â€¢ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø© ÙˆÙ…ØªÙ‚Ø¯Ù…Ø©
â€¢ Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØªØµØ¯ÙŠØ±Ù‡Ø§

ğŸš€ Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø­Ø¨ Ø¬Ù…ÙŠÙ„Ø©!

ğŸ’¡ Ø§ÙƒØªØ¨ /help Ù„Ø±Ø¤ÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©
        `.trim();
        
        await this.messageSystem.sendMessage(welcomeText, messageData.id);
    }

    // Ø£Ù…Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
    async handleHelp(messageData, args) {
        const helpText = `
ğŸ¤– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…:

ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:
/list - Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„Ùƒ Ù…Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
/delete [Ø±Ù‚Ù…] - Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø¨Ø±Ù‚Ù…Ù‡Ø§
/delete [Ù†Øµ] - Ø­Ø°Ù Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ
/clear - Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (ØªØ£ÙƒÙŠØ¯ Ù…Ø·Ù„ÙˆØ¨)

ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:
/search [ÙƒÙ„Ù…Ø©] - Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø±Ø³Ø§Ø¦Ù„Ùƒ
/stats - Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø©
/export - ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„Ùƒ

âš™ï¸ Ø§Ù„Ù†Ø¸Ø§Ù…:
/status - Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø§ØªØµØ§Ù„
/help - Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©

ğŸ’¡ Ø£Ù…Ø«Ù„Ø©:
â€¢ /delete 5 (Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø±Ù‚Ù… 5)
â€¢ /delete Ø£Ø­Ø¨Ùƒ (Ø­Ø°Ù Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "Ø£Ø­Ø¨Ùƒ")
â€¢ /search ØµØ¨Ø§Ø­ (Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "ØµØ¨Ø§Ø­")

âœ¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¯ÙŠØ©ØŒ Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø£ÙˆØ§Ù…Ø±
        `.trim();
        
        await this.messageSystem.sendMessage(helpText, messageData.id);
    }

    // Ø£Ù…Ø± Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    async handleList(messageData, args) {
        const messages = this.messageSystem.messageStore.getTelegramMessages();
        
        if (messages.length === 0) {
            await this.messageSystem.sendMessage('ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø­Ø§Ù„ÙŠØ§Ù‹', messageData.id);
            return;
        }
        
        const pageSize = 10;
        const page = parseInt(args[0]) || 1;
        const startIndex = (page - 1) * pageSize;
        const endIndex = startIndex + pageSize;
        const pageMessages = messages.slice(startIndex, endIndex);
        const totalPages = Math.ceil(messages.length / pageSize);
        
        let listText = `ğŸ“‹ Ø±Ø³Ø§Ø¦Ù„Ùƒ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (${messages.length})\n`;
        listText += `ğŸ“„ ØµÙØ­Ø© ${page} Ù…Ù† ${totalPages}\n\n`;
        
        pageMessages.forEach((message, index) => {
            const globalIndex = startIndex + index + 1;
            const shortText = message.text.length > 60 ? 
                message.text.substring(0, 60) + '...' : message.text;
            const editedMark = message.edited ? ' âœï¸' : '';
            const date = new Date(message.timestamp).toLocaleDateString('ar-SA');
            
            listText += `${globalIndex}. "${shortText}"${editedMark}\n`;
            listText += `ğŸ“… ${date}\n\n`;
        });
        
        if (totalPages > 1) {
            listText += `\nğŸ’¡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: /list ${page + 1}`;
        }
        
        listText += '\n\nğŸ—‘ï¸ Ù„Ù„Ø­Ø°Ù: /delete [Ø±Ù‚Ù…]';
        
        await this.messageSystem.sendMessage(listText, messageData.id);
    }

    // Ø£Ù…Ø± Ø§Ù„Ø­Ø°Ù
    async handleDelete(messageData, args) {
        if (args.length === 0) {
            await this.sendError(messageData.id, 'âŒ Ø§Ø³ØªØ®Ø¯Ù…: /delete [Ø±Ù‚Ù…] Ø£Ùˆ /delete [Ù†Øµ]');
            return;
        }
        
        const target = args.join(' ');
        let deletedCount = 0;
        let deletedMessages = [];
        
        // Ø§Ù„Ø­Ø°Ù Ø¨Ø§Ù„Ø±Ù‚Ù…
        if (!isNaN(target)) {
            const index = parseInt(target);
            const deleted = await this.messageSystem.messageStore.deleteByIndex(index);
            
            if (deleted) {
                deletedCount = 1;
                deletedMessages = [deleted];
            }
        } else {
            // Ø§Ù„Ø­Ø°Ù Ø¨Ø§Ù„Ù†Øµ
            deletedCount = await this.messageSystem.messageStore.deleteByText(target);
        }
        
        if (deletedCount > 0) {
            this.messageSystem.emit('messages:deleted', { count: deletedCount, messages: deletedMessages });
            
            const confirmText = `âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹\n\nğŸ’¡ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© Ø§Ø®ØªÙØª Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙˆØ±Ø§Ù‹`;
            await this.messageSystem.sendMessage(confirmText, messageData.id);
        } else {
            await this.sendError(messageData.id, 'âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        }
    }

    // Ø£Ù…Ø± Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
    async handleClear(messageData, args) {
        const messages = this.messageSystem.messageStore.getTelegramMessages();
        
        if (messages.length === 0) {
            await this.messageSystem.sendMessage('ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„Ø­Ø°Ù', messageData.id);
            return;
        }
        
        // Ø·Ù„Ø¨ ØªØ£ÙƒÙŠØ¯
        const confirmText = `âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø´Ø§Ù…Ù„

ğŸ—‘ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù ${messages.length} Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹

Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!

Ù„Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ø§ÙƒØªØ¨: /clear confirm`;
        
        if (args[0] !== 'confirm') {
            await this.messageSystem.sendMessage(confirmText, messageData.id);
            return;
        }
        
        const deletedCount = await this.messageSystem.messageStore.clearAllTelegramMessages();
        
        this.messageSystem.emit('messages:cleared', { count: deletedCount });
        
        const resultText = `âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (${deletedCount} Ø±Ø³Ø§Ù„Ø©)

ğŸ§¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¢Ù† Ø®Ø§Ù„ÙŠ Ù…Ù† Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…

ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø©`;
        
        await this.messageSystem.sendMessage(resultText, messageData.id);
    }

    // Ø£Ù…Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    async handleStats(messageData, args) {
        const stats = this.messageSystem.messageStore.getStats();
        const systemStatus = this.messageSystem.getStatus();
        
        const statsText = `
ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø©:

ğŸ“ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:
â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${stats.total}
â€¢ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙŠÙˆÙ…: ${stats.today}
â€¢ Ø±Ø³Ø§Ø¦Ù„ Ù…Ø­Ø±Ø±Ø©: ${stats.edited}

ğŸ“ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ:
â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø­Ø±Ù: ${stats.totalCharacters.toLocaleString()}
â€¢ Ù…ØªÙˆØ³Ø· Ø·ÙˆÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${stats.averageLength} Ø­Ø±Ù

ğŸ”§ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:
â€¢ Ø§Ù„Ø§ØªØµØ§Ù„: ${this.getStatusEmoji(systemStatus.connectionStatus)} ${systemStatus.connectionStatus}
â€¢ Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: #${systemStatus.lastUpdateId}
â€¢ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${systemStatus.isProcessing ? 'ğŸ”„ Ù†Ø´Ø·' : 'â¸ï¸ Ù…ØªÙˆÙ‚Ù'}

ğŸ“… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleString('ar-SA')}
        `.trim();
        
        await this.messageSystem.sendMessage(statsText, messageData.id);
    }

    // Ø£Ù…Ø± Ø§Ù„Ø¨Ø­Ø«
    async handleSearch(messageData, args) {
        if (args.length === 0) {
            await this.sendError(messageData.id, 'âŒ Ø§Ø³ØªØ®Ø¯Ù…: /search [ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«]');
            return;
        }
        
        const query = args.join(' ');
        const results = this.messageSystem.messageStore.search(query);
        
        if (results.length === 0) {
            await this.messageSystem.sendMessage(`ğŸ” Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù†: "${query}"`, messageData.id);
            return;
        }
        
        let searchText = `ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "${query}"\n`;
        searchText += `ğŸ“Š ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${results.length} Ø±Ø³Ø§Ù„Ø©\n\n`;
        
        results.slice(0, 10).forEach((message, index) => {
            const shortText = message.text.length > 80 ? 
                message.text.substring(0, 80) + '...' : message.text;
            const date = new Date(message.timestamp).toLocaleDateString('ar-SA');
            
            searchText += `${index + 1}. "${shortText}"\nğŸ“… ${date}\n\n`;
        });
        
        if (results.length > 10) {
            searchText += `\n... Ùˆ ${results.length - 10} Ù†ØªÙŠØ¬Ø© Ø£Ø®Ø±Ù‰`;
        }
        
        await this.messageSystem.sendMessage(searchText, messageData.id);
    }

    // Ø£Ù…Ø± Ø§Ù„ØªØµØ¯ÙŠØ±
    async handleExport(messageData, args) {
        const messages = this.messageSystem.messageStore.getTelegramMessages();
        
        if (messages.length === 0) {
            await this.messageSystem.sendMessage('ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„ØªØµØ¯ÙŠØ±', messageData.id);
            return;
        }
        
        let exportText = `ğŸ“„ ØªØµØ¯ÙŠØ± Ø±Ø³Ø§Ø¦Ù„Ùƒ (${messages.length} Ø±Ø³Ø§Ù„Ø©)\n`;
        exportText += `ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±: ${new Date().toLocaleString('ar-SA')}\n\n`;
        exportText += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
        
        messages.forEach((message, index) => {
            const date = new Date(message.timestamp).toLocaleString('ar-SA');
            exportText += `${index + 1}. "${message.text}"\n`;
            exportText += `ğŸ“… ${date}${message.edited ? ' (Ù…Ø­Ø±Ø±)' : ''}\n\n`;
        });
        
        // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù†Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·ÙˆÙŠÙ„Ø§Ù‹
        const maxLength = 4000;
        if (exportText.length > maxLength) {
            const parts = this.splitText(exportText, maxLength);
            for (let i = 0; i < parts.length; i++) {
                const partHeader = i === 0 ? '' : `ğŸ“„ Ø§Ù„Ø¬Ø²Ø¡ ${i + 1}:\n\n`;
                await this.messageSystem.sendMessage(partHeader + parts[i], messageData.id);
            }
        } else {
            await this.messageSystem.sendMessage(exportText, messageData.id);
        }
    }

    // Ø£Ù…Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    async handleStatus(messageData, args) {
        const status = this.messageSystem.getStatus();
        const stats = this.messageSystem.messageStore.getStats();
        
        const statusText = `
ğŸ”§ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…:

ğŸŒ Ø§Ù„Ø§ØªØµØ§Ù„:
â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: ${this.getStatusEmoji(status.connectionStatus)} ${status.connectionStatus}
â€¢ Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: #${status.lastUpdateId}
â€¢ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: ${status.retryCount}/3

âš™ï¸ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:
â€¢ Ø§Ù„Ù†Ø¸Ø§Ù…: ${status.isInitialized ? 'âœ… Ù…ÙÙ‡ÙŠØ£' : 'âŒ ØºÙŠØ± Ù…ÙÙ‡ÙŠØ£'}
â€¢ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${status.isProcessing ? 'ğŸ”„ Ù†Ø´Ø·' : 'â¸ï¸ Ù…ØªÙˆÙ‚Ù'}

ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:
â€¢ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©: ${stats.total}
â€¢ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙŠÙˆÙ…: ${stats.today}

â° Ø¢Ø®Ø± ÙØ­Øµ: ${new Date().toLocaleTimeString('ar-SA')}
        `.trim();
        
        await this.messageSystem.sendMessage(statusText, messageData.id);
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
    async sendError(messageId, errorText) {
        await this.messageSystem.sendMessage(`âŒ ${errorText}`, messageId);
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„Ø©
    getStatusEmoji(status) {
        const emojis = {
            'connected': 'ğŸŸ¢',
            'disconnected': 'ğŸ”´',
            'error': 'ğŸŸ¡',
            'connecting': 'ğŸŸ¡'
        };
        return emojis[status] || 'âšª';
    }

    // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù†Øµ Ø§Ù„Ø·ÙˆÙŠÙ„
    splitText(text, maxLength) {
        const parts = [];
        let currentPart = '';
        const lines = text.split('\n');
        
        for (const line of lines) {
            if ((currentPart + line + '\n').length > maxLength) {
                if (currentPart) {
                    parts.push(currentPart.trim());
                    currentPart = '';
                }
            }
            currentPart += line + '\n';
        }
        
        if (currentPart.trim()) {
            parts.push(currentPart.trim());
        }
        
        return parts;
    }
}
/**
 * Ù†Ø¸Ø§Ù… ØªØ®Ø²ÙŠÙ† ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
 */
class MessageStore {
    constructor() {
        this.storageKey = 'telegram_messages_advanced';
        this.quotesKey = 'customQuotes';
        this.cache = new Map();
        this.isInitialized = false;
    }

    async init() {
        await this.loadFromStorage();
        this.isInitialized = true;
        console.log('ğŸ’¾ ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ†');
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
    async loadFromStorage() {
        try {
            const stored = localStorage.getItem(this.storageKey);
            if (stored) {
                const data = JSON.parse(stored);
                data.forEach(message => {
                    this.cache.set(message.id, message);
                });
            }
            console.log(`ğŸ“¥ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${this.cache.size} Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†`);
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        }
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†
    async saveToStorage() {
        try {
            const data = Array.from(this.cache.values());
            localStorage.setItem(this.storageKey, JSON.stringify(data));
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…
            await this.syncWithQuotes();
            
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        }
    }

    // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª
    async syncWithQuotes() {
        const quotes = JSON.parse(localStorage.getItem(this.quotesKey) || '[]');
        
        // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        const nonTelegramQuotes = quotes.filter(q => q.source !== 'telegram');
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const telegramMessages = Array.from(this.cache.values()).map(msg => ({
            id: msg.id,
            text: msg.text,
            author: msg.author,
            date: new Date(msg.timestamp).toLocaleDateString('ar-SA'),
            time: new Date(msg.timestamp).toLocaleTimeString('ar-SA', { 
                hour: '2-digit', 
                minute: '2-digit' 
            }),
            source: 'telegram',
            telegramMessageId: msg.telegramMessageId,
            telegramUserId: msg.telegramUserId,
            edited: msg.edited || false,
            editTime: msg.editTime
        }));
        
        const allQuotes = [...nonTelegramQuotes, ...telegramMessages];
        localStorage.setItem(this.quotesKey, JSON.stringify(allQuotes));
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
    async addMessage(messageData) {
        const message = {
            id: Date.now() + Math.random(),
            text: messageData.text,
            author: messageData.author,
            telegramMessageId: messageData.telegramMessageId,
            telegramUserId: messageData.telegramUserId,
            source: 'telegram',
            timestamp: messageData.timestamp || new Date().toISOString(),
            created: new Date().toISOString(),
            edited: false
        };
        
        this.cache.set(message.id, message);
        await this.saveToStorage();
        
        return message;
    }

    // ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø©
    async updateMessage(telegramMessageId, newText) {
        const message = this.findByTelegramId(telegramMessageId);
        
        if (message && newText && newText.trim().length > 0) {
            message.text = newText.trim();
            message.edited = true;
            message.editTime = new Date().toLocaleTimeString('ar-SA', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            message.lastModified = new Date().toISOString();
            
            this.cache.set(message.id, message);
            await this.saveToStorage();
            
            return message;
        }
        
        return null;
    }

    // Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø¨Ù…Ø¹Ø±Ù ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    async deleteByTelegramId(telegramMessageId) {
        const message = this.findByTelegramId(telegramMessageId);
        
        if (message) {
            this.cache.delete(message.id);
            await this.saveToStorage();
            return true;
        }
        
        return false;
    }

    // Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø±Ù‚Ù…
    async deleteByIndex(index) {
        const messages = this.getTelegramMessages();
        
        if (index > 0 && index <= messages.length) {
            const message = messages[index - 1];
            this.cache.delete(message.id);
            await this.saveToStorage();
            return message;
        }
        
        return null;
    }

    // Ø­Ø°Ù Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Øµ Ù…Ø¹ÙŠÙ†
    async deleteByText(searchText) {
        const messages = this.getTelegramMessages();
        const toDelete = messages.filter(msg => 
            msg.text.toLowerCase().includes(searchText.toLowerCase())
        );
        
        toDelete.forEach(msg => {
            this.cache.delete(msg.id);
        });
        
        if (toDelete.length > 0) {
            await this.saveToStorage();
        }
        
        return toDelete.length;
    }

    // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    async clearAllTelegramMessages() {
        const telegramMessages = this.getTelegramMessages();
        const count = telegramMessages.length;
        
        telegramMessages.forEach(msg => {
            this.cache.delete(msg.id);
        });
        
        if (count > 0) {
            await this.saveToStorage();
        }
        
        return count;
    }

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±Ø³Ø§Ù„Ø© Ø¨Ù…Ø¹Ø±Ù ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    findByTelegramId(telegramMessageId) {
        return Array.from(this.cache.values()).find(
            msg => msg.telegramMessageId === telegramMessageId
        );
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    getTelegramMessages() {
        return Array.from(this.cache.values())
            .filter(msg => msg.source === 'telegram')
            .sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø±Ø³Ø§Ø¦Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    getTelegramMessagesCount() {
        return this.getTelegramMessages().length;
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©
    getLatestMessage() {
        const messages = this.getTelegramMessages();
        return messages.length > 0 ? messages[messages.length - 1] : null;
    }

    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    search(query) {
        const messages = this.getTelegramMessages();
        return messages.filter(msg => 
            msg.text.toLowerCase().includes(query.toLowerCase()) ||
            msg.author.toLowerCase().includes(query.toLowerCase())
        );
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    getStats() {
        const messages = this.getTelegramMessages();
        const now = new Date();
        const today = now.toLocaleDateString('ar-SA');
        
        return {
            total: messages.length,
            today: messages.filter(msg => 
                new Date(msg.timestamp).toLocaleDateString('ar-SA') === today
            ).length,
            edited: messages.filter(msg => msg.edited).length,
            totalCharacters: messages.reduce((sum, msg) => sum + msg.text.length, 0),
            averageLength: messages.length > 0 ? 
                Math.round(messages.reduce((sum, msg) => sum + msg.text.length, 0) / messages.length) : 0
        };
    }
}
/**
 * Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Ù„Ù„Ø®Ø¨Ø±Ø§Ø¡ ÙÙ‚Ø·
 * Advanced Message Management System - Expert Level
 */
class TelegramMessageSystem {
    constructor() {
        this.config = {
            botToken: TELEGRAM_CONFIG.BOT_TOKEN,
            chatId: TELEGRAM_CONFIG.CHAT_ID,
            syncInterval: 8000, // 8 Ø«ÙˆØ§Ù†
            maxRetries: 3,
            timeout: 10000,
            batchSize: 50
        };
        
        this.state = {
            isInitialized: false,
            isProcessing: false,
            lastUpdateId: this.getStoredUpdateId(),
            messageQueue: new Map(),
            syncTimer: null,
            retryCount: 0,
            connectionStatus: 'disconnected'
        };
        
        this.events = new EventTarget();
        this.messageStore = new MessageStore();
        this.commandProcessor = new CommandProcessor(this);
        this.uiManager = new UIManager(this);
        
        this.init();
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    async init() {
        try {
            console.log('ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...');
            
            await this.validateConfig();
            await this.initializeComponents();
            await this.startSyncEngine();
            
            this.state.isInitialized = true;
            this.state.connectionStatus = 'connected';
            
            this.emit('system:initialized');
            console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
            
        } catch (error) {
            console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
            this.handleInitError(error);
        }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    async validateConfig() {
        if (!this.config.botToken || !this.config.chatId) {
            throw new Error('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©');
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
        const testResponse = await this.makeRequest('getMe');
        if (!testResponse.ok) {
            throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…');
        }
        
        console.log('âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª
    async initializeComponents() {
        await this.messageStore.init();
        await this.commandProcessor.init();
        await this.uiManager.init();
        
        this.setupEventListeners();
        console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª');
    }

    // Ø¨Ø¯Ø¡ Ù…Ø­Ø±Ùƒ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
    async startSyncEngine() {
        // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©
        await this.syncMessages();
        
        // Ù…Ø²Ø§Ù…Ù†Ø© Ø¯ÙˆØ±ÙŠØ©
        this.state.syncTimer = setInterval(() => {
            this.syncMessages();
        }, this.config.syncInterval);
        
        console.log(`ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙƒÙ„ ${this.config.syncInterval/1000} Ø«Ø§Ù†ÙŠØ©`);
    }

    // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    async syncMessages() {
        if (this.state.isProcessing) return;
        
        try {
            this.state.isProcessing = true;
            this.emit('sync:started');
            
            const updates = await this.fetchUpdates();
            
            if (updates.length > 0) {
                console.log(`ğŸ“¨ Ù…Ø¹Ø§Ù„Ø¬Ø© ${updates.length} ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯`);
                
                for (const update of updates) {
                    await this.processUpdate(update);
                }
                
                this.updateLastUpdateId(updates);
                this.emit('sync:completed', { count: updates.length });
            }
            
            this.state.retryCount = 0;
            this.state.connectionStatus = 'connected';
            
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:', error);
            this.handleSyncError(error);
        } finally {
            this.state.isProcessing = false;
        }
    }

    // Ø¬Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    async fetchUpdates() {
        const params = {
            offset: this.state.lastUpdateId + 1,
            limit: this.config.batchSize,
            timeout: 30
        };
        
        const response = await this.makeRequest('getUpdates', params);
        
        if (!response.ok) {
            throw new Error(`ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª: ${response.description}`);
        }
        
        return response.result || [];
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø­Ø¯
    async processUpdate(update) {
        try {
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø±Ù Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
            this.state.lastUpdateId = Math.max(this.state.lastUpdateId, update.update_id);
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
            if (update.message) {
                await this.handleMessage(update.message);
            } else if (update.edited_message) {
                await this.handleEditedMessage(update.edited_message);
            } else if (update.callback_query) {
                await this.handleCallbackQuery(update.callback_query);
            }
            
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«:', error);
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    async handleMessage(message) {
        const messageData = {
            id: message.message_id,
            text: message.text,
            from: message.from,
            date: message.date,
            chat: message.chat
        };
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
        if (messageData.text && messageData.text.startsWith('/')) {
            await this.commandProcessor.process(messageData);
            return;
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
        if (messageData.text && messageData.text.trim().length > 0) {
            await this.handleRegularMessage(messageData);
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
    async handleRegularMessage(messageData) {
        const quote = await this.messageStore.addMessage({
            text: messageData.text.trim(),
            author: messageData.from.first_name || 'Ø­Ø¨ÙŠØ¨ÙŠ',
            telegramMessageId: messageData.id,
            telegramUserId: messageData.from.id,
            source: 'telegram',
            timestamp: new Date(messageData.date * 1000).toISOString()
        });
        
        // Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯
        await this.sendConfirmation(messageData.id, quote);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        this.emit('message:added', quote);
        
        console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©:', messageData.text.substring(0, 50));
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø±Ø±Ø©
    async handleEditedMessage(editedMessage) {
        const updated = await this.messageStore.updateMessage(
            editedMessage.message_id,
            editedMessage.text
        );
        
        if (updated) {
            this.emit('message:updated', updated);
            console.log('âœï¸ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø©');
        }
    }

    // Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    async sendConfirmation(replyToId, quote) {
        const totalMessages = await this.messageStore.getTelegramMessagesCount();
        
        const confirmationText = `
âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„ØªÙƒ Ù„Ù„Ù…ÙˆÙ‚Ø¹!

ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:
â€¢ Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©: #${totalMessages}
â€¢ Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleTimeString('ar-SA')}

ğŸ¯ Ø£ÙˆØ§Ù…Ø± Ù…ÙÙŠØ¯Ø©:
â€¢ /list - Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„Ùƒ
â€¢ /delete ${totalMessages} - Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
â€¢ /help - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©

ğŸ’• Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø¢Ù† ØªØ²ÙŠÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹!
        `.trim();
        
        await this.sendMessage(confirmationText, replyToId);
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
    async sendMessage(text, replyToId = null) {
        const params = {
            chat_id: this.config.chatId,
            text: text,
            parse_mode: 'HTML',
            disable_web_page_preview: true
        };
        
        if (replyToId) {
            params.reply_to_message_id = replyToId;
        }
        
        return await this.makeRequest('sendMessage', params);
    }

    // Ø·Ù„Ø¨ HTTP Ø¹Ø§Ù…
    async makeRequest(method, params = {}) {
        const url = `https://api.telegram.org/bot${this.config.botToken}/${method}`;
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), this.config.timeout);
        
        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(params),
                signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            return await response.json();
            
        } catch (error) {
            clearTimeout(timeoutId);
            throw error;
        }
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    setupEventListeners() {
        // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && this.state.connectionStatus === 'disconnected') {
                this.reconnect();
            }
        });
        
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', () => {
            this.cleanup();
        });
    }

    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    async reconnect() {
        console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„...');
        this.state.retryCount = 0;
        await this.syncMessages();
    }

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
    cleanup() {
        if (this.state.syncTimer) {
            clearInterval(this.state.syncTimer);
            this.state.syncTimer = null;
        }
        console.log('ğŸ§¹ ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯');
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
    handleInitError(error) {
        this.state.connectionStatus = 'error';
        this.emit('system:error', error);
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†
        setTimeout(() => {
            if (this.state.retryCount < this.config.maxRetries) {
                this.state.retryCount++;
                console.log(`ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ${this.state.retryCount}/${this.config.maxRetries}`);
                this.init();
            }
        }, 10000);
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
    handleSyncError(error) {
        this.state.connectionStatus = 'error';
        this.state.retryCount++;
        
        if (this.state.retryCount >= this.config.maxRetries) {
            console.error('âŒ ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª');
            this.state.connectionStatus = 'disconnected';
        }
        
        this.emit('sync:error', error);
    }

    // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø«
    emit(eventName, data = null) {
        this.events.dispatchEvent(new CustomEvent(eventName, { detail: data }));
    }

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø­Ø¯Ø«
    on(eventName, callback) {
        this.events.addEventListener(eventName, callback);
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙÙˆØ¸
    getStoredUpdateId() {
        return parseInt(localStorage.getItem('telegram_last_update_id') || '0');
    }

    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø±Ù Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
    updateLastUpdateId(updates) {
        if (updates.length > 0) {
            const maxId = Math.max(...updates.map(u => u.update_id));
            this.state.lastUpdateId = maxId;
            localStorage.setItem('telegram_last_update_id', maxId.toString());
        }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    getStatus() {
        return {
            isInitialized: this.state.isInitialized,
            connectionStatus: this.state.connectionStatus,
            isProcessing: this.state.isProcessing,
            lastUpdateId: this.state.lastUpdateId,
            retryCount: this.state.retryCount
        };
    }
}

    </script>
</body>
</html>
