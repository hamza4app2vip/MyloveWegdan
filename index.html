<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’• Ù„Ø­Ø¨ÙŠØ¨ØªÙŠ ÙˆØ¬Ø¯Ø§Ù† Ø§Ù„ØºØ§Ù„ÙŠØ© ğŸ’•</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
.advanced-telegram-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 25px;
    margin: 20px 0;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
    position: relative;
}

.advanced-telegram-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #4caf50, #2196f3, #ff9800, #e91e63);
    animation: connectionPulse 3s ease-in-out infinite;
}

/* Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
.advanced-header {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    padding: 25px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
}

.title-section {
    flex: 1;
}

.main-title {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 10px;
}

.pulse-icon {
    font-size: 2.5rem;
    color: #00d4aa;
    animation: pulse 2s infinite;
}

.main-title h2 {
    color: white;
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
}

.connection-status {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.15);
    padding: 8px 15px;
    border-radius: 25px;
    font-size: 0.9rem;
}

.status-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    animation: statusPulse 2s infinite;
}

.status-indicator.excellent { background: #4caf50; }
.status-indicator.good { background: #8bc34a; }
.status-indicator.fair { background: #ff9800; }
.status-indicator.poor { background: #f44336; }
.status-indicator.error { background: #e91e63; }

.subtitle p {
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    font-size: 1.1rem;
}

/* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
.stats-dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.stat-card:hover {
    transform: translateY(-5px);
    background: rgba(255, 255, 255, 0.2);
}

.stat-icon {
    font-size: 2rem;
    margin-bottom: 10px;
}

.stat-number {
    display: block;
    font-size: 2rem;
    font-weight: bold;
    color: #00d4aa;
    margin-bottom: 5px;
}

.stat-label {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
}

/* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
.control-panel {
    display: flex;
    gap: 10px;
}

.control-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    padding: 12px 20px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
}

.control-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

.control-btn.primary { background: linear-gradient(135deg, #4caf50, #45a049); }
.control-btn.secondary { background: linear-gradient(135deg, #2196f3, #1976d2); }
.control-btn.info { background: linear-gradient(135deg, #ff9800, #f57c00); }

/* Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
.messages-section {
    background: white;
    min-height: 400px;
}

.section-tabs {
    display: flex;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
}

.tab-btn {
    background: none;
    border: none;
    padding: 15px 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    color: #6c757d;
    position: relative;
}

.tab-btn:hover {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
}

.tab-btn.active {
    background: white;
    color: #667eea;
    border-bottom: 3px solid #667eea;
}

.badge {
    background: #dc3545;
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: bold;
    margin-left: 5px;
}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
.messages-container {
    max-height: 600px;
    overflow-y: auto;
}

.messages-display {
    padding: 20px;
}

/* Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
.message-item.advanced {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    border-left: 5px solid #667eea;
    transition: all 0.3s ease;
    opacity: 0;
    transform: translateY(20px);
    position: relative;
    overflow: hidden;
}

.message-item.advanced.message-appear {
    opacity: 1;
    transform: translateY(0);
}

.message-item.advanced:hover {
    transform: translateX(10px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.message-item.advanced.message-viewed {
    border-left-color: #4caf50;
    background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
}

.message-item.advanced::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, transparent, #667eea, transparent);
    animation: messageShimmer 2s ease-in-out infinite;
}

/* Ø±Ø£Ø³ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
.message-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.author-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.author-name {
    font-weight: 700;
    color: #2c3e50;
    font-size: 1.1rem;
}

.message-time {
    color: #7f8c8d;
    font-size: 0.9rem;
    background: rgba(127, 140, 141, 0.1);
    padding: 4px 10px;
    border-radius: 15px;
}

.new-badge {
    background: linear-gradient(135deg, #4caf50, #45a049);
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: bold;
    animation: newBadgePulse 2s infinite;
}

.view-status {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.9rem;
    color: #6c757d;
}

.view-status .text-success {
    color: #4caf50 !important;
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
.message-content {
    margin: 15px 0;
}

.message-text {
    font-size: 1.1rem;
    line-height: 1.7;
    color: #2c3e50;
    margin: 0;
}

/* ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… */
.message-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #e9ecef;
}

.message-actions {
    display: flex;
    gap: 10px;
}

.action-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    font-weight: 500;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.action-btn.secondary {
    background: linear-gradient(135deg, #95a5a6, #7f8c8d);
}

/* Ù…ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© */
.view-tracker {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.8rem;
    color: #6c757d;
    opacity: 0.7;
}

.tracker-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #6c757d;
}

.view-tracker.tracking-active .tracker-dot {
    background: #4caf50;
    animation: trackingPulse 1.5s infinite;
}

.view-tracker.tracking-active .tracker-text {
    color: #4caf50;
}

/* Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© */
.view-indicator-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(76, 175, 80, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 20px;
    animation: viewOverlayAppear 0.5s ease;
}

.view-animation {
    text-align: center;
    color: white;
    font-size: 1.2rem;
    font-weight: bold;
}

.view-animation i {
    font-size: 2rem;
    margin-bottom: 10px;
    display: block;
    animation: viewIconBounce 0.6s ease;
}

/* Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© */
.empty-state.advanced {
    text-align: center;
    padding: 80px 20px;
    color: #6c757d;
}

.empty-animation {
    position: relative;
    display: inline-block;
    margin-bottom: 30px;
}

.empty-animation i {
    font-size: 5rem;
    color: #dee2e6;
    animation: emptyFloat 3s ease-in-out infinite;
}

.pulse-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    border: 2px solid #667eea;
    border-radius: 50%;
    opacity: 0;
    animation: pulseRing 2s ease-out infinite;
}

.empty-features {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 30px;
}

.feature-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    color: #667eea;
}

.feature-item i {
    font-size: 2rem;
}

/* Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.loading-state {
    text-align: center;
    padding: 60px 20px;
    color: #6c757d;
}

.loading-animation {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}

.pulse-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #667eea;
    animation: pulseDot 1.4s ease-in-out infinite both;
}

.pulse-dot:nth-child(1) { animation-delay: -0.32s; }
.pulse-dot:nth-child(2) { animation-delay: -0.16s; }

/* Ø§Ù„ØªØ°ÙŠÙŠÙ„ */
.footer-section {
    background: #f8f9fa;
    padding: 25px;
    border-top: 1px solid #dee2e6;
}

.quick-info {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-bottom: 20px;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #667eea;
    font-weight: 500;
}

.send-instructions {
    text-align: center;
    color: #6c757d;
}

.send-instructions h4 {
    color: #495057;
    margin-bottom: 10px;
}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© */
.advanced-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    animation: modalFadeIn 0.3s ease;
}

.modal-content {
    background: white;
    border-radius: 20px;
    max-width: 90%;
    max-height: 90%;
    overflow: hidden;
    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
    animation: modalSlideUp 0.3s ease;
}

.modal-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-body {
    padding: 30px;
    max-height: 70vh;
    overflow-y: auto;
}

/* Ø´Ø¨ÙƒØ© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card-modal {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    border-left: 4px solid #667eea;
}

.stat-value-large {
    font-size: 3rem;
    font-weight: bold;
    color: #667eea;
    margin: 10px 0;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
.progress-section {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 25px;
}

.progress-bar {
    background: #e9ecef;
    border-radius: 25px;
    height: 20px;
    overflow: hidden;
    margin: 15px 0;
}

.progress-fill {
    background: linear-gradient(135deg, #4caf50, #45a049);
    height: 100%;
    border-radius: 25px;
    transition: width 1s ease;
    position: relative;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: progressShimmer 2s infinite;
}

/* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ© */
.instant-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #4caf50, #45a049);
    color: white;
    padding: 15px 25px;
    border-radius: 25px;
    box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
    z-index: 10001;
    transform: translateX(400px);
    transition: all 0.3s ease;
}

.instant-notification.show {
    transform: translateX(0);
}

.instant-notification.info {
    background: linear-gradient(135deg, #2196f3, #1976d2);
    box-shadow: 0 10px 30px rgba(33, 150, 243, 0.3);
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
}

/* Ø§Ù„Ø­Ø±ÙƒØ§Øª ÙˆØ§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª */
@keyframes connectionPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

@keyframes statusPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
}

@keyframes newBadgePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

@keyframes trackingPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

@keyframes messageShimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

@keyframes viewOverlayAppear {
    0% { opacity: 0; transform: scale(0.8); }
    100% { opacity: 1; transform: scale(1); }
}

@keyframes viewIconBounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

@keyframes emptyFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

@keyframes pulseRing {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.2); opacity: 0; }
}

@keyframes pulseDot {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
}

@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes modalSlideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes progressShimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ */
@media (max-width: 768px) {
    .advanced-header {
        padding: 20px;
    }
    
    .header-content {
        flex-direction: column;
        gap: 20px;
    }
    
    .stats-dashboard {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .control-panel {
        flex-direction: column;
        width: 100%;
    }
    
    .section-tabs {
        flex-direction: column;
    }
    
    .quick-info {
        flex-direction: column;
        gap: 15px;
    }
    
    .empty-features {
        flex-direction: column;
        gap: 20px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .instant-notification {
        right: 10px;
        left: 10px;
        transform: translateY(-100px);
    }
    
    .instant-notification.show {
        transform: translateY(0);
    }
}

        /* ØªØ­Ø³ÙŠÙ† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ø¬ */
.mood-btn {
    transition: all 0.3s ease;
    transform: scale(1);
    position: relative;
    overflow: hidden;
}

.mood-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(255, 107, 157, 0.3);
}

.mood-btn.selected {
    background: linear-gradient(135deg, #ff6b9d, #c44569) !important;
    color: white !important;
    transform: scale(1.1);
    box-shadow: 0 10px 30px rgba(255, 107, 157, 0.5);
    animation: selectedPulse 2s ease-in-out infinite;
}

.mood-btn.selected::after {
    content: 'âœ“';
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255, 255, 255, 0.9);
    color: #ff6b9d;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: bold;
}

@keyframes selectedPulse {
    0%, 100% { box-shadow: 0 10px 30px rgba(255, 107, 157, 0.5); }
    50% { box-shadow: 0 15px 40px rgba(255, 107, 157, 0.7); }
}

/* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø²Ø§Ø¬ */
.mood-history-item {
    transition: all 0.3s ease;
}

.mood-history-item:hover {
    background: rgba(255, 255, 255, 0.2) !important;
    transform: translateX(5px);
}

/* ØªØ­Ø³ÙŠÙ† Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ø¬ */
.mood-message {
    background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(255, 192, 203, 0.1));
    border: 2px solid rgba(255, 107, 157, 0.2);
}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-pink: #ff6b9d;
            --light-pink: #ffc0cb;
            --soft-pink: #ffb3d1;
            --rose-gold: #f7cac9;
            --blush: #ffeef0;
            --white: #ffffff;
            --dark-pink: #e91e63;
            --gradient-1: linear-gradient(135deg, #ff6b9d, #ffc0cb);
            --gradient-2: linear-gradient(45deg, #ff9a9e, #fecfef);
            --gradient-3: linear-gradient(135deg, #f093fb, #f5576c);
            --shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
            --text-dark: #2c2c2c;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #ffeef0 0%, #fff0f5 50%, #ffe4e6 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="hearts" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><text x="10" y="15" text-anchor="middle" fill="%23ff6b9d" opacity="0.1" font-size="12">ğŸ’•</text></pattern></defs><rect width="100" height="100" fill="url(%23hearts)"/></svg>');
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .container {
            max-width: 414px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            min-height: 100vh;
            box-shadow: 0 0 50px rgba(255, 107, 157, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .header {
            background: var(--gradient-1);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.1) 10px,
                rgba(255, 255, 255, 0.1) 20px
            );
            animation: slide 15s linear infinite;
        }

        @keyframes slide {
            0% { transform: translateX(-50px); }
            100% { transform: translateX(50px); }
        }

        .header h1 {
            color: white;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            position: relative;
            z-index: 2;
        }

        .floating-hearts {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .heart {
            position: absolute;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.5rem;
            animation: floatUp 6s ease-in-out infinite;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .nav-tabs {
            display: flex;
            background: white;
            box-shadow: 0 2px 10px rgba(255, 107, 157, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            color: var(--primary-pink);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.9rem;
        }

        .nav-tab.active {
            background: var(--gradient-1);
            color: white;
        }

        .nav-tab:hover {
            background: var(--blush);
        }

        .nav-tab.active:hover {
            background: var(--gradient-1);
        }

        .content {
            padding: 20px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 192, 203, 0.3);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.4);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-1);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark-pink);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .counter-display {
            text-align: center;
            padding: 30px;
            background: var(--gradient-2);
            border-radius: 20px;
            color: white;
            margin-bottom: 20px;
        }

        .counter-number {
            font-size: 3rem;
            font-weight: 700;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .counter-label {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .love-meter {
            background: var(--gradient-2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .meter-container {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            height: 20px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b9d, #ffffff);
            border-radius: 25px;
            width: 0%;
            transition: width 2s ease-in-out;
            position: relative;
        }

        .meter-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .weather-widget {
            background: var(--gradient-3);
            border-radius: 20px;
            padding: 25px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .weather-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .mood-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .mood-btn {
            background: white;
            border: 2px solid var(--light-pink);
            border-radius: 15px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }

        .mood-btn:hover, .mood-btn.selected {
            background: var(--gradient-1);
            color: white;
            transform: scale(1.1);
        }

        .quote-container {
            background: var(--blush);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-pink);
            position: relative;
        }

        .quote-text {
            font-style: italic;
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--text-dark);
        }

        .quote-author {
            text-align: left;
            margin-top: 10px;
            color: var(--dark-pink);
            font-weight: 600;
        }

        .memory-timeline {
            position: relative;
            padding-right: 30px;
        }

        .memory-timeline::before {
            content: '';
            position: absolute;
            right: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--gradient-1);
        }

        .memory-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.2);
        }

        .memory-item::after {
            content: '';
            position: absolute;
            right: -25px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: var(--primary-pink);
            border-radius: 50%;
            border: 3px solid white;
        }

        .memory-date {
            color: var(--dark-pink);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .memory-text {
            line-height: 1.6;
        }

        .interactive-game {
            background: var(--gradient-2);
            border-radius: 20px;
            padding: 25px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .game-cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-cell:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .music-player {
            background: var(--gradient-1);
            border-radius: 20px;
            padding: 25px;
            color: white;
            margin-bottom: 20px;
        }

        .music-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }

        .music-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .music-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .music-btn.play {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            height: 8px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: white;
            height: 100%;
            width: 0%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .calendar-widget {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: var(--primary-pink);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-nav:hover {
            background: var(--dark-pink);
            transform: scale(1.1);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .calendar-day:hover {
            background: var(--blush);
        }

        .calendar-day.today {
            background: var(--primary-pink);
            color: white;
        }

        .calendar-day.special {
            background: var(--gradient-1);
            color: white;
            position: relative;
        }

        .calendar-day.special::after {
            content: 'ğŸ’•';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 0.7rem;
        }

        .notification-center {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .notification {
            background: var(--blush);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-right: 4px solid var(--primary-pink);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--dark-pink);
            margin-bottom: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--gradient-2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .voice-message {
            background: var(--gradient-1);
            border-radius: 20px;
            padding: 25px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .voice-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            margin: 15px;
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .voice-btn.recording {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .surprise-box {
            background: var(--gradient-3);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            color: white;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .surprise-box:hover {
            transform: scale(1.05);
        }

        .surprise-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .footer {
            background: var(--gradient-1);
            padding: 30px 20px;
            text-align: center;
            color: white;
            margin-top: 40px;
        }

        .footer-heart {
            font-size: 2rem;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }

        .btn {
            background: var(--gradient-1);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary-pink);
            border: 2px solid var(--primary-pink);
        }

        .btn-secondary:hover {
            background: var(--primary-pink);
            color: white;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-pink);
            font-weight: 600;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light-pink);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary-pink);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--primary-pink);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gradient-1);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            .content {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .counter-number {
                font-size: 2.5rem;
            }
            
            .nav-tab {
                padding: 12px 8px;
                font-size: 0.8rem;
            }
        }

        .sparkle {
            position: absolute;
            color: var(--primary-pink);
            font-size: 1rem;
            animation: sparkle 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .typing-indicator {
            display: inline-block;
        }

        .typing-indicator span {
            display: inline-block;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="floating-hearts" id="floatingHearts"></div>
            <h1>ğŸ’• Ù„Ø­Ø¨ÙŠØ¨ØªÙŠ Ø§Ù„ØºØ§Ù„ÙŠØ© ğŸ’•</h1>
            <p class="subtitle">Ø£Ø¬Ù…Ù„ Ù…Ø§ ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø© Ù‡Ùˆ ÙˆØ¬ÙˆØ¯Ùƒ Ù…Ø¹ÙŠ</p>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('home')">
                <i class="fas fa-home"></i><br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
            <button class="nav-tab" onclick="showTab('memories')">
                <i class="fas fa-heart"></i><br>Ø°ÙƒØ±ÙŠØ§ØªÙ†Ø§
            </button>
            <button class="nav-tab" onclick="showTab('games')">
                <i class="fas fa-gamepad"></i><br>Ø£Ù„Ø¹Ø§Ø¨
            </button>
            <button class="nav-tab" onclick="showTab('tools')">
                <i class="fas fa-magic"></i><br>Ø£Ø¯ÙˆØ§Øª
            </button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Home Tab -->
            <div id="home" class="tab-content active">
                <!-- Love Counter -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-calendar-heart"></i>
                        Ø¹Ø¯Ø§Ø¯ Ø£ÙŠØ§Ù… Ø­Ø¨Ù†Ø§
                    </h3>
                    <div class="counter-display">
                        <div class="counter-number" id="daysCounter">0</div>
                        <div class="counter-label">ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø­Ø¨ ÙˆØ§Ù„Ø³Ø¹Ø§Ø¯Ø©</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="hoursCounter">0</div>
                            <div class="stat-label">Ø³Ø§Ø¹Ø©</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="minutesCounter">0</div>
                            <div class="stat-label">Ø¯Ù‚ÙŠÙ‚Ø©</div>
                        </div>
                    </div>
                </div>

                <!-- Love Meter -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-heart-pulse"></i>
                        Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø­Ø¨
                    </h3>
                    <div class="love-meter">
                        <h4>Ù…Ø³ØªÙˆÙ‰ Ø­Ø¨ÙŠ Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…</h4>
                        <div class="meter-container">
                            <div class="meter-fill" id="loveMeter"></div>
                        </div>
                        <p id="lovePercentage">100%</p>
                    </div>
                </div>

                <!-- Weather of Love -->
                <div class="weather-widget">
                    <h3><i class="fas fa-cloud-sun"></i> Ø·Ù‚Ø³ Ø§Ù„Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…</h3>
                    <div class="weather-icon" id="weatherIcon">â˜€ï¸</div>
                    <h4 id="weatherStatus">Ù…Ø´Ù…Ø³ Ù…Ø¹ Ù†Ø³Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø­Ø¨</h4>
                    <p id="weatherDesc">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©: â™¾ï¸ Ø¯Ø±Ø¬Ø© Ø­Ø¨</p>
                </div>

                <!-- Daily Quote -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-quote-right"></i>
                        Ø§Ù‚ØªØ¨Ø§Ø³ Ø§Ù„ÙŠÙˆÙ…
                    </h3>
                    <div class="quote-container">
                        <p class="quote-text" id="dailyQuote">
                            "Ø§Ù„Ø­Ø¨ Ù„ÙŠØ³ Ù…Ø¬Ø±Ø¯ Ø´Ø¹ÙˆØ±ØŒ Ø¨Ù„ Ù‡Ùˆ Ù‚Ø±Ø§Ø± Ù†ØªØ®Ø°Ù‡ ÙƒÙ„ ÙŠÙˆÙ… Ù„Ù†ÙƒÙˆÙ† Ù…Ø¹ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ Ù†Ø­Ø¨Ù‡"
                        </p>
                        <p class="quote-author">- Ø­Ù…Ø²Ø© Ø­Ø¨ÙŠØ¨Ùƒ</p>
                    </div>
                    <button class="btn" onclick="getNewQuote()">Ø§Ù‚ØªØ¨Ø§Ø³ Ø¬Ø¯ÙŠØ¯</button>
                </div>

                <!-- Mood Tracker -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-smile"></i>
                        ÙƒÙŠÙ Ù…Ø²Ø§Ø¬Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ
                    </h3>
                    <div class="mood-selector">
                        <div class="mood-btn" onclick="selectMood('happy', 'ğŸ˜Š')">ğŸ˜Š</div>
                        <div class="mood-btn" onclick="selectMood('love', 'ğŸ˜')">ğŸ˜</div>
                        <div class="mood-btn" onclick="selectMood('excited', 'ğŸ¤©')">ğŸ¤©</div>
                        <div class="mood-btn" onclick="selectMood('calm', 'ğŸ˜Œ')">ğŸ˜Œ</div>
                        <div class="mood-btn" onclick="selectMood('romantic', 'ğŸ¥°')">ğŸ¥°</div>
                        <div class="mood-btn" onclick="selectMood('dreamy', 'ğŸ˜´')">ğŸ˜´</div>
                        <div class="mood-btn" onclick="selectMood('playful', 'ğŸ˜œ')">ğŸ˜œ</div>
                        <div class="mood-btn" onclick="selectMood('grateful', 'ğŸ˜”')">ğŸ˜”</div>
                    </div>
                    <p id="moodMessage">Ø§Ø®ØªØ§Ø±ÙŠ Ù…Ø²Ø§Ø¬Ùƒ Ù„Ø£Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø§Ø³Ø¨Ø© ğŸ’•</p>
                </div>
            </div>

            <!-- Memories Tab -->
            <div id="memories" class="tab-content">
                <!-- Memory Timeline -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-timeline"></i>
                        Ø®Ø· Ø²Ù…Ù†ÙŠ Ù„Ø°ÙƒØ±ÙŠØ§ØªÙ†Ø§
                    </h3>
                    <div class="memory-timeline" id="memoryTimeline">
                        <!-- Memories will be loaded here -->
                    </div>
                    <button class="btn" onclick="addMemory()">Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>

                <!-- Special Dates Calendar -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-calendar-check"></i>
                        ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
                    </h3>
                    <div class="calendar-widget">
                        <div class="calendar-header">
                            <button class="calendar-nav" onclick="changeMonth(-1)">â€¹</button>
                            <h4 id="currentMonth">ÙŠÙ†Ø§ÙŠØ± 2024</h4>
                            <button class="calendar-nav" onclick="changeMonth(1)">â€º</button>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Calendar will be generated here -->
                        </div>
                    </div>
                </div>

                <!-- Love Letters -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-envelope-heart"></i>
                        Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø¨
                    </h3>
                    <div id="loveLetters">
                        <!-- Love letters will be displayed here -->
                    </div>
                    <button class="btn" onclick="writeLoveLetter()">ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ø­Ø¨</button>
                </div>
            </div>

            <!-- Games Tab -->
            <div id="games" class="tab-content">
                <!-- Love Quiz -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-question-circle"></i>
                        Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø¨
                    </h3>
                    <div id="quizContainer">
                        <p>ÙƒÙ… ØªØ¹Ø±ÙÙŠÙ† Ø¹Ù†ÙŠØŸ Ø§Ø®ØªØ¨Ø±ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ!</p>
                        <button class="btn" onclick="startQuiz()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
                    </div>
                </div>

                <!-- Memory Game -->
                <div class="interactive-game">
                    <h3><i class="fas fa-brain"></i> Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©</h3>
                    <p>Ø§Ø¹Ø«Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø©!</p>
                    <div class="game-grid" id="memoryGame">
                        <!-- Memory game grid will be generated here -->
                    </div>
                    <button class="btn btn-secondary" onclick="startMemoryGame()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>

                <!-- Love Calculator -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-calculator"></i>
                        Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø­Ø¨
                    </h3>
                    <div class="input-group">
                        <label>Ø§Ø³Ù…Ùƒ:</label>
                        <input type="text" id="name1" placeholder="Ø£Ø¯Ø®Ù„ÙŠ Ø§Ø³Ù…Ùƒ">
                    </div>
                    <div class="input-group">
                        <label>Ø§Ø³Ù…ÙŠ:</label>
                        <input type="text" id="name2" placeholder="Ø£Ø¯Ø®Ù„ÙŠ Ø§Ø³Ù…ÙŠ">
                    </div>
                    <button class="btn" onclick="calculateLove()">Ø§Ø­Ø³Ø¨ÙŠ Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¨</button>
                    <div id="loveResult"></div>
                </div>

                <!-- Surprise Box -->
                <div class="surprise-box" onclick="openSurprise()">
                    <div class="surprise-icon">ğŸ</div>
                    <h3>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…ÙØ§Ø¬Ø¢Øª</h3>
                    <p>Ø§Ø¶ØºØ·ÙŠ Ù„ØªØ­ØµÙ„ÙŠ Ø¹Ù„Ù‰ Ù…ÙØ§Ø¬Ø£Ø©!</p>
                </div>
            </div>

            <!-- Tools Tab -->
            <div id="tools" class="tab-content">
                <!-- Music Player -->
                <div class="music-player">
                    <h3><i class="fas fa-music"></i> Ù…Ø´ØºÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©</h3>
                    <div id="currentSong">Ø£ØºÙ†ÙŠØ© Ø§Ù„Ø­Ø¨ Ø§Ù„Ø£ÙˆÙ„Ù‰</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="musicProgress"></div>
                    </div>
                    <div class="music-controls">
                        <button class="music-btn" onclick="previousSong()">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="music-btn play" onclick="togglePlay()" id="playBtn">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="music-btn" onclick="nextSong()">
                            <i class="fas fa-step-forward"></i>
                        </button>
                    </div>
                </div>

                <!-- Voice Messages -->
                <div class="voice-message">
                    <h3><i class="fas fa-microphone"></i> Ø±Ø³Ø§Ø¦Ù„ ØµÙˆØªÙŠØ©</h3>
                    <p>Ø³Ø¬Ù„ÙŠ Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ© Ù„ÙŠ ğŸ’•</p>
                    <button class="voice-btn" onclick="toggleRecording()" id="recordBtn">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <div id="voiceMessages">
                        <!-- Voice messages will be displayed here -->
                    </div>
                </div>

                <!-- Notification Center -->
                <div class="notification-center">
                    <h3 class="card-title">
                        <i class="fas fa-bell"></i>
                        Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                    </h3>
                    <div id="notifications">
                        <!-- Notifications will be displayed here -->
                    </div>
                    <button class="btn" onclick="addReminder()">Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±</button>
                </div>
<div class="card">
    <h3 class="card-title">
        <i class="fab fa-telegram"></i>
        Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    </h3>
    <div class="telegram-setup">
        <p><strong>Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø§Ù„ÙŠÙ‡Ø§:</strong> Ø®Ø§Øµ </p>
        <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:</strong> <span id="connectionStatus">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span></p>
        
        <div class="button-group">
            <button class="btn" onclick="getChatId()">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID</button>
            <button class="btn" onclick="testTelegramConnection()">ØªØ­Ù‚ÙŠÙ‚ Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­</button>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <h4>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:</h4>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="sentCount">0</div>
                <div class="stat-label">Ø±Ø³Ø§Ù„Ø© Ù…Ø±Ø³Ù„Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="failedCount">0</div>
                <div class="stat-label">Ø±Ø³Ø§Ù„Ø© ÙØ§Ø´Ù„Ø©</div>
            </div>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <button class="btn btn-secondary" onclick="showTelegramLogs()">Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>
        <button class="btn btn-secondary" onclick="clearTelegramLogs()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
    </div>
</div>
                <!-- Love Statistics -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-chart-heart"></i>
                        Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¨
                    </h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="messagesCount">âˆ</div>
                            <div class="stat-label"> ÙƒÙ„Ø§Ù… Ø­Ø¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="smilesCount">âˆ</div>
                            <div class="stat-label">Ø§Ø¨ØªØ³Ø§Ù…Ø©</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="hugsCount">12000</div>
                            <div class="stat-label">ÙˆØ³Ø§Ø¦Ø·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="kissesCount">290,000</div>
                            <div class="stat-label">Ø±Ø³Ø§Ù„Ø©</div>
                        </div>
                    </div>
                </div>

                <!-- Weather Forecast -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-cloud-sun"></i>
                        ØªÙˆÙ‚Ø¹Ø§Øª Ø·Ù‚Ø³ Ø§Ù„Ø­Ø¨
                    </h3>
                    <div id="weatherForecast">
                        <!-- Weather forecast will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-heart">ğŸ’•</div>
            <p>ØµÙÙ†Ø¹ Ø¨ÙƒÙ„ Ø§Ù„Ø­Ø¨ ÙˆØ§Ù„Ø´ÙˆÙ‚</p>
            <p>Ù„Ø£Ø¬Ù…Ù„ Ø­Ø¨ÙŠØ¨Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…</p>
            <div class="typing-indicator">
                <span>.</span><span>.</span><span>.</span>
            </div>
        </div>
      </div>
    <!-- Modals -->
    <div id="memoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('memoryModal')">&times;</span>
            <h3>Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <div class="input-group">
                <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                <input type="date" id="memoryDate">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø°ÙƒØ±Ù‰:</label>
                <textarea id="memoryText" rows="4" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ù„Ø°ÙƒØ±Ù‰ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©..."></textarea>
            </div>
            <button class="btn" onclick="saveMemory()">Ø­ÙØ¸ Ø§Ù„Ø°ÙƒØ±Ù‰</button>
        </div>
    </div>

    <div id="letterModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('letterModal')">&times;</span>
            <h3>ÙƒØªØ§Ø¨Ø© Ø±Ø³Ø§Ù„Ø© Ø­Ø¨</h3>
            <div class="input-group">
                <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
                <input type="text" id="letterTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                <textarea id="letterContent" rows="6" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø¨..."></textarea>
            </div>
            <button class="btn" onclick="saveLetter()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
        </div>
    </div>

    <div id="reminderModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('reminderModal')">&times;</span>
            <h3>Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±</h3>
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„ØªØ°ÙƒÙŠØ±:</label>
                <select id="reminderType">
                    <option value="daily">ÙŠÙˆÙ…ÙŠ</option>
                    <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                    <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                    <option value="special">Ù…Ù†Ø§Ø³Ø¨Ø© Ø®Ø§ØµØ©</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                <input type="text" id="reminderText" placeholder="Ù†Øµ Ø§Ù„ØªØ°ÙƒÙŠØ±">
            </div>
            <div class="input-group">
                <label>Ø§Ù„ÙˆÙ‚Øª:</label>
                <input type="time" id="reminderTime">
            </div>
            <button class="btn" onclick="saveReminder()">Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒÙŠØ±</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
    // Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø­Ø³Ù†Ø©
async function testTelegramConnection() {
    const statusElement = document.getElementById('connectionStatus');
    
    if (!statusElement) {
        console.log('Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        return;
    }
    
    statusElement.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
    statusElement.style.color = 'orange';
    
    try {
        // Ø£ÙˆÙ„Ø§Ù‹: Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨ÙˆØª
        const botInfoResponse = await fetch(`https://api.telegram.org/bot${TELEGRAM_CONFIG.BOT_TOKEN}/getMe`);
        const botInfo = await botInfoResponse.json();
        
        if (!botInfo.ok) {
            throw new Error('Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ­ÙŠØ­');
        }
        
        console.log('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨ÙˆØª:', botInfo.result);
        
        // Ø«Ø§Ù†ÙŠØ§Ù‹: Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID Ø§Ù„ØµØ­ÙŠØ­
        await getChatId();
        
        // Ø«Ø§Ù„Ø«Ø§Ù‹: Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø±
        const testResult = await sendToTelegram(
            'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„', 
            'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ø¨ÙˆØª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­! ğŸ¤–âœ…\n\nØ¥Ø°Ø§ ÙˆØµÙ„ØªÙƒ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ ÙØ¥Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰', 
            'test'
        );
        
        if (testResult) {
            statusElement.textContent = 'Ù…ØªØµÙ„ âœ…';
            statusElement.style.color = 'green';
            showToast('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­! ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ğŸ“±');
        } else {
            throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
        statusElement.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„ âŒ';
        statusElement.style.color = 'red';
        showToast(`Ø®Ø·Ø£: ${error.message}`);
    }
    
    updateTelegramStats();
}

    // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID Ø§Ù„ØµØ­ÙŠØ­
async function getChatId() {
    try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_CONFIG.BOT_TOKEN}/getUpdates`);
        const data = await response.json();
        
        if (data.ok && data.result.length > 0) {
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©
            const lastMessage = data.result[data.result.length - 1];
            const chatId = lastMessage.message.chat.id;
            
            console.log('Chat ID Ø§Ù„Ù…ÙƒØªØ´Ù:', chatId);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            TELEGRAM_CONFIG.CHAT_ID = chatId.toString();
            
            showToast(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Chat ID: ${chatId}`);
            return chatId;
        } else {
            showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø³Ø§Ø¦Ù„. Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¨ÙˆØª Ø£ÙˆÙ„Ø§Ù‹!');
            return null;
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID:', error);
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Chat ID');
        return null;
    }
}

    
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
const TELEGRAM_CONFIG = {
    BOT_TOKEN: '7619744256:AAGlTErNoXyRAoBwNO0f8SNwDBzIA2y1Pws', // ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
    CHAT_ID: '7619744256',     // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (Ù†ÙØ³ ID Ø§Ù„Ø¨ÙˆØª Ù…Ø¤Ù‚ØªØ§Ù‹)
    enabled: true              // Ù…ÙØ¹Ù„
};

// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¹Ø¨Ø± ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
async function sendToTelegram(title, content, type = 'love_letter') {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©
    if (!TELEGRAM_CONFIG.enabled || !TELEGRAM_CONFIG.BOT_TOKEN || !TELEGRAM_CONFIG.CHAT_ID) {
        console.log('ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ØºÙŠØ± Ù…ÙØ¹Ù„ Ø£Ùˆ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø§Ù‚ØµØ©');
        return false;
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    let message = '';
    let emoji = '';
    
    switch(type) {
        case 'love_letter':
            emoji = 'ğŸ’Œ';
            message = `${emoji} Ø±Ø³Ø§Ù„Ø© Ø­Ø¨ Ø¬Ø¯ÙŠØ¯Ø© ${emoji}\n\n`;
            message += `ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${title}\n\n`;
            message += `ğŸ’• Ø§Ù„Ø±Ø³Ø§Ù„Ø©:\n${content}\n\n`;
            break;
            
        case 'memory':
            emoji = 'ğŸ’­';
            message = `${emoji} Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø© ${emoji}\n\n`;
            message += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${title}\n\n`;
            message += `ğŸ’– Ø§Ù„Ø°ÙƒØ±Ù‰:\n${content}\n\n`;
            break;
            
        case 'mood':
            emoji = 'ğŸ˜Š';
            message = `${emoji} ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø²Ø§Ø¬ ${emoji}\n\n`;
            message += `ğŸ­ Ø§Ù„Ù…Ø²Ø§Ø¬: ${title}\n`;
            message += `ğŸ’­ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${content}\n\n`;
            break;
            
        case 'test':
            emoji = 'ğŸ¤–';
            message = `${emoji} Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ ${emoji}\n\n`;
            message += `${content}\n\n`;
            break;
            
        default:
            emoji = 'ğŸ’•';
            message = `${emoji} Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ${emoji}\n\n${content}\n\n`;
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
    message += `â° Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleString('ar-SA', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    })}\n\n`;
    
    message += `ğŸ’– Ù…Ù† Ø­Ø¨ÙŠØ¨ØªÙƒ Ø§Ù„ØºØ§Ù„ÙŠØ© ğŸ’–`;

    // Ø±Ø§Ø¨Ø· API ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    const telegramURL = `https://api.telegram.org/bot${TELEGRAM_CONFIG.BOT_TOKEN}/sendMessage`;
    
    try {
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
        showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©... â³');
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
        const response = await fetch(telegramURL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                chat_id: TELEGRAM_CONFIG.CHAT_ID,
                text: message,
                parse_mode: 'HTML',
                disable_web_page_preview: true
            })
        });

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        if (response.ok) {
            const result = await response.json();
            if (result.ok) {
                showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ“±ğŸ’•');
                
                // Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                saveTelegramLog(title, content, type, 'success');
                
                // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ
                createSparkle();
                createSparkle();
                
                return true;
            } else {
                throw new Error(result.description || 'Ø®Ø·Ø£ Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…');
            }
        } else {
            throw new Error(`HTTP Error: ${response.status}`);
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
        showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ğŸ˜”');
        
        // Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø®Ø·Ø£
        saveTelegramLog(title, content, type, 'failed', error.message);
        
        return false;
    }
}

// Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
function saveTelegramLog(title, content, type, status, error = null) {
    const logs = JSON.parse(localStorage.getItem('telegramLogs') || '[]');
    logs.push({
        title,
        content: content.substring(0, 100) + '...', // Ø­ÙØ¸ Ø£ÙˆÙ„ 100 Ø­Ø±Ù ÙÙ‚Ø·
        type,
        status,
        error,
        timestamp: new Date().toISOString(),
        id: Date.now()
    });
    
    // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 50 Ø³Ø¬Ù„ ÙÙ‚Ø·
    if (logs.length > 50) {
        logs.splice(0, logs.length - 50);
    }
    
    localStorage.setItem('telegramLogs', JSON.stringify(logs));
}


        // Global Variables
        let currentTab = 'home';
        let loveStartDate = new Date('2023-06-2'); // ØªØºÙŠÙŠØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø­Ø³Ø¨ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let isPlaying = false;
        let isRecording = false;
        let currentSongIndex = 0;
        let memoryGameCards = [];
        let flippedCards = [];
        let gameScore = 0;

        // Love quotes array
        const loveQuotes = [
            "Ø§Ù„Ø­Ø¨ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø§Ù„Ø°ÙŠ ÙŠØ²Ø¯Ø§Ø¯ Ø¹Ù†Ø¯Ù…Ø§ Ù†Ù‚Ø³Ù…Ù‡",
            "Ø£Ù†Øª Ù„Ø³Øª Ù…Ø¬Ø±Ø¯ Ø­Ø¨ÙŠØ¨ØªÙŠØŒ Ø¨Ù„ Ø£Ù†Øª Ø­ÙŠØ§ØªÙŠ ÙƒÙ„Ù‡Ø§",
            "ÙÙŠ Ø¹ÙŠÙ†ÙŠÙƒ Ø£Ø±Ù‰ Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØŒ ÙˆÙÙŠ Ù‚Ù„Ø¨Ùƒ Ø£Ø¬Ø¯ Ø¨ÙŠØªÙŠ",
            "Ø§Ù„Ø­Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ø§ ÙŠØ¹Ø±Ù Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆÙ„Ø§ Ø§Ù„Ø²Ù…Ù†",
            "Ø£Ù†Øª Ø§Ù„Ø³Ø¨Ø¨ ÙÙŠ Ø£Ù† ÙƒÙ„ ÙŠÙˆÙ… ÙŠØ¨Ø¯Ùˆ ÙˆÙƒØ£Ù†Ù‡ Ø¹ÙŠØ¯",
            "Ø­Ø¨Ùƒ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø¹Ø§Ù„Ù… Ø£Ø¬Ù…Ù„ ÙˆØ§Ù„Ø­ÙŠØ§Ø© Ø£Ø­Ù„Ù‰",
            "ÙˆØ¬ÙˆØ¯Ùƒ Ù…Ù‡Ù… Ù„Ù„ØºØ§ÙŠØ© Ø£Ù†ØªÙŠ Ø§ÙƒØ³Ø¬ÙŠÙ†",
"Ø¨Ø§Ø°Ù† Ø§Ù„Ù„Ù‡ ØªÙƒÙˆÙ†ÙŠ Ù„ÙŠ ÙˆØ£Ù†Ø§ Ù„ÙƒÙ Ø£Ù†ØªÙŠ",
"Ù…Ù† Ø§Ø±ÙƒØ§Ù† Ø­ÙŠØ§ØªÙŠ Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© ÙˆØ¬Ø¯Ø§Ù† Ø§Ù†ØªÙŠ Ø­Ø¨ÙŠØ¨ØªÙŠ",
            "Ù…Ø¹Ùƒ ØªØ¹Ù„Ù…Øª Ø£Ù† Ø§Ù„Ø­Ø¨ Ù„ÙŠØ³ Ù…Ø¬Ø±Ø¯ ÙƒÙ„Ù…Ø© Ø¨Ù„ Ø­ÙŠØ§Ø© ÙƒØ§Ù…Ù„Ø©"
        ];

        // Songs array
        const songs = [
            "Ø£ØºÙ†ÙŠØ© Ø§Ù„Ø­Ø¨ Ø§Ù„Ø£ÙˆÙ„Ù‰",
            "Ù„Ø­Ù† Ø§Ù„Ù‚Ù„ÙˆØ¨",
            "Ø³ÙŠÙ…ÙÙˆÙ†ÙŠØ© Ø§Ù„Ø¹Ø´Ù‚",
            "Ù†ØºÙ…Ø© Ø§Ù„Ø´ÙˆÙ‚",
            "Ø£Ù†Ø´ÙˆØ¯Ø© Ø§Ù„Ø­Ø¨"
        ];

        // Weather statuses
        const weatherStatuses = [
            { icon: "â˜€ï¸", status: "Ù…Ø´Ù…Ø³ Ù…Ø¹ Ù†Ø³Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø­Ø¨", desc: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©: â™¾ï¸ Ø¯Ø±Ø¬Ø© Ø­Ø¨" },
            { icon: "ğŸŒ™", status: "Ù„ÙŠÙ„Ø© Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© ØªØ­Øª Ø§Ù„Ù†Ø¬ÙˆÙ…", desc: "Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©: 100%" },
            { icon: "ğŸŒˆ", status: "Ù‚ÙˆØ³ Ù‚Ø²Ø­ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø¹Ø±", desc: "Ø§Ù„Ø±Ø·ÙˆØ¨Ø©: Ù…Ø´Ø¨Ø¹Ø© Ø¨Ø§Ù„Ø­Ø¨" },
            { icon: "ğŸ’«", status: "Ø¹Ø§ØµÙØ© Ù…Ù† Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ø£Ø­Ù„Ø§Ù…", desc: "Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­: Ù†Ø³ÙŠÙ… Ø§Ù„Ø­Ù†Ø§Ù†" },
            { icon: "ğŸŒ¸", status: "Ø±Ø¨ÙŠØ¹ Ø¯Ø§Ø¦Ù… ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨", desc: "Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠ: Ù…Ø±ØªÙØ¹ Ø¨Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©" }
        ];

        // Mood messages
        const moodMessages = {
            happy: "Ø³Ø¹ÙŠØ¯Ø© Ø£Ù†Ùƒ Ø³Ø¹ÙŠØ¯Ø©! Ø§Ø¨ØªØ³Ø§Ù…ØªÙƒ ØªØ¶ÙŠØ¡ ÙŠÙˆÙ…ÙŠ ğŸ˜Š",
            love: "Ø£Ø­Ø¨Ùƒ Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ØªØªØ®ÙŠÙ„ÙŠÙ†! ğŸ˜ğŸ’•",
            excited: "Ø­Ù…Ø§Ø³Ùƒ Ù…Ø¹Ø¯ÙŠ! Ø¯Ø¹ÙŠÙ†Ø§ Ù†ØµÙ†Ø¹ Ø°ÙƒØ±ÙŠØ§Øª Ø¬Ù…ÙŠÙ„Ø© ğŸ¤©",
            calm: "Ø§Ù„Ù‡Ø¯ÙˆØ¡ Ù…Ø¹Ùƒ Ø£Ø¬Ù…Ù„ Ø´Ø¹ÙˆØ± ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… ğŸ˜Œ",
            romantic: "Ø£Ù†Øª ÙÙŠ Ù…Ø²Ø§Ø¬ Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØŸ Ø£Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹! ğŸ¥°",
            dreamy: "Ø£Ø­Ù„Ø§Ù… Ø³Ø¹ÙŠØ¯Ø© ÙŠØ§ Ø­Ø¨ÙŠØ¨ØªÙŠ ğŸ˜´ğŸ’¤",
            playful: "Ø£Ø­Ø¨ Ø±ÙˆØ­Ùƒ Ø§Ù„Ù…Ø±Ø­Ø©! ğŸ˜œğŸ‰",
            grateful: "Ø­Ø¨ÙŠØ¨Ùƒ Ù…Ø¹Ùƒ Ù„Ø§  ØªØ­Ø²Ù†ÙŠ Ø­Ø¨ÙŠØ¨ØªÙŠ"
        };

        // Quiz questions
        const quizQuestions = [
            {
                question: "Ø§ÙƒÙ„Ø© Ø§Ø´ØªÙŠÙ‡Ø§ Ù…Ù† ÙŠØ¯Ùƒ",
                options: ["Ø¯Ø¬Ø§Ø¬", "Ø§ÙŠ Ø´ÙŠ Ø§Ù„Ù…Ù‡Ù… Ù…Ù†Ùƒ", "Ø®Ø¨Ø²", "Ø³Ù…Ùƒ"],
                correct: 1
            },
            {
                question: "Ø§ÙŠØ´ Ø§ÙƒØ«Ø± Ø´ÙŠ ÙŠØ¹Ø¬Ø¨Ù†Ø§ ÙÙŠÙƒ",
                options: ["Ø¬Ù…Ø§Ù„ÙŠ", "ØµÙˆØªÙŠ", "ÙƒÙ„ Ø´ÙŠ", "Ø§Ù†Ø§Ù‚ØªÙŠ"],
                correct: 2
            },
            {
                question: "Ø´ÙŠ Ø§ØªÙ…Ù†Ø§Ù‡ Ù…Ù†Ùƒ",
                options: ["Ù‚Ø±Ø¨Ùƒ", "ØµÙˆØªÙƒ", "ÙƒÙ„Ø§Ù…Ùƒ", "Ø§ØªÙ…Ù†Ù‰ ÙˆØ¬Ø¯Ø§Ù†"],
                correct: 3
            }
        ];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            startCounters();
            generateCalendar();
            loadMemories();
            loadLoveLetters();
            loadNotifications();
            createFloatingHearts();
            updateWeather();
            animateLoveMeter();
            loadWeatherForecast();
            startMemoryGame();
        });

        function initializeApp() {
            // Set initial love meter
            setTimeout(() => {
                document.getElementById('loveMeter').style.width = '100%';
            }, 1000);

            // Add sparkle effects
            setInterval(createSparkle, 2000);

            // Update statistics
            updateStatistics();
        }

        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Update nav buttons
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));
            event.target.closest('.nav-tab').classList.add('active');

            currentTab = tabName;
        }

        function startCounters() {
            function updateCounters() {
                const now = new Date();
                const diff = now - loveStartDate;
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

                document.getElementById('daysCounter').textContent = days;
                document.getElementById('hoursCounter').textContent = hours;
                document.getElementById('minutesCounter').textContent = minutes;
            }

            updateCounters();
            setInterval(updateCounters, 60000); // Update every minute
        }

        function animateLoveMeter() {
            const meter = document.getElementById('loveMeter');
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                } else {
                    width++;
                    meter.style.width = width + '%';
                }
            }, 20);
        }

        function getNewQuote() {
            const randomQuote = loveQuotes[Math.floor(Math.random() * loveQuotes.length)];
            document.getElementById('dailyQuote').textContent = randomQuote;
            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³! ğŸ’•');
        }

        function selectMood(mood, emoji) {
            // Remove previous selection
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Add selection to clicked button
            event.target.classList.add('selected');

            // Update mood message
            document.getElementById('moodMessage').textContent = moodMessages[mood];
            
            showToast(`Ù…Ø²Ø§Ø¬Ùƒ! ${emoji}`);
        }

        function updateWeather() {
            const randomWeather = weatherStatuses[Math.floor(Math.random() * weatherStatuses.length)];
            document.getElementById('weatherIcon').textContent = randomWeather.icon;
            document.getElementById('weatherStatus').textContent = randomWeather.status;
            document.getElementById('weatherDesc').textContent = randomWeather.desc;
        }

    function generateCalendar() {
    const monthNames = [
        'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
        'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
    ];

    // Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù…Ø¹ 3 Ù…Ù†Ø§Ø³Ø¨Ø§Øª ÙÙ‚Ø·
    const specialEvents = {
        // Ø°ÙƒØ±ÙŠØ§Øª Ø´Ø®ØµÙŠØ©
        personal: {
            '5-5': { message: 'Ù…ÙŠÙ„Ø§Ø¯ Ø­Ø¨ÙŠØ¨Ùƒ', emoji: 'ğŸ’•' }
        },
        // Ø£Ø¹ÙŠØ§Ø¯ ÙˆÙ…Ù†Ø§Ø³Ø¨Ø§Øª
        holidays: {
            '5-2': { message: 'Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø¨', emoji: 'ğŸ’–' }
        },
        // Ø£Ø¹ÙŠØ§Ø¯ Ù…ÙŠÙ„Ø§Ø¯
        birthdays: {
            '2-25': { message: 'Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ', emoji: 'ğŸ‚' }
        }
    };

    document.getElementById('currentMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;

    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    const today = new Date();

    const calendarGrid = document.getElementById('calendarGrid');
    calendarGrid.innerHTML = '';

    // Add day headers
    const dayHeaders = ['Ø£Ø­', 'Ø¥Ø«', 'Ø«', 'Ø£Ø±', 'Ø®', 'Ø¬', 'Ø³'];
    dayHeaders.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.textContent = day;
        dayHeader.style.fontWeight = 'bold';
        dayHeader.style.color = 'var(--primary-pink)';
        dayHeader.style.padding = '10px 5px';
        dayHeader.style.textAlign = 'center';
        calendarGrid.appendChild(dayHeader);
    });

    // Add empty cells for days before month starts
    for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day';
        calendarGrid.appendChild(emptyDay);
    }

    // Add days of the month
    for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
        const dateKey = `${currentMonth}-${day}`;
        let isSpecial = false;
        let eventInfo = null;
        let eventType = '';

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª
        if (specialEvents.personal[dateKey]) {
            isSpecial = true;
            eventInfo = specialEvents.personal[dateKey];
            eventType = 'personal';
        } else if (specialEvents.holidays[dateKey]) {
            isSpecial = true;
            eventInfo = specialEvents.holidays[dateKey];
            eventType = 'holiday';
        } else if (specialEvents.birthdays[dateKey]) {
            isSpecial = true;
            eventInfo = specialEvents.birthdays[dateKey];
            eventType = 'birthday';
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù…ÙŠØ²Ø©
        if (isSpecial) {
            dayElement.classList.add('special', eventType);
            dayElement.title = `${eventInfo.emoji} ${eventInfo.message}`;
            dayElement.innerHTML = `
                <div style="font-weight: bold;">${day}</div>
                <div style="font-size: 0.8rem; margin-top: 2px;">${eventInfo.emoji}</div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ù†Ø¨Ø¶Ø© Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù…ÙŠØ²Ø©
            dayElement.style.animation = 'heartbeat 2s ease-in-out infinite';
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø©
            dayElement.addEventListener('click', () => {
                showToast(`${eventInfo.emoji} ${eventInfo.message}`);
                createSparkle();
            });
        } else {
            dayElement.textContent = day;
        }

        // Mark today
        if (currentYear === today.getFullYear() && 
            currentMonth === today.getMonth() && 
            day === today.getDate()) {
            dayElement.classList.add('today');
            if (!isSpecial) {
                dayElement.style.background = 'var(--primary-pink)';
                dayElement.style.color = 'white';
            }
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
        if (!isSpecial) {
            dayElement.addEventListener('mouseenter', () => {
                dayElement.style.background = 'var(--blush)';
                dayElement.style.transform = 'scale(1.1)';
            });
            
            dayElement.addEventListener('mouseleave', () => {
                if (!dayElement.classList.contains('today')) {
                    dayElement.style.background = '';
                }
                dayElement.style.transform = 'scale(1)';
            });
        }

        calendarGrid.appendChild(dayElement);
    }
}


        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();
        }

        function addMemory() {
            document.getElementById('memoryModal').style.display = 'block';
        }

        function saveMemory() {
            const date = document.getElementById('memoryDate').value;
            const text = document.getElementById('memoryText').value;

            if (date && text) {
                const memories = JSON.parse(localStorage.getItem('memories') || '[]');
                memories.push({ date, text, id: Date.now() });
                localStorage.setItem('memories', JSON.stringify(memories));
                
                loadMemories();
                closeModal('memoryModal');
                showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø°ÙƒØ±Ù‰ Ø¨Ù†Ø¬Ø§Ø­! ğŸ’•');
                
                // Clear form
                document.getElementById('memoryDate').value = '';
                document.getElementById('memoryText').value = '';
            }
        }

        function loadMemories() {
            const memories = JSON.parse(localStorage.getItem('memories') || '[]');
            const timeline = document.getElementById('memoryTimeline');
            
            timeline.innerHTML = '';
            
            memories.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(memory => {
                const memoryItem = document.createElement('div');
                memoryItem.className = 'memory-item';
                memoryItem.innerHTML = `
                    <div class="memory-date">${formatDate(memory.date)}</div>
                    <div class="memory-text">${memory.text}</div>
                `;
                timeline.appendChild(memoryItem);
            });

            if (memories.length === 0) {
                timeline.innerHTML = '<p style="text-align: center; color: var(--primary-pink);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø°ÙƒØ±ÙŠØ§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø¦ÙŠ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø°ÙƒØ±Ù‰! ğŸ’•</p>';
            }
        }

        function writeLoveLetter() {
            document.getElementById('letterModal').style.display = 'block';
        }

async function saveLetter() {
    const title = document.getElementById('letterTitle').value.trim();
    const content = document.getElementById('letterContent').value.trim();

    if (!title || !content) {
        showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„! ğŸ“');
        return;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    if (content.length > 4000) {
        showToast('Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹! ÙŠØ±Ø¬Ù‰ ØªÙ‚ØµÙŠØ±Ù‡Ø§ ğŸ“');
        return;
    }

    try {
        // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹
        const letters = JSON.parse(localStorage.getItem('loveLetters') || '[]');
        const newLetter = { 
            title, 
            content, 
            date: new Date().toISOString(),
            id: Date.now(),
            sent: false // Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        };
        
        letters.push(newLetter);
        localStorage.setItem('loveLetters', JSON.stringify(letters));
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
        const sent = await sendToTelegram(title, content, 'love_letter');
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        if (sent) {
            newLetter.sent = true;
            localStorage.setItem('loveLetters', JSON.stringify(letters));
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        loadLoveLetters();
        closeModal('letterModal');
        
        // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
        if (sent) {
            showToast('ØªÙ… Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø¨! ğŸ’Œâœ¨');
        } else {
            showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· ğŸ’¾');
        }
        
        // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('letterTitle').value = '';
        document.getElementById('letterContent').value = '';
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', error);
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ğŸ˜”');
    }
}

        function loadLoveLetters() {
            const letters = JSON.parse(localStorage.getItem('loveLetters') || '[]');
            const container = document.getElementById('loveLetters');
            
            container.innerHTML = '';
            
            letters.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(letter => {
                const letterElement = document.createElement('div');
                letterElement.className = 'quote-container';
                letterElement.style.marginBottom = '15px';
                letterElement.innerHTML = `
                    <h4 style="color: var(--dark-pink); margin-bottom: 10px;">${letter.title}</h4>
                    <p class="quote-text">${letter.content}</p>
                    <p class="quote-author">- ${formatDate(letter.date)}</p>
                `;
                container.appendChild(letterElement);
            });

            if (letters.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--primary-pink);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø­Ø¨ Ø¨Ø¹Ø¯. Ø§ÙƒØªØ¨ÙŠ Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø©! ğŸ’Œ</p>';
            }
        }

        function startQuiz() {
            let currentQuestion = 0;
            let score = 0;

            function showQuestion() {
                if (currentQuestion < quizQuestions.length) {
                    const question = quizQuestions[currentQuestion];
                    const container = document.getElementById('quizContainer');
                    
                    container.innerHTML = `
                        <h4>Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestion + 1} Ù…Ù† ${quizQuestions.length}</h4>
                        <p>${question.question}</p>
                        <div style="margin: 20px 0;">
                            ${question.options.map((option, index) => 
                                `<button class="btn btn-secondary" style="display: block; width: 100%; margin: 10px 0;" onclick="answerQuestion(${index})">${option}</button>`
                            ).join('')}
                        </div>
                    `;
                } else {
                    // Show results
                    const container = document.getElementById('quizContainer');
                    const percentage = (score / quizQuestions.length) * 100;
                    let message = '';
                    
                    if (percentage >= 80) {
                        message = 'Ù…Ù…ØªØ§Ø²! ØªØ¹Ø±ÙÙŠÙ†Ù†ÙŠ Ø¬ÙŠØ¯Ø§Ù‹ Ø¬Ø¯Ø§Ù‹! ğŸ’•';
                    } else if (percentage >= 60) {
                        message = 'Ø¬ÙŠØ¯! Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù†ÙŠ ğŸ˜Š';
                    } else {
                        message = 'Ø±ÙƒØ²Ø²ÙŠ ÙÙŠ Ø§Ù„Ø§Ø³Ø¦Ù„Ø©';
                    }
                    
                    container.innerHTML = `
                        <h4>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h4>
                        <div class="counter-display">
                            <div class="counter-number">${percentage}%</div>
                            <div class="counter-label">${message}</div>
                        </div>
                        <button class="btn" onclick="startQuiz()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
                    `;
                }
            }

            window.answerQuestion = function(selectedIndex) {
                if (selectedIndex === quizQuestions[currentQuestion].correct) {
                    score++;
                    showToast('Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ğŸ‰');
                } else {
                    showToast('Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© ğŸ˜…');
                }
                currentQuestion++;
                setTimeout(showQuestion, 1000);
            };

            showQuestion();
        }

        function startMemoryGame() {
            const gameGrid = document.getElementById('memoryGame');
            const symbols = ['ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’˜', 'ğŸ’', 'ğŸ’', 'ğŸ’Ÿ', 'â¤ï¸'];
            const cards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);
            
            gameGrid.innerHTML = '';
            memoryGameCards = [];
            flippedCards = [];
            gameScore = 0;

            cards.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.className = 'game-cell';
                card.dataset.symbol = symbol;
                card.dataset.index = index;
                card.textContent = 'ğŸ’­';
                card.onclick = () => flipCard(card);
                gameGrid.appendChild(card);
                memoryGameCards.push(card);
            });
        }

        function flipCard(card) {
            if (flippedCards.length < 2 && !card.classList.contains('flipped')) {
                card.textContent = card.dataset.symbol;
                card.classList.add('flipped');
                flippedCards.push(card);

                if (flippedCards.length === 2) {
                    setTimeout(checkMatch, 1000);
                }
            }
        }

        function checkMatch() {
            const [card1, card2] = flippedCards;
            
            if (card1.dataset.symbol === card2.dataset.symbol) {
                card1.style.background = 'var(--gradient-1)';
                card2.style.background = 'var(--gradient-1)';
                gameScore++;
                showToast('ØªØ·Ø§Ø¨Ù‚ Ø±Ø§Ø¦Ø¹! ğŸ’•');
                
                if (gameScore === 8) {
                    setTimeout(() => showToast('Ù…Ø¨Ø±ÙˆÙƒ! Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! ğŸ‰'), 500);
                }
            } else {
                card1.textContent = 'ğŸ’­';
                card2.textContent = 'ğŸ’­';
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
            }
            
            flippedCards = [];
        }

      function calculateLove() {
    const name1 = document.getElementById('name1').value.trim();
    const name2 = document.getElementById('name2').value.trim();
    
    // Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (ØºÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡)
    const herName = "ÙˆØ¬Ø¯Ø§Ù†"; // Ø§Ø³Ù… Ø­Ø¨ÙŠØ¨ØªÙƒ
    const myName = "Ø­Ù…Ø²Ø©";   // Ø§Ø³Ù…Ùƒ
    
    if (!name1 || !name2) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…ÙŠÙ†!');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
    const isCorrectCombination = 
        (name1.toLowerCase() === herName.toLowerCase() && name2.toLowerCase() === myName.toLowerCase()) ||
        (name1.toLowerCase() === myName.toLowerCase() && name2.toLowerCase() === herName.toLowerCase());
    
    if (isCorrectCombination) {
        // Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ØµØ­ÙŠØ­Ø© - Ù†Ø³Ø¨Ø© Ù…Ø«Ø§Ù„ÙŠØ©
        const percentage = 100;
        
        document.getElementById('loveResult').innerHTML = `
            <div class="counter-display" style="margin-top: 20px;">
                <div class="counter-number">${percentage}%</div>
                <div class="counter-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¨ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©</div>
                <p style="margin-top: 15px;">ğŸ’• Ø­Ø¨ Ø£Ø¨Ø¯ÙŠ ÙˆØ­Ù‚ÙŠÙ‚ÙŠ! ğŸ’•</p>
                <p style="color: white; opacity: 0.9;">Ø£Ù†ØªÙ…Ø§ Ø±ÙˆØ­Ø§Ù† ÙÙŠ Ø¬Ø³Ø¯ÙŠÙ† </p>
                <div style="margin-top: 15px; font-size: 2rem;">HğŸ’W</div>
            </div>
        `;
        
        showToast('Ø­Ø¨ Ù…Ø«Ø§Ù„ÙŠ 100%! ğŸ’•ğŸ‘‘');
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø®Ø§ØµØ©
        createSparkle();
        setTimeout(createSparkle, 500);
        setTimeout(createSparkle, 1000);
        
    } else {
        // Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø®Ø§Ø·Ø¦Ø©
        const percentage = Math.floor(Math.random() * 40) + 20; // 20-60%
        
        document.getElementById('loveResult').innerHTML = `
            <div class="counter-display" style="margin-top: 20px;">
                <div class="counter-number">${percentage}%</div>
                <div class="counter-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¨</div>
                <p style="margin-top: 15px;">ğŸ¤” Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ Ù…Ø§!</p>
                <p style="color: white; opacity: 0.9;">
                    ØªØ£ÙƒØ¯ÙŠ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ ÙˆØ§Ø³Ù…ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙŠØ§ Ø­Ø¨ÙŠØ¨ØªÙŠ ğŸ˜˜
                </p>
                <p style="color: white; opacity: 0.8; font-size: 0.9rem; margin-top: 10px;">
                    ØªÙ„Ù…ÙŠØ­: Ø§Ø³Ù…Ùƒ ÙŠØ¨Ø¯Ø£ Ø¨Ø­Ø±Ù "${herName.charAt(0)}" ÙˆØ§Ø³Ù…ÙŠ ÙŠØ¨Ø¯Ø£ Ø¨Ø­Ø±Ù "${myName.charAt(0)}" ğŸ˜‰
                </p>
            </div>
        `;
        
        showToast('Ø¬Ø±Ø¨ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! ğŸ˜‰ğŸ’•');
    }
}


        function openSurprise() {
            const surprises = [
                "ğŸŒ¹ ÙˆØ±Ø¯Ø© Ø­Ù…Ø±Ø§Ø¡ Ù„Ø£Ø¬Ù…Ù„ Ø­Ø¨ÙŠØ¨Ø©",
                "ğŸ« Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø­Ù„ÙˆØ© Ù…Ø«Ù„Ùƒ",
                "â­ Ù†Ø¬Ù…Ø© Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø¡ Ù„Ùƒ",
                "ğŸ¦‹ ÙØ±Ø§Ø´Ø© Ø¬Ù…ÙŠÙ„Ø© Ù…Ø«Ù„ Ø±ÙˆØ­Ùƒ",
                "ğŸŒ™ Ù‚Ù…Ø± ÙŠÙ†ÙŠØ± Ù„ÙŠÙ„Ùƒ",
                "ğŸ’ Ø¬ÙˆÙ‡Ø±Ø© Ø«Ù…ÙŠÙ†Ø© Ù…Ø«Ù„ Ù‚Ù„Ø¨Ùƒ",
                "ğŸŒº Ø²Ù‡Ø±Ø© Ø¹Ø·Ø±Ø© Ù„Ø­Ø¨ÙŠØ¨ØªÙŠ",
                "ğŸ«€ Ù‚Ù„Ø¨ÙŠ Ù„Ùƒ Ø£Ù†ØªÙŠ ÙˆØ­Ø¯Ùƒ "
            ];
            
            const randomSurprise = surprises[Math.floor(Math.random() * surprises.length)];
            showToast(randomSurprise);
            
            // Add sparkle effect
            createSparkle();
        }

        function togglePlay() {
            const playBtn = document.getElementById('playBtn');
            const icon = playBtn.querySelector('i');
            
            if (isPlaying) {
                icon.className = 'fas fa-play';
                isPlaying = false;
                showToast('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰');
            } else {
                icon.className = 'fas fa-pause';
                isPlaying = true;
                showToast('ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ© ğŸµ');
                animateProgress();
            }
        }

        function animateProgress() {
            if (isPlaying) {
                const progress = document.getElementById('musicProgress');
                let width = 0;
                const interval = setInterval(() => {
                    if (width >= 100 || !isPlaying) {
                        clearInterval(interval);
                        if (width >= 100) {
                            nextSong();
                        }
                    } else {
                        width += 0.5;
                        progress.style.width = width + '%';
                    }
                }, 100);
            }
        }

        function nextSong() {
            currentSongIndex = (currentSongIndex + 1) % songs.length;
            document.getElementById('currentSong').textContent = songs[currentSongIndex];
            document.getElementById('musicProgress').style.width = '0%';
            showToast(`Ø§Ù„Ø¢Ù†: ${songs[currentSongIndex]} ğŸµ`);
            
            if (isPlaying) {
                animateProgress();
            }
        }

        function previousSong() {
            currentSongIndex = currentSongIndex === 0 ? songs.length - 1 : currentSongIndex - 1;
            document.getElementById('currentSong').textContent = songs[currentSongIndex];
            document.getElementById('musicProgress').style.width = '0%';
            showToast(`Ø§Ù„Ø¢Ù†: ${songs[currentSongIndex]} ğŸµ`);
            
            if (isPlaying) {
                animateProgress();
            }
        }

        function toggleRecording() {
            const recordBtn = document.getElementById('recordBtn');
            const icon = recordBtn.querySelector('i');
            
            if (isRecording) {
                icon.className = 'fas fa-microphone';
                recordBtn.classList.remove('recording');
                isRecording = false;
                showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙˆØªÙŠØ©! ğŸ’•');
                addVoiceMessage();
            } else {
                icon.className = 'fas fa-stop';
                recordBtn.classList.add('recording');
                isRecording = true;
                showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... ğŸ¤');
            }
        }

        function addVoiceMessage() {
            const container = document.getElementById('voiceMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'notification';
            messageDiv.innerHTML = `
                <div class="notification-time">${new Date().toLocaleTimeString('ar-SA')}</div>
                <div>Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© ğŸ¤ğŸ’•</div>
                <button class="btn btn-secondary" style="margin-top: 10px;">ØªØ´ØºÙŠÙ„</button>
            `;
            container.appendChild(messageDiv);
        }

        function addReminder() {
            document.getElementById('reminderModal').style.display = 'block';
        }

        function saveReminder() {
            const type = document.getElementById('reminderType').value;
            const text = document.getElementById('reminderText').value;
            const time = document.getElementById('reminderTime').value;

            if (text && time) {
                const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
                reminders.push({ 
                    type, 
                    text, 
                    time, 
                    date: new Date().toISOString(),
                    id: Date.now() 
                });
                localStorage.setItem('reminders', JSON.stringify(reminders));
                
                loadNotifications();
                closeModal('reminderModal');
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙƒÙŠØ±! â°');
                
                // Clear form
                document.getElementById('reminderText').value = '';
                document.getElementById('reminderTime').value = '';
            }
        }

        function loadNotifications() {
            const notifications = document.getElementById('notifications');
            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            
            // Add some default notifications
            const defaultNotifications = [
                { text: 'Ù„Ø§ ØªÙ†Ø³ÙŠ Ø£Ù† ØªØ¨ØªØ³Ù…ÙŠ Ø§Ù„ÙŠÙˆÙ…! ğŸ˜Š', time: new Date().toLocaleTimeString('ar-SA') },
                { text: 'Ø£Ø­Ø¨Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ø£Ù…Ø³ ÙˆÙƒÙ„ ÙŠÙˆÙ… Ø£ÙƒØ«Ø±  ğŸ’•', time: new Date().toLocaleTimeString('ar-SA') },
                { text: 'Ø£Ù†Øª Ø£Ø¬Ù…Ù„ Ù…Ø§ ÙÙŠ Ø­ÙŠØ§ØªÙŠ ğŸŒ¹', time: new Date().toLocaleTimeString('ar-SA') }
            ];
            
            notifications.innerHTML = '';
            
            [...defaultNotifications, ...reminders].forEach(notification => {
                const notificationDiv = document.createElement('div');
                notificationDiv.className = 'notification';
                notificationDiv.innerHTML = `
                    <div class="notification-time">${notification.time}</div>
                    <div>${notification.text}</div>
                `;
                notifications.appendChild(notificationDiv);
            });
        }

        function updateStatistics() {
            // Animate statistics with random increments
            const stats = ['messagesCount', 'hugsCount', 'kissesCount'];
            stats.forEach(statId => {
                const element = document.getElementById(statId);
                if (element && element.textContent !== 'âˆ') {
                    const currentValue = parseInt(element.textContent.replace(',', ''));
                    const increment = Math.floor(Math.random() * 5) + 1;
                    element.textContent = (currentValue + increment).toLocaleString();
                }
            });
        }

        function loadWeatherForecast() {
            const forecast = document.getElementById('weatherForecast');
            const days = ['Ø§Ù„ÙŠÙˆÙ…', 'ØºØ¯Ø§Ù‹', 'Ø¨Ø¹Ø¯ ØºØ¯', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];
            const conditions = ['â˜€ï¸ Ù…Ø´Ù…Ø³', 'ğŸŒ™ Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠ', 'ğŸ’« Ø³Ø§Ø­Ø±', 'ğŸŒˆ Ù…Ù„ÙˆÙ†', 'ğŸŒ¸ Ø¬Ù…ÙŠÙ„'];
            
            forecast.innerHTML = '';
            
            days.forEach((day, index) => {
                const dayForecast = document.createElement('div');
                dayForecast.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 10px;
                    margin: 5px 0;
                    background: var(--blush);
                    border-radius: 10px;
                `;
                
                dayForecast.innerHTML = `
                    <span>${day}</span>
                    <span>${conditions[index]}</span>
                    <span>â™¾ï¸Â°</span>
                `;
                
                forecast.appendChild(dayForecast);
            });
        }

        function createFloatingHearts() {
            const container = document.getElementById('floatingHearts');
            
            setInterval(() => {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.textContent = ['ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’˜'][Math.floor(Math.random() * 4)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
                
                container.appendChild(heart);
                
                setTimeout(() => {
                    heart.remove();
                }, 6000);
            }, 2000);
        }

        function createSparkle() {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.textContent = 'âœ¨';
            sparkle.style.left = Math.random() * window.innerWidth + 'px';
            sparkle.style.top = Math.random() * window.innerHeight + 'px';
            
            document.body.appendChild(sparkle);
            
            setTimeout(() => {
                sparkle.remove();
            }, 2000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };

        // Update statistics periodically
        setInterval(updateStatistics, 30000); // Every 30 seconds

        // Update weather periodically
        setInterval(updateWeather, 300000); // Every 5 minutes

        // Auto-save functionality
        setInterval(() => {
            const currentData = {
                lastVisit: new Date().toISOString(),
                totalVisits: (parseInt(localStorage.getItem('totalVisits')) || 0) + 1
            };
            localStorage.setItem('appData', JSON.stringify(currentData));
        }, 60000); // Every minute
        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
let advancedTelegramSystem = null;
let advancedUI = null;

// Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    // ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø´ÙŠØ¡
    setTimeout(async () => {
        try {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...');
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
            advancedTelegramSystem = new AdvancedTelegramSystem();
            
            // Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
            await new Promise(resolve => {
                advancedTelegramSystem.on('system:ready', resolve);
                setTimeout(resolve, 5000); // Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5 Ø«ÙˆØ§Ù†
            });
            
            // ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
            advancedUI = advancedTelegramSystem.uiManager;
            
            // Ø¥ØªØ§Ø­Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¹Ø§Ù…
            window.advancedTelegramSystem = advancedTelegramSystem;
            window.advancedUI = advancedUI;
            
            console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!');
            
            // Ø¥Ø´Ø¹Ø§Ø± Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ´ØºÙŠÙ„
            if (advancedUI) {
                advancedUI.showInstantNotification('ğŸš€ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø¬Ø§Ù‡Ø²!', 'success');
            }
            
        } catch (error) {
            console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…:', error);
        }
    }, 1000);
});

// ØªÙ†Ø¸ÙŠÙ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('beforeunload', function() {
    if (advancedTelegramSystem) {
        advancedTelegramSystem.cleanup();
    }
});

// Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø©
document.addEventListener('visibilitychange', function() {
    if (!document.hidden && advancedTelegramSystem) {
        advancedTelegramSystem.instantSync();
    }
});

// Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø¨ÙƒØ©
window.addEventListener('online', function() {
    if (advancedTelegramSystem) {
        advancedTelegramSystem.instantSync();
        if (advancedUI) {
            advancedUI.showInstantNotification('ğŸŒ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„', 'success');
        }
    }
});

window.addEventListener('offline', function() {
    if (advancedUI) {
        advancedUI.showInstantNotification('âš ï¸ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'warning');
    }
});
/**
 * Ù…Ø¯ÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
 */
class AdvancedUIManager {
    constructor(telegramSystem) {
        this.telegramSystem = telegramSystem;
        this.elements = {};
        this.isInitialized = false;
        this.animationQueue = [];
    }

    async init() {
        this.createAdvancedInterface();
        this.setupAdvancedEventListeners();
        this.startRealTimeUpdates();
        this.isInitialized = true;
        console.log('ğŸ¨ ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©');
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    createAdvancedInterface() {
        let container = document.getElementById('advancedTelegramContainer');
        
        if (!container) {
            container = document.createElement('div');
            container.id = 'advancedTelegramContainer';
            container.className = 'advanced-telegram-section';
            
            const targetElement = document.querySelector('.quotes-section') || 
                                 document.querySelector('#quotesContent') ||
                                 document.body;
            
            targetElement.insertBefore(container, targetElement.firstChild);
        }
        
        container.innerHTML = this.getAdvancedHTML();
        this.cacheElements();
        this.updateDisplay();
    }

    // HTML Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
    getAdvancedHTML() {
        return `
            <div class="advanced-header">
                <div class="header-content">
                    <div class="title-section">
                        <div class="main-title">
                            <i class="fab fa-telegram pulse-icon"></i>
                            <h2>Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</h2>
                            <div class="connection-status" id="connectionStatus">
                                <div class="status-indicator"></div>
                                <span class="status-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
                            </div>
                        </div>
                        <div class="subtitle">
                            <p>ğŸ’• Ø¥Ø±Ø³Ø§Ù„ ÙÙˆØ±ÙŠ â€¢ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© â€¢ Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>
                        </div>
                    </div>
                    
                    <div class="stats-dashboard">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“¨</div>
                            <div class="stat-info">
                                <span class="stat-number" id="totalMessagesCount">0</span>
                                <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ‘€</div>
                            <div class="stat-info">
                                <span class="stat-number" id="viewedMessagesCount">0</span>
                                <span class="stat-label">ØªÙ… Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡Ø§</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">â±ï¸</div>
                            <div class="stat-info">
                                <span class="stat-number" id="lastSyncTime">--:--</span>
                                <span class="stat-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“Š</div>
                            <div class="stat-info">
                                <span class="stat-number" id="viewRate">0%</span>
                                <span class="stat-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-panel">
                    <button class="control-btn primary" onclick="advancedUI.forceSync()" title="Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©">
                        <i class="fas fa-sync-alt"></i>
                        <span>Ù…Ø²Ø§Ù…Ù†Ø©</span>
                    </button>
                    <button class="control-btn secondary" onclick="advancedUI.showViewStats()" title="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©">
                        <i class="fas fa-chart-line"></i>
                        <span>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
                    </button>
                    <button class="control-btn info" onclick="advancedUI.showConnectionInfo()" title="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„">
                        <i class="fas fa-info-circle"></i>
                        <span>Ø§Ù„Ø§ØªØµØ§Ù„</span>
                    </button>
                </div>
            </div>
            
            <div class="messages-section">
                <div class="section-tabs">
                    <button class="tab-btn active" onclick="advancedUI.switchTab('all')" data-tab="all">
                        <i class="fas fa-list"></i>
                        Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                    </button>
                    <button class="tab-btn" onclick="advancedUI.switchTab('unviewed')" data-tab="unviewed">
                        <i class="fas fa-eye-slash"></i>
                        ØºÙŠØ± Ù…Ø´Ø§Ù‡Ø¯Ø©
                        <span class="badge" id="unviewedBadge">0</span>
                    </button>
                    <button class="tab-btn" onclick="advancedUI.switchTab('viewed')" data-tab="viewed">
                        <i class="fas fa-eye"></i>
                        ØªÙ… Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡Ø§
                    </button>
                </div>
                
                <div class="messages-container">
                    <div id="messagesDisplay" class="messages-display">
                        <div class="loading-state">
                            <div class="loading-animation">
                                <div class="pulse-dot"></div>
                                <div class="pulse-dot"></div>
                                <div class="pulse-dot"></div>
                            </div>
                            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer-section">
                <div class="quick-info">
                    <div class="info-item">
                        <i class="fas fa-bolt"></i>
                        <span>Ù…Ø²Ø§Ù…Ù†Ø© ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-eye"></i>
                        <span>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-heart"></i>
                        <span>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ©</span>
                    </div>
                </div>
                
                <div class="send-instructions">
                    <h4>ğŸ’Œ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:</h4>
                    <p>Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ÙˆØ³ØªØ±Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙˆØ±Ø§Ù‹ Ù‡Ù†Ø§!</p>
                    <p>ğŸ‘€ Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯Ù…Ø§ ØªØªÙ… Ù…Ø´Ø§Ù‡Ø¯Ø© Ø±Ø³Ø§Ù„ØªÙƒ</p>
                </div>
            </div>
        `;
    }

    // ØªØ®Ø²ÙŠÙ† Ù…Ø¤Ù‚Øª Ù„Ù„Ø¹Ù†Ø§ØµØ±
    cacheElements() {
        this.elements = {
            connectionStatus: document.getElementById('connectionStatus'),
            totalMessagesCount: document.getElementById('totalMessagesCount'),
            viewedMessagesCount: document.getElementById('viewedMessagesCount'),
            lastSyncTime: document.getElementById('lastSyncTime'),
            viewRate: document.getElementById('viewRate'),
            unviewedBadge: document.getElementById('unviewedBadge'),
            messagesDisplay: document.getElementById('messagesDisplay')
        };
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    setupAdvancedEventListeners() {
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø¸Ø§Ù…
        this.telegramSystem.on('message:instant', (event) => {
            this.onInstantMessage(event.detail);
        });
        
        this.telegramSystem.on('message:viewed', (event) => {
            this.onMessageViewed(event.detail);
        });
        
        this.telegramSystem.on('connection:quality', (event) => {
            this.updateConnectionStatus(event.detail);
        });
        
        this.telegramSystem.on('sync:instant', (event) => {
            this.onInstantSync(event.detail);
        });
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©
    startRealTimeUpdates() {
        // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
        setInterval(() => {
            this.updateStats();
            this.updateLastSyncTime();
        }, 1000);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§ØªØµØ§Ù„ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†
        setInterval(() => {
            this.updateConnectionDisplay();
        }, 5000);
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©
    onInstantMessage(message) {
        this.addMessageToDisplay(message);
        this.updateStats();
        this.showInstantNotification('ğŸ’Œ ÙˆØµÙ„Øª Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©!');
        this.startViewTracking(message);
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    onMessageViewed(data) {
        this.markMessageAsViewed(data.messageId);
        this.updateStats();
        this.showViewNotification(data.messageId);
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©
    onInstantSync(data) {
        if (data.count > 0) {
            this.updateDisplay();
        }
        this.updateLastSyncTime();
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¹Ø±Ø¶
    addMessageToDisplay(message) {
        const messageElement = this.createMessageElement(message);
        
        // Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
        const container = this.elements.messagesDisplay;
        if (container.firstChild && container.firstChild.classList?.contains('loading-state')) {
            container.innerHTML = '';
        }
        
        container.insertBefore(messageElement, container.firstChild);
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ±
        requestAnimationFrame(() => {
            messageElement.classList.add('message-appear');
        });
        
        // Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
        this.telegramSystem.viewTracker.observeElement(messageElement, message.id);
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    createMessageElement(message) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message-item advanced';
        messageDiv.dataset.messageId = message.id;
        
        const timeAgo = this.getTimeAgo(new Date(message.timestamp));
        const isRecent = Date.now() - new Date(message.timestamp).getTime() < 60000; // Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©
        
        messageDiv.innerHTML = `
            <div class="message-header">
                <div class="message-meta">
                    <div class="author-info">
                        <span class="author-name">${message.author}</span>
                        <span class="message-time">${timeAgo}</span>
                    </div>
                    <div class="message-status">
                        ${isRecent ? '<span class="new-badge">Ø¬Ø¯ÙŠØ¯</span>' : ''}
                        <div class="view-status" id="viewStatus_${message.id}">
                            <i class="fas fa-clock"></i>
                            <span>ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="message-content">
                <p class="message-text">${this.escapeHTML(message.text)}</p>
            </div>
            
            <div class="message-footer">
                <div class="message-actions">
                    <button class="action-btn" onclick="advancedUI.displayAsQuote('${this.escapeHTML(message.text)}', '${message.author}')">
                        <i class="fas fa-quote-right"></i>
                        Ø¹Ø±Ø¶ ÙƒØ§Ù‚ØªØ¨Ø§Ø³
                    </button>
                    <button class="action-btn secondary" onclick="advancedUI.copyMessage('${this.escapeHTML(message.text)}')">
                        <i class="fas fa-copy"></i>
                        Ù†Ø³Ø®
                    </button>
                </div>
                
                <div class="view-tracker">
                    <div class="tracker-dot"></div>
                    <span class="tracker-text">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù†Ø´Ø·Ø©</span>
                </div>
            </div>
        `;
        
        return messageDiv;
    }

    // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ø´Ø§Ù‡Ø¯Ø©
    markMessageAsViewed(messageId) {
        const viewStatus = document.getElementById(`viewStatus_${messageId}`);
        if (viewStatus) {
            viewStatus.innerHTML = `
                <i class="fas fa-eye text-success"></i>
                <span class="text-success">ØªÙ… Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
            const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
            if (messageElement) {
                messageElement.classList.add('message-viewed');
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
                const viewIndicator = document.createElement('div');
                viewIndicator.className = 'view-indicator-overlay';
                viewIndicator.innerHTML = `
                    <div class="view-animation">
                        <i class="fas fa-eye"></i>
                        <span>ØªÙ… Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©!</span>
                    </div>
                `;
                
                messageElement.appendChild(viewIndicator);
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
                setTimeout(() => {
                    viewIndicator.remove();
                }, 3000);
            }
        }
    }

    // Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    startViewTracking(message) {
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
        setTimeout(() => {
            const messageElement = document.querySelector(`[data-message-id="${message.id}"]`);
            if (messageElement) {
                const tracker = messageElement.querySelector('.view-tracker');
                if (tracker) {
                    tracker.classList.add('tracking-active');
                }
            }
        }, 1000);
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    updateStats() {
        const stats = this.telegramSystem.messageStore.getViewStats();
        
        if (this.elements.totalMessagesCount) {
            this.animateNumber(this.elements.totalMessagesCount, stats.total);
        }
        
        if (this.elements.viewedMessagesCount) {
            this.animateNumber(this.elements.viewedMessagesCount, stats.viewed);
        }
        
        if (this.elements.viewRate) {
            this.elements.viewRate.textContent = `${stats.viewRate}%`;
        }
        
        if (this.elements.unviewedBadge) {
            this.elements.unviewedBadge.textContent = stats.unviewed;
            this.elements.unviewedBadge.style.display = stats.unviewed > 0 ? 'inline' : 'none';
        }
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©
    updateLastSyncTime() {
        if (this.elements.lastSyncTime) {
            this.elements.lastSyncTime.textContent = new Date().toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    updateConnectionStatus(quality) {
        if (!this.elements.connectionStatus) return;
        
        const indicator = this.elements.connectionStatus.querySelector('.status-indicator');
        const text = this.elements.connectionStatus.querySelector('.status-text');
        
        const statusConfig = {
            'excellent': { class: 'excellent', text: 'Ù…Ù…ØªØ§Ø²', color: '#4caf50' },
            'good': { class: 'good', text: 'Ø¬ÙŠØ¯', color: '#8bc34a' },
            'fair': { class: 'fair', text: 'Ù…ØªÙˆØ³Ø·', color: '#ff9800' },
            'poor': { class: 'poor', text: 'Ø¶Ø¹ÙŠÙ', color: '#f44336' },
            'error': { class: 'error', text: 'Ø®Ø·Ø£', color: '#e91e63' }
        };
        
        const config = statusConfig[quality] || statusConfig['poor'];
        
        indicator.className = `status-indicator ${config.class}`;
        text.textContent = config.text;
        text.style.color = config.color;
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø§ØªØµØ§Ù„
    updateConnectionDisplay() {
        const status = this.telegramSystem.getSystemStatus();
        this.updateConnectionStatus(status.connectionQuality);
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„
    updateDisplay() {
        const currentTab = document.querySelector('.tab-btn.active')?.dataset.tab || 'all';
        this.switchTab(currentTab);
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
    switchTab(tabName) {
        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        let messages = [];
        switch(tabName) {
            case 'all':
                messages = Array.from(this.telegramSystem.messageStore.cache.values());
                break;
            case 'unviewed':
                messages = this.telegramSystem.messageStore.getUnviewedMessages();
                break;
            case 'viewed':
                messages = this.telegramSystem.messageStore.getViewedMessages();
                break;
        }
        
        this.displayMessages(messages);
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    displayMessages(messages) {
        if (!this.elements.messagesDisplay) return;
        
        if (messages.length === 0) {
            this.elements.messagesDisplay.innerHTML = this.getEmptyStateHTML();
            return;
        }
        
        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
        messages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        this.elements.messagesDisplay.innerHTML = '';
        
        messages.forEach((message, index) => {
            const messageElement = this.createMessageElement(message);
            messageElement.style.animationDelay = `${index * 0.1}s`;
            this.elements.messagesDisplay.appendChild(messageElement);
            
            // Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
            if (!message.viewed) {
                this.telegramSystem.viewTracker.observeElement(messageElement, message.id);
            }
        });
    }

    // HTML Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ©
    getEmptyStateHTML() {
        return `
            <div class="empty-state advanced">
                <div class="empty-animation">
                    <i class="fab fa-telegram"></i>
                    <div class="pulse-ring"></div>
                </div>
                <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</h3>
                <p>Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù„ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ÙÙˆØ±Ø§Ù‹</p>
                <div class="empty-features">
                    <div class="feature-item">
                        <i class="fas fa-bolt"></i>
                        <span>Ø¥Ø±Ø³Ø§Ù„ ÙÙˆØ±ÙŠ</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-eye"></i>
                        <span>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-bell"></i>
                        <span>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</span>
                    </div>
                </div>
            </div>
        `;
    }

    // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©
    async forceSync() {
        const syncBtn = document.querySelector('.control-btn.primary i');
        if (syncBtn) {
            syncBtn.classList.add('fa-spin');
        }
        
        await this.telegramSystem.instantSync();
        this.showInstantNotification('ğŸ”„ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­');
        
        setTimeout(() => {
            if (syncBtn) {
                syncBtn.classList.remove('fa-spin');
            }
        }, 1000);
    }

    // Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    showViewStats() {
        const stats = this.telegramSystem.messageStore.getViewStats();
        const viewStats = this.telegramSystem.viewTracker.getViewStats();
        
        const modal = this.createModal('ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', `
            <div class="stats-grid">
                <div class="stat-card-modal">
                    <h4>ğŸ“¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h4>
                    <div class="stat-value-large">${stats.total}</div>
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©</p>
                </div>
                
                <div class="stat-card-modal">
                    <h4>ğŸ‘€ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</h4>
                    <div class="stat-value-large">${stats.viewed}</div>
                    <p>Ø±Ø³Ø§Ø¦Ù„ ØªÙ… Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡Ø§</p>
                </div>
                
                <div class="stat-card-modal">
                    <h4>ğŸ“Š Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h4>
                    <div class="stat-value-large">${stats.viewRate}%</div>
                    <p>Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</p>
                </div>
                
                <div class="stat-card-modal">
                    <h4>â±ï¸ Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h4>
                    <div class="stat-value-large">${viewStats.averageViewTime}Ø«</div>
                    <p>Ø§Ù„ÙˆÙ‚Øª Ø­ØªÙ‰ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</p>
                </div>
            </div>
            
            <div class="progress-section">
                <h4>ğŸ“ˆ ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h4>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${stats.viewRate}%"></div>
                </div>
                <p>${stats.viewed} Ù…Ù† ${stats.total} Ø±Ø³Ø§Ù„Ø© ØªÙ… Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡Ø§</p>
            </div>
        `);
        
        document.body.appendChild(modal);
    }

    // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
    showConnectionInfo() {
        const status = this.telegramSystem.getSystemStatus();
        
        const modal = this.createModal('ğŸ”— Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„', `
            <div class="connection-info">
                <div class="info-section">
                    <h4>ğŸŒ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</h4>
                    <div class="status-display ${status.connectionQuality}">
                        <div class="status-dot"></div>
                        <span>${this.getQualityText(status.connectionQuality)}</span>
                    </div>
                </div>
                
                <div class="info-section">
                    <h4>âš¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</h4>
                    <p>ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø© (ÙÙˆØ±ÙŠ)</p>
                    <p>Ø¢Ø®Ø± Ù†Ø¨Ø¶Ø© Ù‚Ù„Ø¨: ${status.lastHeartbeat ? new Date(status.lastHeartbeat).toLocaleTimeString('ar-SA') : 'ØºÙŠØ± Ù…ØªØ§Ø­'}</p>
                </div>
                
                <div class="info-section">
                    <h4>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h4>
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${status.totalMessages}</p>
                    <p>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©: ${status.viewedMessages}</p>
                    <p>Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„: ${status.retryCount}</p>
                </div>
                
                <div class="info-section">
                    <h4>ğŸ”§ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h4>
                    <ul class="features-list">
                        <li>âœ… Ø¥Ø±Ø³Ø§Ù„ ÙÙˆØ±ÙŠ (Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø©)</li>
                        <li>âœ… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</li>
                        <li>âœ… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</li>
                        <li>âœ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</li>
                        <li>âœ… Ù†Ø¨Ø¶Ø§Øª Ø§Ù„Ù‚Ù„Ø¨</li>
                    </ul>
                </div>
            </div>
        `);
        
        document.body.appendChild(modal);
    }

    // Ø¹Ø±Ø¶ ÙƒØ§Ù‚ØªØ¨Ø§Ø³
    displayAsQuote(text, author) {
        if (typeof displayQuote === 'function') {
            displayQuote(text, `ğŸ’Œ ${author}`);
            this.showInstantNotification('âœ¨ ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒØ§Ù‚ØªØ¨Ø§Ø³!');
        }
    }

    // Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    async copyMessage(text) {
        try {
            await navigator.clipboard.writeText(text);
            this.showInstantNotification('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©');
        } catch (err) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®:', err);
        }
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
    createModal(title, content) {
        const modal = document.createElement('div');
        modal.className = 'advanced-modal';
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h3>${title}</h3>
                    <button class="close-btn" onclick="this.closest('.advanced-modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    ${content}
                </div>
            </div>
        `;
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
        
        return modal;
    }

    // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± ÙÙˆØ±ÙŠ
    showInstantNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `instant-notification ${type}`;
        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ±
        requestAnimationFrame(() => {
            notification.classList.add('show');
        });
        
        // Ø¥Ø²Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 3000);
    }

    // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    showViewNotification(messageId) {
        const message = this.telegramSystem.messageStore.cache.get(messageId);
        if (!message) return;
        
        const shortText = message.text.length > 30 ? 
            message.text.substring(0, 30) + '...' : message.text;
        
        this.showInstantNotification(`ğŸ‘€ ØªÙ… Ù…Ø´Ø§Ù‡Ø¯Ø©: "${shortText}"`, 'info');
    }

    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    animateNumber(element, targetNumber) {
        const currentNumber = parseInt(element.textContent) || 0;
        if (currentNumber === targetNumber) return;
        
        const increment = targetNumber > currentNumber ? 1 : -1;
        const duration = Math.abs(targetNumber - currentNumber) * 50;
        const steps = Math.abs(targetNumber - currentNumber);
        const stepDuration = duration / steps;
        
        let current = currentNumber;
        const timer = setInterval(() => {
            current += increment;
            element.textContent = current;
            
            if (current === targetNumber) {
                clearInterval(timer);
            }
        }, stepDuration);
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø¬ÙˆØ¯Ø©
    getQualityText(quality) {
        const texts = {
            'excellent': 'Ù…Ù…ØªØ§Ø²',
            'good': 'Ø¬ÙŠØ¯',
            'fair': 'Ù…ØªÙˆØ³Ø·',
            'poor': 'Ø¶Ø¹ÙŠÙ',
            'error': 'Ø®Ø·Ø£'
        };
        return texts[quality] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ
    getTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffSecs = Math.floor(diffMs / 1000);
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        
        if (diffSecs < 60) return 'Ø§Ù„Ø¢Ù†';
        if (diffMins < 60) return `${diffMins} Ø¯`;
        if (diffHours < 24) return `${diffHours} Ø³`;
        
        return date.toLocaleDateString('ar-SA');
    }

    // ØªØ´ÙÙŠØ± HTML
    escapeHTML(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
}
/**
 * Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
 */
class AdvancedMessageStore {
    constructor() {
        this.storageKey = 'telegram_messages_advanced_v2';
        this.viewsKey = 'telegram_message_views';
        this.cache = new Map();
        this.viewsCache = new Map();
        this.isInitialized = false;
    }

    async init() {
        await this.loadFromStorage();
        await this.loadViewsFromStorage();
        this.isInitialized = true;
        console.log('ğŸ’¾ ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…');
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
    async loadFromStorage() {
        try {
            const stored = localStorage.getItem(this.storageKey);
            if (stored) {
                const data = JSON.parse(stored);
                data.forEach(message => {
                    this.cache.set(message.id, message);
                });
            }
            console.log(`ğŸ“¥ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${this.cache.size} Ø±Ø³Ø§Ù„Ø©`);
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:', error);
        }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    async loadViewsFromStorage() {
        try {
            const stored = localStorage.getItem(this.viewsKey);
            if (stored) {
                const data = JSON.parse(stored);
                data.forEach(view => {
                    this.viewsCache.set(view.messageId, view);
                });
            }
            console.log(`ğŸ‘€ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${this.viewsCache.size} Ù…Ø´Ø§Ù‡Ø¯Ø©`);
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª:', error);
        }
    }

    // Ø­ÙØ¸ ÙÙˆØ±ÙŠ
    async saveInstant() {
        try {
            // Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            const messages = Array.from(this.cache.values());
            localStorage.setItem(this.storageKey, JSON.stringify(messages));
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
            const views = Array.from(this.viewsCache.values());
            localStorage.setItem(this.viewsKey, JSON.stringify(views));
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª
            await this.syncWithQuotesInstant();
            
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ÙÙˆØ±ÙŠ:', error);
        }
    }

    // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ù…Ø¹ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª
    async syncWithQuotesInstant() {
        const quotes = JSON.parse(localStorage.getItem('customQuotes') || '[]');
        const nonTelegramQuotes = quotes.filter(q => q.source !== 'telegram');
        
        const telegramMessages = Array.from(this.cache.values()).map(msg => {
            const view = this.viewsCache.get(msg.id);
            return {
                id: msg.id,
                text: msg.text,
                author: msg.author,
                date: new Date(msg.timestamp).toLocaleDateString('ar-SA'),
                time: new Date(msg.timestamp).toLocaleTimeString('ar-SA', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                }),
                source: 'telegram',
                telegramMessageId: msg.telegramMessageId,
                telegramUserId: msg.telegramUserId,
                viewed: view ? view.viewed : false,
                viewTime: view ? view.viewTime : null,
                viewDuration: view ? view.viewDuration : null
            };
        });
        
        const allQuotes = [...nonTelegramQuotes, ...telegramMessages];
        localStorage.setItem('customQuotes', JSON.stringify(allQuotes));
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ÙÙˆØ±ÙŠØ©
    async addMessageInstant(messageData) {
        const message = {
            id: Date.now() + Math.random(),
            text: messageData.text,
            author: messageData.author,
            telegramMessageId: messageData.telegramMessageId,
            telegramUserId: messageData.telegramUserId,
            source: 'telegram',
            timestamp: messageData.timestamp || new Date().toISOString(),
            created: new Date().toISOString(),
            viewed: false
        };
        
        this.cache.set(message.id, message);
        await this.saveInstant();
        
        return message;
    }

    // ØªÙ…ÙŠÙŠØ² ÙƒÙ…Ø´Ø§Ù‡Ø¯Ø©
    async markAsViewed(messageId, viewTime) {
        const view = {
            messageId: messageId,
            viewed: true,
            viewTime: viewTime,
            viewDuration: Date.now() - (this.cache.get(messageId)?.created ? new Date(this.cache.get(messageId).created).getTime() : Date.now())
        };
        
        this.viewsCache.set(messageId, view);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        const message = this.cache.get(messageId);
        if (message) {
            message.viewed = true;
            message.viewTime = viewTime;
            this.cache.set(messageId, message);
        }
        
        await this.saveInstant();
        return view;
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø©
    async getMessage(messageId) {
        return this.cache.get(messageId);
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ù…Ø´Ø§Ù‡Ø¯Ø©
    getUnviewedMessages() {
        return Array.from(this.cache.values()).filter(msg => !msg.viewed);
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ø¦Ù„ Ù…Ø´Ø§Ù‡Ø¯Ø©
    getViewedMessages() {
        return Array.from(this.cache.values()).filter(msg => msg.viewed);
    }

    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    getViewStats() {
        const total = this.cache.size;
        const viewed = this.getViewedMessages().length;
        const unviewed = this.getUnviewedMessages().length;
        
        return {
            total,
            viewed,
            unviewed,
            viewRate: total > 0 ? (viewed / total * 100).toFixed(1) : 0
        };
    }

    // Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø¨Ù…Ø¹Ø±Ù ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    async deleteByTelegramId(telegramMessageId) {
        const message = Array.from(this.cache.values()).find(
            msg => msg.telegramMessageId === telegramMessageId
        );
        
        if (message) {
            this.cache.delete(message.id);
            this.viewsCache.delete(message.id);
            await this.saveInstant();
            return true;
        }
        
        return false;
    }

    // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    async clearAll() {
        const count = this.cache.size;
        this.cache.clear();
        this.viewsCache.clear();
        await this.saveInstant();
        return count;
    }
}
/**
 * Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
 */
class ViewTracker {
    constructor(telegramSystem) {
        this.telegramSystem = telegramSystem;
        this.trackedMessages = new Map();
        this.observers = new Map();
        this.isTracking = false;
        this.trackingInterval = null;
    }

    async init() {
        this.setupIntersectionObserver();
        this.setupVisibilityTracking();
        this.setupScrollTracking();
        console.log('ğŸ‘€ ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©');
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
    startGlobalTracking() {
        this.isTracking = true;
        
        // Ù…ØªØ§Ø¨Ø¹Ø© ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
        this.trackingInterval = setInterval(() => {
            this.checkVisibleMessages();
        }, 1000);
        
        // Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ±
        this.setupScrollListener();
        
        console.log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©');
    }

    // Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø±Ø³Ø§Ù„Ø© Ù…Ø­Ø¯Ø¯Ø©
    startTracking(messageId) {
        if (!this.trackedMessages.has(messageId)) {
            this.trackedMessages.set(messageId, {
                id: messageId,
                startTime: Date.now(),
                viewed: false,
                viewTime: null,
                viewDuration: 0,
                scrolledTo: false,
                fullyVisible: false
            });
            
            console.log(`ğŸ‘ï¸ Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${messageId}`);
        }
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªÙ‚Ø§Ø·Ø¹
    setupIntersectionObserver() {
        this.intersectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const messageId = entry.target.dataset.messageId;
                if (messageId && this.trackedMessages.has(messageId)) {
                    this.handleIntersection(messageId, entry);
                }
            });
        }, {
            threshold: [0.1, 0.5, 0.9], // Ù…Ø³ØªÙˆÙŠØ§Øª Ù…Ø®ØªÙ„ÙØ© Ù…Ù† Ø§Ù„Ø±Ø¤ÙŠØ©
            rootMargin: '0px'
        });
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªÙ‚Ø§Ø·Ø¹
    handleIntersection(messageId, entry) {
        const tracking = this.trackedMessages.get(messageId);
        
        if (entry.isIntersecting) {
            if (entry.intersectionRatio >= 0.5 && !tracking.viewed) {
                // Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø±Ø¦ÙŠØ© Ø¨Ù†Ø³Ø¨Ø© 50% Ø£Ùˆ Ø£ÙƒØ«Ø±
                this.markAsViewed(messageId);
            }
            
            if (entry.intersectionRatio >= 0.9) {
                tracking.fullyVisible = true;
            }
        } else {
            tracking.fullyVisible = false;
        }
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø±Ø¤ÙŠØ©
    setupVisibilityTracking() {
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¹ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØµÙØ­Ø©
                setTimeout(() => {
                    this.checkVisibleMessages();
                }, 500);
            }
        });
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ±
    setupScrollTracking() {
        let scrollTimeout;
        
        window.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                this.checkVisibleMessages();
            }, 100);
        });
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ±
    setupScrollListener() {
        let isScrolling = false;
        
        window.addEventListener('scroll', () => {
            if (!isScrolling) {
                isScrolling = true;
                requestAnimationFrame(() => {
                    this.updateScrollPositions();
                    isScrolling = false;
                });
            }
        });
    }

    // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ±
    updateScrollPositions() {
        this.trackedMessages.forEach((tracking, messageId) => {
            const element = document.querySelector(`[data-message-id="${messageId}"]`);
            if (element) {
                const rect = element.getBoundingClientRect();
                const isVisible = rect.top >= 0 && rect.bottom <= window.innerHeight;
                
                if (isVisible && !tracking.scrolledTo) {
                    tracking.scrolledTo = true;
                    console.log(`ğŸ“œ ØªÙ… Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø±Ø³Ø§Ù„Ø©: ${messageId}`);
                }
            }
        });
    }

    // ÙØ­Øµ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø¦ÙŠØ©
    checkVisibleMessages() {
        if (!this.isTracking) return;
        
        this.trackedMessages.forEach((tracking, messageId) => {
            if (!tracking.viewed) {
                const element = document.querySelector(`[data-message-id="${messageId}"]`);
                if (element && this.isElementVisible(element)) {
                    this.markAsViewed(messageId);
                }
            }
        });
    }

    // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ØµØ± Ù…Ø±Ø¦ÙŠ
    isElementVisible(element) {
        const rect = element.getBoundingClientRect();
        const windowHeight = window.innerHeight || document.documentElement.clientHeight;
        const windowWidth = window.innerWidth || document.documentElement.clientWidth;
        
        // Ø§Ù„Ø¹Ù†ØµØ± Ù…Ø±Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† 50% Ù…Ù†Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
        const verticalVisible = rect.top < windowHeight && rect.bottom > 0;
        const horizontalVisible = rect.left < windowWidth && rect.right > 0;
        const visibleHeight = Math.min(rect.bottom, windowHeight) - Math.max(rect.top, 0);
        const visibleRatio = visibleHeight / rect.height;
        
        return verticalVisible && horizontalVisible && visibleRatio >= 0.5;
    }

    // ØªÙ…ÙŠÙŠØ² ÙƒÙ…Ø´Ø§Ù‡Ø¯Ø©
    async markAsViewed(messageId) {
        const tracking = this.trackedMessages.get(messageId);
        if (!tracking || tracking.viewed) return;
        
        tracking.viewed = true;
        tracking.viewTime = new Date().toISOString();
        tracking.viewDuration = Date.now() - tracking.startTime;
        
        // ØªØ­Ø¯ÙŠØ« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await this.telegramSystem.messageStore.markAsViewed(messageId, tracking.viewTime);
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
        await this.sendViewNotification(messageId, tracking);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        this.telegramSystem.emit('message:viewed', { messageId, tracking });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        this.telegramSystem.state.viewedMessages++;
        
        console.log(`âœ… ØªÙ… ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒÙ…Ø´Ø§Ù‡Ø¯Ø©: ${messageId}`);
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    async sendViewNotification(messageId, tracking) {
        const message = await this.telegramSystem.messageStore.getMessage(messageId);
        if (!message) return;
        
        const viewTime = new Date(tracking.viewTime);
        const duration = Math.round(tracking.viewDuration / 1000);
        
        const notificationText = `
ğŸ‘€ ØªÙ… Ù…Ø´Ø§Ù‡Ø¯Ø© Ø±Ø³Ø§Ù„ØªÙƒ!

ğŸ’Œ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: "${message.text.substring(0, 50)}${message.text.length > 50 ? '...' : ''}"

â° Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©:
â€¢ ÙˆÙ‚Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©: ${viewTime.toLocaleTimeString('ar-SA')}
â€¢ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©: ${viewTime.toLocaleDateString('ar-SA')}
â€¢ Ù…Ø¯Ø© Ø§Ù„ÙˆØµÙˆÙ„: ${duration} Ø«Ø§Ù†ÙŠØ©

ğŸ’• Ø­Ø¨ÙŠØ¨ØªÙƒ Ø´Ø§Ù‡Ø¯Øª Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø¢Ù†!
        `.trim();
        
        await this.telegramSystem.sendMessageInstant(notificationText);
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        this.addViewEffect(messageId);
    }

    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    addViewEffect(messageId) {
        const element = document.querySelector(`[data-message-id="${messageId}"]`);
        if (element) {
            element.classList.add('message-viewed');
            
            // Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
            const viewIcon = document.createElement('div');
            viewIcon.className = 'view-indicator';
            viewIcon.innerHTML = 'ğŸ‘€ ØªÙ… Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©';
            element.appendChild(viewIcon);
            
            // ØªØ£Ø«ÙŠØ± ÙˆÙ…ÙŠØ¶
            element.style.animation = 'viewedFlash 2s ease-in-out';
        }
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯
    observeElement(element, messageId) {
        if (this.intersectionObserver && element) {
            element.dataset.messageId = messageId;
            this.intersectionObserver.observe(element);
            this.startTracking(messageId);
        }
    }

    // Ø¥Ù„ØºØ§Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ù†ØµØ±
    unobserveElement(element) {
        if (this.intersectionObserver && element) {
            this.intersectionObserver.unobserve(element);
        }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    getViewStats() {
        const totalTracked = this.trackedMessages.size;
        const totalViewed = Array.from(this.trackedMessages.values()).filter(t => t.viewed).length;
        const averageViewTime = this.calculateAverageViewTime();
        
        return {
            totalTracked,
            totalViewed,
            viewRate: totalTracked > 0 ? (totalViewed / totalTracked * 100).toFixed(1) : 0,
            averageViewTime
        };
    }

    // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    calculateAverageViewTime() {
        const viewedMessages = Array.from(this.trackedMessages.values()).filter(t => t.viewed);
        if (viewedMessages.length === 0) return 0;
        
        const totalDuration = viewedMessages.reduce((sum, t) => sum + t.viewDuration, 0);
        return Math.round(totalDuration / viewedMessages.length / 1000); // Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
    }

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
    cleanup() {
        if (this.trackingInterval) {
            clearInterval(this.trackingInterval);
        }
        
        if (this.intersectionObserver) {
            this.intersectionObserver.disconnect();
        }
        
        this.isTracking = false;
        console.log('ğŸ§¹ ØªÙ… ØªÙ†Ø¸ÙŠÙ Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©');
    }
}
/**
 * Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
 * Advanced Direct Send & Tracking System
 */
class AdvancedTelegramSystem {
    constructor() {
        this.config = {
            botToken: TELEGRAM_CONFIG.BOT_TOKEN,
            chatId: TELEGRAM_CONFIG.CHAT_ID,
            instantSync: true,
            syncInterval: 1000, // Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
            maxRetries: 5,
            timeout: 5000,
            batchSize: 100,
            trackViews: true,
            autoConnect: true
        };
        
        this.state = {
            isOnline: false,
            lastHeartbeat: null,
            connectionQuality: 'excellent',
            messageQueue: new Map(),
            viewTracker: new Map(),
            syncTimer: null,
            heartbeatTimer: null,
            retryCount: 0,
            totalMessages: 0,
            viewedMessages: 0
        };
        
        this.events = new EventTarget();
        this.messageStore = new AdvancedMessageStore();
        this.viewTracker = new ViewTracker(this);
        this.directSender = new DirectSender(this);
        this.uiManager = new AdvancedUIManager(this);
        
        this.init();
    }

    // ØªÙ‡ÙŠØ¦Ø© ÙÙˆØ±ÙŠØ© ÙˆÙ…ØªÙ‚Ø¯Ù…Ø©
    async init() {
        try {
            console.log('ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...');
            
            // ØªÙ‡ÙŠØ¦Ø© ÙÙˆØ±ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø±
            await Promise.all([
                this.messageStore.init(),
                this.viewTracker.init(),
                this.directSender.init(),
                this.uiManager.init()
            ]);
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„ÙÙˆØ±ÙŠ
            await this.startInstantConnection();
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
            this.startViewTracking();
            
            // ØªÙØ¹ÙŠÙ„ Ù†Ø¨Ø¶Ø§Øª Ø§Ù„Ù‚Ù„Ø¨
            this.startHeartbeat();
            
            this.state.isOnline = true;
            this.emit('system:ready');
            
            console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„');
            
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©:', error);
            this.handleConnectionError(error);
        }
    }

    // Ø§ØªØµØ§Ù„ ÙÙˆØ±ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ
    async startInstantConnection() {
        // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©
        await this.instantSync();
        
        // Ù…Ø²Ø§Ù…Ù†Ø© ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
        this.state.syncTimer = setInterval(() => {
            this.instantSync();
        }, this.config.syncInterval);
        
        console.log('âš¡ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© (ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©)');
    }

    // Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©
    async instantSync() {
        if (this.state.isProcessing) return;
        
        try {
            this.state.isProcessing = true;
            
            const updates = await this.fetchUpdatesInstant();
            
            if (updates.length > 0) {
                // Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙˆØ±ÙŠØ© Ù…ØªÙˆØ§Ø²ÙŠØ©
                await Promise.all(updates.map(update => this.processUpdateInstant(update)));
                this.updateLastUpdateId(updates);
                this.emit('sync:instant', { count: updates.length });
            }
            
            this.state.retryCount = 0;
            this.updateConnectionQuality('excellent');
            
        } catch (error) {
            this.handleSyncError(error);
        } finally {
            this.state.isProcessing = false;
        }
    }

    // Ø¬Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠ
    async fetchUpdatesInstant() {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), this.config.timeout);
        
        try {
            const response = await fetch(`https://api.telegram.org/bot${this.config.botToken}/getUpdates`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    offset: this.getLastUpdateId() + 1,
                    limit: this.config.batchSize,
                    timeout: 1 // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙÙˆØ±ÙŠ
                }),
                signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            const data = await response.json();
            
            return data.ok ? data.result : [];
            
        } catch (error) {
            clearTimeout(timeoutId);
            throw error;
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙˆØ±ÙŠØ© Ù„Ù„ØªØ­Ø¯ÙŠØ«
    async processUpdateInstant(update) {
        this.setLastUpdateId(update.update_id);
        
        if (update.message) {
            await this.handleInstantMessage(update.message);
        } else if (update.edited_message) {
            await this.handleEditedMessage(update.edited_message);
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙÙˆØ±ÙŠØ©
    async handleInstantMessage(message) {
        const messageData = {
            id: message.message_id,
            text: message.text,
            from: message.from,
            date: message.date,
            chat: message.chat
        };
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
        if (messageData.text?.startsWith('/')) {
            await this.processCommand(messageData);
            return;
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙÙˆØ±Ø§Ù‹
        if (messageData.text?.trim()) {
            await this.addMessageInstant(messageData);
        }
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ÙÙˆØ±ÙŠØ©
    async addMessageInstant(messageData) {
        const quote = await this.messageStore.addMessageInstant({
            text: messageData.text.trim(),
            author: messageData.from.first_name || 'Ø­Ø¨ÙŠØ¨ÙŠ',
            telegramMessageId: messageData.id,
            telegramUserId: messageData.from.id,
            source: 'telegram',
            timestamp: new Date(messageData.date * 1000).toISOString(),
            viewed: false,
            viewTime: null
        });
        
        // Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ ÙÙˆØ±ÙŠ
        await this.sendInstantConfirmation(messageData.id, quote);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
        this.emit('message:instant', quote);
        
        // Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
        this.viewTracker.startTracking(quote.id);
        
        console.log('âš¡ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ÙÙˆØ±ÙŠØ©:', messageData.text.substring(0, 30));
    }

    // Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ ÙÙˆØ±ÙŠ
    async sendInstantConfirmation(replyToId, quote) {
        const totalMessages = this.state.totalMessages + 1;
        this.state.totalMessages = totalMessages;
        
        const confirmationText = `
âš¡ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ ÙÙˆØ±Ø§Ù‹!

ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©:
â€¢ Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©: #${totalMessages}
â€¢ Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleTimeString('ar-SA')}
â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: ğŸŸ¢ Ù…Ø±Ø³Ù„Ø© ÙˆÙ…Ø¹Ø±ÙˆØ¶Ø©

ğŸ‘€ Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø±Ùƒ Ø¹Ù†Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©

ğŸ’• Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ø¢Ù† ØªØ¶ÙŠØ¡ Ø§Ù„Ù…ÙˆÙ‚Ø¹!
        `.trim();
        
        await this.sendMessageInstant(confirmationText, replyToId);
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙÙˆØ±ÙŠ
    async sendMessageInstant(text, replyToId = null) {
        const params = {
            chat_id: this.config.chatId,
            text: text,
            parse_mode: 'HTML',
            disable_web_page_preview: true
        };
        
        if (replyToId) {
            params.reply_to_message_id = replyToId;
        }
        
        try {
            const response = await fetch(`https://api.telegram.org/bot${this.config.botToken}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(params),
                signal: AbortSignal.timeout(3000) // 3 Ø«ÙˆØ§Ù† Ø­Ø¯ Ø£Ù‚ØµÙ‰
            });
            
            return await response.json();
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ±ÙŠ:', error);
        }
    }

    // Ù†Ø¨Ø¶Ø§Øª Ø§Ù„Ù‚Ù„Ø¨ Ù„Ù„Ø§ØªØµØ§Ù„
    startHeartbeat() {
        this.state.heartbeatTimer = setInterval(async () => {
            try {
                const start = Date.now();
                await this.sendHeartbeat();
                const latency = Date.now() - start;
                
                this.updateConnectionQuality(latency);
                this.state.lastHeartbeat = new Date();
                
            } catch (error) {
                this.updateConnectionQuality('poor');
                console.warn('Ù†Ø¨Ø¶Ø© Ù‚Ù„Ø¨ ÙØ§Ø´Ù„Ø©:', error);
            }
        }, 5000); // ÙƒÙ„ 5 Ø«ÙˆØ§Ù†
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ù†Ø¨Ø¶Ø© Ù‚Ù„Ø¨
    async sendHeartbeat() {
        const response = await fetch(`https://api.telegram.org/bot${this.config.botToken}/getMe`, {
            signal: AbortSignal.timeout(2000)
        });
        return response.json();
    }

    // ØªØ­Ø¯ÙŠØ« Ø¬ÙˆØ¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    updateConnectionQuality(latencyOrStatus) {
        if (typeof latencyOrStatus === 'number') {
            if (latencyOrStatus < 500) {
                this.state.connectionQuality = 'excellent';
            } else if (latencyOrStatus < 1000) {
                this.state.connectionQuality = 'good';
            } else if (latencyOrStatus < 2000) {
                this.state.connectionQuality = 'fair';
            } else {
                this.state.connectionQuality = 'poor';
            }
        } else {
            this.state.connectionQuality = latencyOrStatus;
        }
        
        this.emit('connection:quality', this.state.connectionQuality);
    }

    // Ø¨Ø¯Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
    startViewTracking() {
        this.viewTracker.startGlobalTracking();
        console.log('ğŸ‘€ ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©');
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„
    handleConnectionError(error) {
        this.state.retryCount++;
        this.updateConnectionQuality('error');
        
        if (this.state.retryCount < this.config.maxRetries) {
            setTimeout(() => {
                console.log(`ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ${this.state.retryCount}/${this.config.maxRetries}`);
                this.init();
            }, 2000 * this.state.retryCount);
        }
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
    handleSyncError(error) {
        this.state.retryCount++;
        this.updateConnectionQuality('poor');
        
        if (this.state.retryCount >= this.config.maxRetries) {
            console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹');
            this.emit('connection:failed');
        }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ù…Ø¹Ø±Ù ØªØ­Ø¯ÙŠØ«
    getLastUpdateId() {
        return parseInt(localStorage.getItem('telegram_last_update_id') || '0');
    }

    // ØªØ¹ÙŠÙŠÙ† Ø¢Ø®Ø± Ù…Ø¹Ø±Ù ØªØ­Ø¯ÙŠØ«
    setLastUpdateId(updateId) {
        localStorage.setItem('telegram_last_update_id', updateId.toString());
    }

    // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ù…Ø¹Ø±Ù ØªØ­Ø¯ÙŠØ«
    updateLastUpdateId(updates) {
        if (updates.length > 0) {
            const maxId = Math.max(...updates.map(u => u.update_id));
            this.setLastUpdateId(maxId);
        }
    }

    // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø«
    emit(eventName, data = null) {
        this.events.dispatchEvent(new CustomEvent(eventName, { detail: data }));
    }

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø­Ø¯Ø«
    on(eventName, callback) {
        this.events.addEventListener(eventName, callback);
    }

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
    cleanup() {
        if (this.state.syncTimer) {
            clearInterval(this.state.syncTimer);
        }
        if (this.state.heartbeatTimer) {
            clearInterval(this.state.heartbeatTimer);
        }
        this.viewTracker.cleanup();
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    getSystemStatus() {
        return {
            isOnline: this.state.isOnline,
            connectionQuality: this.state.connectionQuality,
            lastHeartbeat: this.state.lastHeartbeat,
            totalMessages: this.state.totalMessages,
            viewedMessages: this.state.viewedMessages,
            retryCount: this.state.retryCount
        };
    }
}

    </script>
</body>
</html>
